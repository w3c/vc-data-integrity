<!DOCTYPE html><html lang="en" dir="ltr"><head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="generator" content="ReSpec 35.1.2">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
span.example-title{text-transform:none}
:is(aside,div).example,div.illegal-example{padding:.5em;margin:1em 0;position:relative;clear:both}
div.illegal-example{color:red}
div.illegal-example p{color:#000}
aside.example div.example{border-left-width:.1em;border-color:#999;background:#fff}
</style>
<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-color:var(--warning-border,#f11);border-width:.2em;border-style:solid;background:#fbe9e9;background:var(--warning-bg,#fbe9e9);color:#000;color:var(--text,#000)}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;background:var(--indextable-hover-bg,#fff);color:#000;color:var(--text,#000);box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);box-shadow:0 1em 3em -.4em var(--tocsidebar-shadow,rgba(0,0,0,.3)),0 0 1px 1px var(--tocsidebar-shadow,rgba(0,0,0,.05));border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;border-bottom-color:var(--indextable-hover-bg,#fff);top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1;border-bottom-color:var(--indextable-hover-bg,#a2a9b1)}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;color:var(--text,#000);margin-top:.25em}
.dfn-panel ul a[href]{color:#333;color:var(--text,#333)}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
    
<title>Verifiable Credential Data Integrity 1.0</title>
    
    
    
<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
    
    

    
    
<style>

code {
  color: rgb(199, 73, 0);
  font-weight: bold;
}
pre {
  overflow-x: auto;
  white-space: pre-wrap;
}
pre .highlight {
  font-weight: bold;
  color: Green;
}
pre .subject {
  font-weight: bold;
  color: RoyalBlue;
}
pre .property {
  font-weight: bold;
  color: DarkGoldenrod;
}
pre .comment {
  font-weight: bold;
  color: SteelBlue;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
ol.algorithm { counter-reset:numsection; list-style-type: none; }
ol.algorithm li { margin: 0.5em 0; }
ol.algorithm li:before { font-weight: bold; counter-increment: numsection; content: counters(numsection, ".") ") "; }

table.simple {
    border-collapse: collapse;
    margin: 25px 0;
    min-width: 400px;
    border: 1px solid #dddddd;
}
table.simple thead tr {
    background-color: #005a9c;
    color: #ffffff;
    text-align: left;
}
table.simple th,
table.simple td {
    padding: 12px 15px;
    vertical-align: top;
    text-align: left;
}
table.simple tbody tr {
    border-bottom: 1px solid #dddddd;
}
table.simple tbody tr:nth-of-type(even) {
    background-color: #00000008;
}
table.simple tbody tr:last-of-type {
    border-bottom: 2px solid #005a9c;
}
    
</style>

<meta name="color-scheme" content="light">
<meta name="description" content="This specification describes mechanisms for ensuring the authenticity and
integrity of verifiable credentials and similar types of constrained digital
documents using cryptography, especially through the use of digital
signatures and related mathematical proofs.">
<link rel="canonical" href="https://www.w3.org/TR/vc-data-integrity/">
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#222}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#222;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<style>

.vc-tabbed {
  overflow-x: hidden;
  margin: 0 0;
}

.vc-tabbed [type="radio"] {
  display: none;
}

.vc-tabs {
  display: flex;
  align-items: stretch;
  list-style: none;
  padding: 0;
  border-bottom: 1px solid #ccc;
}

li.vc-tab {
  margin: unset;
}

.vc-tab > label {
  display: block;
  margin-bottom: -1px;
  padding: .4em .5em;
  border: 1px solid #ccc;
  border-top-right-radius: .4em;
  border-top-left-radius: .4em;
  background: #eee;
  color: #666;
  cursor: pointer;
  transition: all 0.3s;
}

.vc-tab:hover label {
  border-left-color: #333;
  border-top-color: #333;
  border-right-color: #333;
  color: #333;
}

.vc-tab-content {
  display: none;
}

.vc-tab-content h1 {
  font-size: 1em;
  margin: 0 0;
}

.vc-jose-cose-tabbed, .vc-jose-cose-tabbed-jwt,
.vc-jose-cose-tabbed-sd-jwt, .vc-jose-cose-tabbed-cose,
.sd-jwt-tabbed {
  overflow-x: hidden;
  margin: 0 0;
}

.vc-jose-cose-tabbed [type="radio"], .vc-jose-cose-tabbed-jwt [type="radio"],
.vc-jose-cose-tabbed-sd-jwt [type="radio"],
.vc-jose-cose-tabbed-cose [type="radio"],
.sd-jwt-tabbed [type="radio"] {
  display: none;
}

.vc-jose-cose-tabs, .vc-jose-cose-jwt-tabs, .vc-jose-cose-sd-jwt-tabs,
.vc-jose-cose-cose-tabs,
.sd-jwt-tabs {
  display: flex;
  align-items: stretch;
  list-style: none;
  padding: 0;
  border-bottom: 1px solid #ccc;
}

li.vc-jose-cose-tab, li.vc-jose-cose-jwt-tab, li.vc-jose-cose-sd-jwt-tab,
li.vc-jose-cose-cose-tab,
li.sd-jwt-tab {
  margin: 0 0;
  margin-left: 8px;
}

.vc-jose-cose-tab>label, .vc-jose-cose-jwt-tab>label,
.vc-jose-cose-sd-jwt-tab>label, .vc-jose-cose-cose-tab>label,
.sd-jwt-tab>label {
  display: block;
  margin-bottom: -1px;
  padding: .4em .5em;
  border: 1px solid #ccc;
  border-top-right-radius: .4em;
  border-top-left-radius: .4em;
  background: #eee;
  color: #666;
  cursor: pointer;
  transition: all 0.3s;
}

.vc-jose-cose-tab:hover label, .vc-jose-cose-jwt-tab:hover label,
.vc-jose-cose-sd-jwt-tab:hover label, .vc-jose-cose-cose-tab:hover label,
.sd-jwt-tab:hover label {
  border-left-color: #333;
  border-top-color: #333;
  border-right-color: #333;
  color: #333;
}

.vc-jose-cose-tab-content,
.sd-jwt-tab-content {
  display: none;
}

.vc-tabbed [type="radio"]:nth-of-type(1):checked ~ .vc-tabs .vc-tab:nth-of-type(1) label,
  .vc-tabbed [type="radio"]:nth-of-type(2):checked ~ .vc-tabs .vc-tab:nth-of-type(2) label,
  .vc-tabbed [type="radio"]:nth-of-type(3):checked ~ .vc-tabs .vc-tab:nth-of-type(3) label,
  .vc-tabbed [type="radio"]:nth-of-type(4):checked ~ .vc-tabs .vc-tab:nth-of-type(4) label,
  .vc-tabbed [type="radio"]:nth-of-type(5):checked ~ .vc-tabs .vc-tab:nth-of-type(5) label,
  .vc-tabbed [type="radio"]:nth-of-type(6):checked ~ .vc-tabs .vc-tab:nth-of-type(6) label,
  .vc-tabbed [type="radio"]:nth-of-type(7):checked ~ .vc-tabs .vc-tab:nth-of-type(7) label,
  .vc-tabbed [type="radio"]:nth-of-type(8):checked ~ .vc-tabs .vc-tab:nth-of-type(8) label {
  border-bottom-color: #fff;
  background: #fff;
  color: #222;
}

.vc-tabbed [type="radio"]:nth-of-type(1):checked ~ .vc-tab-content:nth-of-type(1),
  .vc-tabbed [type="radio"]:nth-of-type(2):checked ~ .vc-tab-content:nth-of-type(2),
  .vc-tabbed [type="radio"]:nth-of-type(3):checked ~ .vc-tab-content:nth-of-type(3),
  .vc-tabbed [type="radio"]:nth-of-type(4):checked ~ .vc-tab-content:nth-of-type(4),
  .vc-tabbed [type="radio"]:nth-of-type(5):checked ~ .vc-tab-content:nth-of-type(5),
  .vc-tabbed [type="radio"]:nth-of-type(6):checked ~ .vc-tab-content:nth-of-type(6),
  .vc-tabbed [type="radio"]:nth-of-type(7):checked ~ .vc-tab-content:nth-of-type(7),
  .vc-tabbed [type="radio"]:nth-of-type(8):checked ~ .vc-tab-content:nth-of-type(8),
.sd-jwt-tabbed [type="radio"]:nth-of-type(1):checked ~ .sd-jwt-tab-content:nth-of-type(1),
.sd-jwt-tabbed [type="radio"]:nth-of-type(2):checked ~ .sd-jwt-tab-content:nth-of-type(2),
.sd-jwt-tabbed [type="radio"]:nth-of-type(3):checked ~ .sd-jwt-tab-content:nth-of-type(3) {
  display: block;
}

.disclosure {
  margin: 10px 0;
  font-size: 12px;
  line-height: 1.6;
  padding: 5px;
}

.disclosure h3 {
  margin: 0;
  font-size: 14px;
  padding-left: 5px;
}

.disclosure .claim-name {
  color: #333;
}

.disclosure .hash,
.disclosure .disclosure-value,
.disclosure .contents {
  color: #555;
  word-wrap: break-word;
  display: inline;
}

.disclosure p {
  margin: 0;
  padding-left: 5px;
}

.disclosure pre {
  white-space: pre-wrap;
  word-wrap: break-word;
  margin: 0;
  padding-left: 5px;
  line-height: 1.6;
  display: inline-block;
}

.header-value {
  white-space: pre-wrap;
  word-wrap: break-word;
  margin: 0;
  padding-left: 5px;
  line-height: 1.6;
  font-size: 12px;
}

.cose-text, .jose-text, .vc-jose-cose-jwt .text, .vc-jose-cose-sd-jwt .text,
 .vc-jose-cose-cose .text {
  font-family: monospace;
  color: green;
}

.sd-jwt-compact, .jwt-compact, .vc-jose-cose-jwt .compact, .vc-jose-cose-sd-jwt
 .compact, .vc-jose-cose-cose .compact {
  background-color: rgba(0,0,0,.03);
}

.sd-jwt-header, .jwt-header, .vc-jose-cose-jwt .header, .vc-jose-cose-sd-jwt
 .header, .vc-jose-cose-cose .header {
  color: red;
}

.sd-jwt-payload, .jwt-payload, .vc-jose-cose-jwt .payload, .vc-jose-cose-sd-jwt
 .payload, .vc-jose-cose-cose .payload {
  color: green;
}

.sd-jwt-signature, .jwt-signature, .vc-jose-cose-jwt .signature,
 .vc-jose-cose-sd-jwt .signature, .vc-jose-cose-cose .signature {
  color: blue;
}

.sd-jwt-disclosure, .vc-jose-cose-jwt .disclosure, .vc-jose-cose-sd-jwt
 .disclosure, .vc-jose-cose-cose .disclosure {
  color: purple;
}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "CR",
  "shortName": "vc-data-integrity",
  "subtitle": "Securing the Integrity of Verifiable Credential Data",
  "publishDate": "2024-11-05",
  "edDraftURI": "https://w3c.github.io/vc-data-integrity/",
  "implementationReportURI": "https://w3c.github.io/vc-data-integrity/implementations/",
  "crEnd": "2024-12-05",
  "editors": [
    {
      "name": "Manu Sporny",
      "url": "https://digitalbazaar.com/",
      "company": "Digital Bazaar",
      "companyURL": "http://digitalbazaar.com/",
      "w3cid": 41758
    },
    {
      "name": "Dave Longley",
      "url": "https://digitalbazaar.com/",
      "company": "Digital Bazaar",
      "companyURL": "http://digitalbazaar.com/",
      "note": "2014-2022",
      "w3cid": 48025
    },
    {
      "name": "Greg Bernstein",
      "url": "https://www.grotto-networking.com/",
      "company": "Invited Expert",
      "w3cid": 140479
    },
    {
      "name": "Dmitri Zagidulin",
      "url": "https://digitalcredentials.mit.edu/",
      "company": "Invited Expert",
      "w3cid": 86708
    },
    {
      "name": "Sebastian Crane",
      "url": "https://github.com/seabass-labrax",
      "company": "Invited Expert",
      "w3cid": 140132
    }
  ],
  "authors": [
    {
      "name": "Dave Longley",
      "url": "http://digitalbazaar.com/",
      "company": "Digital Bazaar",
      "companyURL": "http://digitalbazaar.com/"
    },
    {
      "name": "Manu Sporny",
      "url": "http://digitalbazaar.com/",
      "company": "Digital Bazaar",
      "companyURL": "http://digitalbazaar.com/"
    }
  ],
  "group": "vc",
  "wgPublicList": "public-vc-wg",
  "github": "w3c/vc-data-integrity",
  "maxTocLevel": 3,
  "localBiblio": {
    "DI-EDDSA": {
      "title": "The Edwards Digital Signature Algorithm Cryptosuites v1.0",
      "href": "https://www.w3.org/TR/vc-di-eddsa/",
      "authors": [
        "David Longley",
        "Manu Sporny",
        "Dmitri Zagidulin"
      ],
      "status": "WD",
      "publisher": "W3C Verifiable Credentials Working Group",
      "id": "di-eddsa"
    },
    "DI-ECDSA": {
      "title": "The Elliptic Curve Digital Signature Algorithm Cryptosuites v1.0",
      "href": "https://www.w3.org/TR/vc-di-ecdsa/",
      "authors": [
        "David Longley",
        "Manu Sporny",
        "Marty Reed"
      ],
      "status": "WD",
      "publisher": "W3C Verifiable Credentials Working Group",
      "id": "di-ecdsa"
    },
    "DI-BBSDSA": {
      "title": "The BBS Digital Signature Algorithm Cryptosuites v1.0",
      "href": "https://www.w3.org/TR/vc-di-bbs/",
      "authors": [
        "Tobias Looker",
        "Orie Steele"
      ],
      "status": "WD",
      "publisher": "W3C Verifiable Credentials Working Group"
    },
    "JOSE-REGISTRIES": {
      "title": "The JSON Object Signing and Encryption (JOSE) Registries",
      "href": "https://www.iana.org/assignments/jose",
      "authors": [
        "The Internet Assigned Numbers Authority"
      ],
      "status": "REC",
      "publisher": "The Internet Assigned Numbers Authority"
    },
    "SECURITY-VOCABULARY": {
      "title": "The Security Vocabulary",
      "href": "https://w3id.org/security",
      "authors": [
        "Ivan Herman",
        "Manu Sporny",
        "David Longley"
      ],
      "status": "ED",
      "publisher": "Verifiable Credentials Working Group",
      "id": "security-vocabulary"
    },
    "ZCAP": {
      "title": "Authorization Capabilities for Linked Data",
      "href": "https://w3c-ccg.github.io/zcap-spec/",
      "status": "CGDRAFT",
      "publisher": "Credentials Community Group",
      "id": "zcap"
    },
    "MULTIBASE": {
      "title": "The Multibase Data Format",
      "date": "February 2023",
      "href": "https://datatracker.ietf.org/doc/draft-multiformats-multibase",
      "authors": [
        "Juan Benet",
        "Manu Sporny"
      ],
      "status": "Internet-Draft",
      "publisher": "IETF"
    },
    "MULTIHASH": {
      "title": "The Multihash Data Format",
      "date": "February 2023",
      "href": "https://datatracker.ietf.org/doc/draft-multiformats-multihash",
      "authors": [
        "Juan Benet",
        "Manu Sporny"
      ],
      "status": "Internet-Draft",
      "publisher": "IETF"
    },
    "MULTICODEC": {
      "title": "The Multi Codec Encoding Scheme",
      "date": "February 2022",
      "href": "https://github.com/multiformats/multicodec/blob/master/table.csv",
      "authors": [
        "The Multiformats Community"
      ],
      "status": "Internet-Draft",
      "publisher": "IETF"
    },
    "VC-EXTENSIONS": {
      "title": "Verifiable Credential Extensions",
      "href": "https://w3c.github.io/vc-extensions/",
      "authors": [
        "Manu Sporny"
      ],
      "status": "ED",
      "publisher": "W3C Verifiable Credentials Working Group",
      "id": "vc-extensions"
    },
    "DID-KEY": {
      "title": "The did:key Method",
      "href": "https://w3c-ccg.github.io/did-method-key/",
      "authors": [
        "Manu Sporny",
        "Dmitri Zagidulin",
        "Dave Longley",
        "Orie Steele"
      ],
      "status": "CG-DRAFT",
      "publisher": "W3C Credentials Community Group",
      "id": "did-key"
    },
    "SHA3": {
      "title": "SHA-3 Standard: Permutation-Based Hash and Extendable-Output Functions",
      "href": "https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf",
      "authors": [
        "National Institute of Standards and Technology"
      ],
      "status": "National Standard",
      "publisher": "U.S. Department of Commerce"
    },
    "SD-JWT": {
      "title": "Selective Disclosure for JWTs (SD-JWT)",
      "href": "https://datatracker.ietf.org/doc/draft-ietf-oauth-selective-disclosure-jwt/",
      "authors": [
        "Daniel Fett",
        "Kristina Yasuda",
        "Brian Campbell"
      ],
      "status": "I-D",
      "publisher": "The IETF OAuth Working Group",
      "id": "sd-jwt"
    }
  },
  "postProcess": [
    null,
    null
  ],
  "xref": [
    "INFRA",
    "MIMESNIFF",
    "VC-DATA-MODEL-2.0",
    "CONTROLLER-DOCUMENT"
  ],
  "otherLinks": [
    {
      "key": "Related Specifications",
      "data": [
        {
          "value": "The Verifiable Credentials Data Model v2.0",
          "href": "https://www.w3.org/TR/VC-DATA-MODEL-2.0/"
        },
        {
          "value": "The Edwards Digital Signature Algorithm Cryptosuites v1.0",
          "href": "https://www.w3.org/TR/vc-di-eddsa/"
        },
        {
          "value": "The Elliptic Curve Digital Signature Algorithm Cryptosuites v1.0",
          "href": "https://www.w3.org/TR/vc-di-ecdsa/"
        },
        {
          "value": "The BBS Digital Signature Algorithm Cryptosuites v1.0",
          "href": "https://www.w3.org/TR/vc-di-bbs/"
        }
      ]
    }
  ],
  "publishISODate": "2024-11-05T00:00:00.000Z",
  "generatedSubtitle": "W3C Candidate Recommendation Snapshot 05 November 2024"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-CR"></head>
<body class="h-entry" data-cite="INFRA MIMESNIFF VC-DATA-MODEL-2.0 CONTROLLER-DOCUMENT"><div class="head">
    <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
  </a></p>
    <h1 id="title" class="title">Verifiable Credential Data Integrity 1.0</h1> <h2 id="subtitle" class="subtitle">Securing the Integrity of Verifiable Credential Data</h2>
    <p id="w3c-state"><a href="https://www.w3.org/standards/types#CR">W3C Candidate Recommendation Snapshot</a> <time class="dt-published" datetime="2024-11-05">05 November 2024</time></p>
    <details open="">
      <summary>More details about this document</summary>
      <dl>
        <dt>This version:</dt><dd>
                <a class="u-url" href="https://www.w3.org/TR/2024/CR-vc-data-integrity-20241105/">https://www.w3.org/TR/2024/CR-vc-data-integrity-20241105/</a>
              </dd>
        <dt>Latest published version:</dt><dd>
                <a href="https://www.w3.org/TR/vc-data-integrity/">https://www.w3.org/TR/vc-data-integrity/</a>
              </dd>
        <dt>Latest editor's draft:</dt><dd><a href="https://w3c.github.io/vc-data-integrity/">https://w3c.github.io/vc-data-integrity/</a></dd>
        <dt>History:</dt><dd>
                    <a href="https://www.w3.org/standards/history/vc-data-integrity/">https://www.w3.org/standards/history/vc-data-integrity/</a>
                  </dd><dd>
                    <a href="https://github.com/w3c/vc-data-integrity/commits/">Commit history</a>
                  </dd>
        
        <dt>Implementation report:</dt><dd>
                <a href="https://w3c.github.io/vc-data-integrity/implementations/">https://w3c.github.io/vc-data-integrity/implementations/</a>
              </dd>
        
        
        
        <dt>Editors:</dt><dd class="editor p-author h-card vcard" data-editor-id="41758">
    <a class="u-url url p-name fn" href="https://digitalbazaar.com/">Manu Sporny</a> (<a class="p-org org h-org" href="http://digitalbazaar.com/">Digital Bazaar</a>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="48025">
    <a class="u-url url p-name fn" href="https://digitalbazaar.com/">Dave Longley</a> (<a class="p-org org h-org" href="http://digitalbazaar.com/">Digital Bazaar</a>) (2014-2022)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="140479">
    <a class="u-url url p-name fn" href="https://www.grotto-networking.com/">Greg Bernstein</a> (<span class="p-org org h-org">Invited Expert</span>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="86708">
    <a class="u-url url p-name fn" href="https://digitalcredentials.mit.edu/">Dmitri Zagidulin</a> (<span class="p-org org h-org">Invited Expert</span>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="140132">
    <a class="u-url url p-name fn" href="https://github.com/seabass-labrax">Sebastian Crane</a> (<span class="p-org org h-org">Invited Expert</span>)
  </dd>
        
        <dt>Authors:</dt><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="http://digitalbazaar.com/">Dave Longley</a> (<a class="p-org org h-org" href="http://digitalbazaar.com/">Digital Bazaar</a>)
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="http://digitalbazaar.com/">Manu Sporny</a> (<a class="p-org org h-org" href="http://digitalbazaar.com/">Digital Bazaar</a>)
  </dd>
        <dt>Feedback:</dt><dd>
        <a href="https://github.com/w3c/vc-data-integrity/">GitHub w3c/vc-data-integrity</a>
        (<a href="https://github.com/w3c/vc-data-integrity/pulls/">pull requests</a>,
        <a href="https://github.com/w3c/vc-data-integrity/issues/new/choose">new issue</a>,
        <a href="https://github.com/w3c/vc-data-integrity/issues/">open issues</a>)
      </dd><dd><a href="mailto:public-vc-wg@w3.org?subject=%5Bvc-data-integrity%5D%20YOUR%20TOPIC%20HERE">public-vc-wg@w3.org</a> with subject line <kbd>[vc-data-integrity] <em>… message topic …</em></kbd> (<a rel="discussion" href="https://lists.w3.org/Archives/Public/public-vc-wg">archives</a>)</dd>
        
        <dt>Related Specifications</dt><dd>
    <a href="https://www.w3.org/TR/VC-DATA-MODEL-2.0/">The Verifiable Credentials Data Model v2.0</a>
  </dd><dd>
    <a href="https://www.w3.org/TR/vc-di-eddsa/">The Edwards Digital Signature Algorithm Cryptosuites v1.0</a>
  </dd><dd>
    <a href="https://www.w3.org/TR/vc-di-ecdsa/">The Elliptic Curve Digital Signature Algorithm Cryptosuites v1.0</a>
  </dd><dd>
    <a href="https://www.w3.org/TR/vc-di-bbs/">The BBS Digital Signature Algorithm Cryptosuites v1.0</a>
  </dd>
      </dl>
    </details>
    
    
    <p class="copyright">
    <a href="https://www.w3.org/policies/#copyright">Copyright</a>
    ©
    2024
    
    <a href="https://www.w3.org/">World Wide Web Consortium</a>.
    <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
    <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
    <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
    <a rel="license" href="https://www.w3.org/copyright/software-license-2023/" title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
  </p>
    <hr title="Separator for header">
  </div>
    <section id="abstract" class="introductory"><h2>Abstract</h2>
      <p>
This specification describes mechanisms for ensuring the authenticity and
integrity of <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a> and similar types of constrained digital
documents using cryptography, especially through the use of digital
signatures and related mathematical proofs.
      </p>
    </section>

    <section id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this
      document at the time of its publication. A list of current <abbr title="World Wide Web Consortium">W3C</abbr>
      publications and the latest revision of this technical report can be found
      in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at
      https://www.w3.org/TR/.</em></p>

      <p>
The Working Group is actively seeking implementation feedback for this
specification. In order to exit the Candidate Recommendation phase, the
Working Group has set the requirement of at least two independent
implementations for each mandatory feature in the specification. For details
on the conformance testing process, see the test suites listed in the
<a href="https://w3c.github.io/vc-data-integrity/implementations/">
implementation report</a>.
      </p>

      <div class="issue atrisk" id="issue-container-number-1"><div role="heading" class="issue-title marker" id="h-issue" aria-level="3"><span>(Feature at Risk) Issue 1</span><span class="issue-label">: Features with less than two independent implementations</span></div><p class="atrisk">
Any feature with less than two independent implementations in the
Data Integrity portions of each
<a href="https://w3c.github.io/vc-data-integrity/implementations/">
cryptosuite implementation report</a> is an "at risk" feature and might be
removed before the transition to <abbr title="World Wide Web Consortium">W3C</abbr> Proposed Recommendation.
      </p></div>

    <p>
    This document was published by the <a href="https://www.w3.org/groups/wg/vc">Verifiable Credentials Working Group</a> as
    a Candidate Recommendation Snapshot using the
        <a href="https://www.w3.org/policies/process/20231103/#recs-and-notes">Recommendation track</a>. 
  </p><p>Publication as a Candidate Recommendation does not
  imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. A Candidate Recommendation Snapshot has received
        <a href="https://www.w3.org/policies/process/20231103/#dfn-wide-review">wide review</a>, is intended to
        gather
        <a href="https://w3c.github.io/vc-data-integrity/implementations/">implementation experience</a>,
        and has commitments from Working Group members to
        <a href="https://www.w3.org/policies/patent-policy/#sec-Requirements">royalty-free licensing</a>
        for implementations.</p><p>
          This Candidate Recommendation is not expected to advance to Proposed
          Recommendation any earlier than 05 December 2024.
        </p><p>
    
        This document was produced by a group
        operating under the
        <a href="https://www.w3.org/policies/patent-policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent
          Policy</a>.
      
    
                <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
                <a rel="disclosure" href="https://www.w3.org/groups/wg/vc/ipr">public list of any patent disclosures</a>
          made in connection with the deliverables of
          the group; that page also includes
          instructions for disclosing a patent. An individual who has actual
          knowledge of a patent which the individual believes contains
          <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential Claim(s)</a>
          must disclose the information in accordance with
          <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
        
  </p><p>
                      This document is governed by the
                      <a id="w3c_process_revision" href="https://www.w3.org/policies/process/20231103/">03 November 2023 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                    </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#how-it-works"><bdi class="secno">1.1 </bdi>How it Works</a></li><li class="tocline"><a class="tocxref" href="#design-goals-and-rationale"><bdi class="secno">1.2 </bdi>Design Goals and Rationale</a></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">1.3 </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#terminology"><bdi class="secno">1.4 </bdi>Terminology</a></li></ol></li><li class="tocline"><a class="tocxref" href="#data-model"><bdi class="secno">2. </bdi>Data Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#proofs"><bdi class="secno">2.1 </bdi>Proofs</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#proof-sets"><bdi class="secno">2.1.1 </bdi>Proof Sets</a></li><li class="tocline"><a class="tocxref" href="#proof-chains"><bdi class="secno">2.1.2 </bdi>Proof Chains</a></li><li class="tocline"><a class="tocxref" href="#proof-graphs"><bdi class="secno">2.1.3 </bdi>Proof Graphs</a></li></ol></li><li class="tocline"><a class="tocxref" href="#proof-purposes"><bdi class="secno">2.2 </bdi>Proof Purposes</a></li><li class="tocline"><a class="tocxref" href="#resource-integrity"><bdi class="secno">2.3 </bdi>Resource Integrity</a></li><li class="tocline"><a class="tocxref" href="#contexts-and-vocabularies"><bdi class="secno">2.4 </bdi>Contexts and Vocabularies</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#validating-contexts"><bdi class="secno">2.4.1 </bdi>Validating Contexts</a></li><li class="tocline"><a class="tocxref" href="#context-injection"><bdi class="secno">2.4.2 </bdi>Context Injection</a></li><li class="tocline"><a class="tocxref" href="#securing-data-losslessly"><bdi class="secno">2.4.3 </bdi>Securing Data Losslessly</a></li><li class="tocline"><a class="tocxref" href="#datatypes"><bdi class="secno">2.4.4 </bdi>Datatypes</a><ol class="toc"></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#relationship-to-linked-data"><bdi class="secno">2.5 </bdi>Relationship to Linked Data</a></li><li class="tocline"><a class="tocxref" href="#relationship-to-verifiable-credentials"><bdi class="secno">2.6 </bdi>Relationship to Verifiable Credentials</a></li></ol></li><li class="tocline"><a class="tocxref" href="#cryptographic-suites"><bdi class="secno">3. </bdi>Cryptographic Suites</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#dataintegrityproof"><bdi class="secno">3.1 </bdi>DataIntegrityProof</a></li></ol></li><li class="tocline"><a class="tocxref" href="#algorithms"><bdi class="secno">4. </bdi>Algorithms</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#processing-model"><bdi class="secno">4.1 </bdi>Processing Model</a></li><li class="tocline"><a class="tocxref" href="#add-proof"><bdi class="secno">4.2 </bdi>Add Proof</a></li><li class="tocline"><a class="tocxref" href="#add-proof-set-chain"><bdi class="secno">4.3 </bdi>Add Proof Set/Chain</a></li><li class="tocline"><a class="tocxref" href="#verify-proof"><bdi class="secno">4.4 </bdi>Verify Proof</a></li><li class="tocline"><a class="tocxref" href="#verify-proof-sets-and-chains"><bdi class="secno">4.5 </bdi>Verify Proof Sets and Chains</a></li><li class="tocline"><a class="tocxref" href="#context-validation"><bdi class="secno">4.6 </bdi>Context Validation</a></li><li class="tocline"><a class="tocxref" href="#processing-errors"><bdi class="secno">4.7 </bdi>Processing Errors</a></li></ol></li><li class="tocline"><a class="tocxref" href="#security-considerations"><bdi class="secno">5. </bdi>Security Considerations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#versioning-cryptography-suites"><bdi class="secno">5.1 </bdi>Versioning Cryptography Suites</a></li><li class="tocline"><a class="tocxref" href="#protecting-application-developers"><bdi class="secno">5.2 </bdi>Protecting Application Developers</a></li><li class="tocline"><a class="tocxref" href="#conventions-for-naming-cryptography-suites"><bdi class="secno">5.3 </bdi>Conventions for Naming Cryptography Suites</a></li><li class="tocline"><a class="tocxref" href="#agility-and-layering"><bdi class="secno">5.4 </bdi>Agility and Layering</a></li><li class="tocline"><a class="tocxref" href="#transformations"><bdi class="secno">5.5 </bdi>Transformations</a></li><li class="tocline"><a class="tocxref" href="#protected-information"><bdi class="secno">5.6 </bdi>Protected Information</a></li><li class="tocline"><a class="tocxref" href="#data-opacity"><bdi class="secno">5.7 </bdi>Data Opacity</a></li><li class="tocline"><a class="tocxref" href="#verification-method-binding"><bdi class="secno">5.8 </bdi>Verification Method Binding</a></li><li class="tocline"><a class="tocxref" href="#verification-relationship-validation"><bdi class="secno">5.9 </bdi>Verification Relationship Validation</a></li><li class="tocline"><a class="tocxref" href="#proof-purpose-validation"><bdi class="secno">5.10 </bdi>Proof Purpose Validation</a></li><li class="tocline"><a class="tocxref" href="#canonicalization-method-security"><bdi class="secno">5.11 </bdi>Canonicalization Method Security</a></li><li class="tocline"><a class="tocxref" href="#canonicalization-method-correctness"><bdi class="secno">5.12 </bdi>Canonicalization Method Correctness</a></li><li class="tocline"><a class="tocxref" href="#network-requests"><bdi class="secno">5.13 </bdi>Network Requests</a></li><li class="tocline"><a class="tocxref" href="#other-security-considerations"><bdi class="secno">5.14 </bdi>Other Security Considerations</a></li></ol></li><li class="tocline"><a class="tocxref" href="#privacy-considerations"><bdi class="secno">6. </bdi>Privacy Considerations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#unlinkability"><bdi class="secno">6.1 </bdi>Unlinkability</a></li><li class="tocline"><a class="tocxref" href="#selective-disclosure"><bdi class="secno">6.2 </bdi>Selective Disclosure</a></li><li class="tocline"><a class="tocxref" href="#previous-proofs"><bdi class="secno">6.3 </bdi>Previous Proofs</a></li><li class="tocline"><a class="tocxref" href="#fingerprinting-network-requests"><bdi class="secno">6.4 </bdi>Fingerprinting Network Requests</a></li><li class="tocline"><a class="tocxref" href="#canonicalization-method-privacy"><bdi class="secno">6.5 </bdi>Canonicalization Method Privacy</a></li><li class="tocline"><a class="tocxref" href="#other-privacy-considerations"><bdi class="secno">6.6 </bdi>Other Privacy Considerations</a></li></ol></li><li class="tocline"><a class="tocxref" href="#accessibility-considerations"><bdi class="secno">7. </bdi>Accessibility Considerations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#presenting-time-values"><bdi class="secno">7.1 </bdi>Presenting Time Values</a></li></ol></li><li class="tocline"><a class="tocxref" href="#understanding-proof-sets-and-proof-chains"><bdi class="secno">A. </bdi>Understanding Proof Sets and Proof Chains</a></li><li class="tocline"><a class="tocxref" href="#revision-history"><bdi class="secno">B. </bdi>Revision History</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">C. </bdi>Acknowledgements</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">D. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">D.1 </bdi>Normative references</a></li><li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">D.2 </bdi>Informative references</a></li></ol></li></ol></nav>

    <section class="informative" id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div><p><em>This section is non-normative.</em></p>
      
      <p>
This specification describes mechanisms for ensuring the authenticity and
integrity of <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a> and similar types of constrained digital
documents using cryptography, especially through the use of digital signatures
and related mathematical proofs. Cryptographic proofs enable functionality that
is useful to implementors of distributed systems. For example, proofs can be
used to:
      </p>

      <ul>
        <li>
Make statements that can be shared without loss of trust, because their
authorship can be verified by a third party, for example as part of a
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-model-2.0" title="Verifiable Credentials Data Model v2.0">VC-DATA-MODEL-2.0</a></cite>], <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-presentation">verifiable presentation</a>,
or social media post.
        </li>
        <li>
Authenticate as an entity identified by a particular identifier, for example, as
the subject identified by a Decentralized Identifier (DID) [<cite><a class="bibref" data-link-type="biblio" href="#bib-did-core" title="Decentralized Identifiers (DIDs) v1.0">DID-CORE</a></cite>].
        </li>
        <li>
Delegate authorization for actions in a remote execution environment, via
mechanisms such as Authorization Capabilities [<cite><a class="bibref" data-link-type="biblio" href="#bib-zcap" title="Authorization Capabilities for Linked Data">ZCAP</a></cite>].
        </li>
        <li>
Agree to contracts where the agreement can be verified by another party.
        </li>
        <li>
Additionally, many proofs that are based on cryptographic digital signatures
provide the benefit of integrity protection, making documents and data
tamper-evident.
        </li>
      </ul>

      <section class="informative" id="how-it-works"><div class="header-wrapper"><h3 id="x1-1-how-it-works"><bdi class="secno">1.1 </bdi>How it Works</h3><a class="self-link" href="#how-it-works" aria-label="Permalink for Section 1.1"></a></div><p><em>This section is non-normative.</em></p>
        

        <p>
The operation of Data Integrity is conceptually simple. To create a
cryptographic proof, the following steps are performed: 1) Transformation,
2) Hashing, and 3) Proof Generation.
        </p>

        <figure id="hiw-creation">
          <img style="margin: auto; display: block; width: 100%;" src="diagrams/hiw-creation.svg" alt="
Diagram showing the three steps involved in the creation of a cryptographic
proof. The diagram is laid out left to right with a blue box labeled 'Data'
on the far left. The blue box travels, left to right, through three subsequent
yellow arrows labeled 'Transform Data', 'Hash Data', and 'Generate Proof'. The
resulting blue box at the far right is labeled 'Data with Proof'.
               ">
          <figcaption style="text-align: center;"><a class="self-link" href="#hiw-creation">Figure <bdi class="figno">1</bdi></a> <span class="fig-title">
To create a cryptographic proof, data is transformed, hashed, and
cryptographically protected.
          </span></figcaption>
        </figure>

        <p>
<dfn id="dfn-transformation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Transformation</dfn> is a process described by a <dfn data-plurals="transformation algorithms" id="dfn-transformation-algorithm" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">transformation
algorithm</dfn> that takes input data and prepares it for the hashing process.
One example of a possible transformation is to take a record of people's names
that attended a meeting, sort the list alphabetically by the individual's family
name, and rewrite the names on a piece of paper, one per line, in sorted order.
Examples of transformations include
<a href="https://en.wikipedia.org/wiki/Canonicalization">canonicalization</a>
and
<a href="https://en.wikipedia.org/wiki/Binary-to-text_encoding">
binary-to-text</a> encoding.
        </p>

        <p>
<dfn id="dfn-hashing" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Hashing</dfn> is a process described by a <dfn data-plurals="hashing algorithms" id="dfn-hashing-algorithm" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">hashing algorithm</dfn> that
calculates an identifier for the transformed data using a
<a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">
cryptographic hash function</a>. This process is conceptually similar to how a
phone address book functions, where one takes a person's name (the input data)
and maps that name to that individual's phone number (the hash). Examples of
cryptographic hash functions include
<a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function#SHA-3">
SHA-3</a> and
<a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function#BLAKE3">
BLAKE-3</a>.
        </p>

        <p>
<dfn class="lint-ignore" id="dfn-proof-generation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Proof Generation</dfn> is a process described by a
<dfn data-plurals="proof serialization algorithms" id="dfn-proof-serialization-algorithm" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">proof serialization algorithm</dfn> that calculates a value that protects the
integrity of the input data from modification or otherwise proves a certain
desired threshold of trust. This process is conceptually similar to the way a
wax seal can be used on an envelope containing a letter to establish trust in
the sender and show that the letter has not been tampered with in transit.
Examples of proof serialization functions include
<a href="https://en.wikipedia.org/wiki/Digital_signature">
digital signatures</a>,
<a href="https://en.wikipedia.org/wiki/Proof_of_stake">proofs of stake</a>, and
<a href="https://en.wikipedia.org/wiki/Proof_of_knowledge">
proofs of knowledge</a>, in general.
        </p>

        <p>
To verify a cryptographic proof, the following steps are performed:
1) Transformation, 2) Hashing, and 3) Proof Verification.
        </p>

        <figure id="hiw-verification">
          <img style="margin: auto; display: block; width: 100%;" src="diagrams/hiw-verification.svg" alt="
Diagram showing the three steps involved in the verification of a cryptographic
proof. The diagram is laid out left to right with a blue box labeled
'Data with Proof' on the far left. The blue box travels, left to right, through
three subsequent yellow arrows labeled 'Transform Data', 'Hash Data', and
'Verify Proof'. The resulting blue box at the far right is labeled 'Data with
Proof'.
               ">
          <figcaption style="text-align: center;"><a class="self-link" href="#hiw-verification">Figure <bdi class="figno">2</bdi></a> <span class="fig-title">
To verify a cryptographic proof, data is transformed, hashed, and
checked for correctness.
          </span></figcaption>
        </figure>

        <p>
During verification, the <a data-link-type="dfn|abstract-op" href="#dfn-transformation" class="internalDFN" id="ref-for-dfn-transformation-1">transformation</a> and <a data-link-type="dfn|abstract-op" href="#dfn-hashing" class="internalDFN" id="ref-for-dfn-hashing-1">hashing</a> steps are
conceptually the same as described above.
        </p>

        <p>
<dfn class="lint-ignore" id="dfn-proof-verification" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Proof Verification</dfn> is a process that is described
by a <dfn data-plurals="proof verification algorithms" id="dfn-proof-verification-algorithm" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">proof verification algorithm</dfn> that applies a cryptographic proof
verification function to see if the input data can be trusted. Possible proof
verification functions include
<a href="https://en.wikipedia.org/wiki/Digital_signature">
digital signatures</a>,
<a href="https://en.wikipedia.org/wiki/Proof_of_stake">proofs of stake</a>, and
<a href="https://en.wikipedia.org/wiki/Proof_of_knowledge">
proofs of knowledge</a>, in general.
        </p>

        <p>
This specification details how cryptographic software architects and
implementers can package these processes together into things called
<a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-1">cryptographic suites</a> and provide them to application developers for the
purposes of protecting the integrity of application data in transit and at rest.
        </p>

      </section>

      <section class="informative" id="design-goals-and-rationale"><div class="header-wrapper"><h3 id="x1-2-design-goals-and-rationale"><bdi class="secno">1.2 </bdi>Design Goals and Rationale</h3><a class="self-link" href="#design-goals-and-rationale" aria-label="Permalink for Section 1.2"></a></div><p><em>This section is non-normative.</em></p>
        

        <p>
This specification optimizes for the following design goals:
        </p>

        <dl>
          <dt>Simplicity</dt>
          <dd>
The technology is designed to be easy to use for application developers,
without requiring significant training in cryptography. It optimizes for the
following priority of constituencies: application developers over cryptographic
suite implementers, over cryptographic suite designers, over cryptographic
algorithm specification authors.  The solution focuses on sensible defaults to
prevent the selection of ineffective protection mechanisms. See section
<a href="#protecting-application-developers" data-matched-text="[[[#protecting-application-developers]]]" class="sec-ref"><bdi class="secno">5.2 </bdi>Protecting Application Developers</a> and
<a href="#versioning-cryptography-suites" data-matched-text="[[[#versioning-cryptography-suites]]]" class="sec-ref"><bdi class="secno">5.1 </bdi>Versioning Cryptography Suites</a> for further details.
          </dd>
          <dt>Composability</dt>
          <dd>
A number of historical digital signature mechanisms have had monolithic
designs which limited use cases by combining data transformation, syntax,
digital signature, and serialization into a single specification. This
specification layers each component such that a broader range of use cases are
enabled, including generalized selective disclosure and serialization-agnostic
signatures. See section <a href="#transformations" data-matched-text="[[[#transformations]]]" class="sec-ref"><bdi class="secno">5.5 </bdi>Transformations</a>, section <a href="#data-opacity" data-matched-text="[[[#data-opacity]]]" class="sec-ref"><bdi class="secno">5.7 </bdi>Data Opacity</a>, and
<a href="#versioning-cryptography-suites" data-matched-text="[[[#versioning-cryptography-suites]]]" class="sec-ref"><bdi class="secno">5.1 </bdi>Versioning Cryptography Suites</a> for further rationale.
          </dd>
          <dt>Resilience</dt>
          <dd>
Since digital proof mechanisms might be compromised without warning due to
technological advancements, it is important that <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-2">cryptographic suites</a>
provide multiple layers of protection and can be rapidly upgraded. This
specification provides for both algorithmic agility and cryptographic layering,
while still keeping the digital proof format easy for developers to understand
and use. See section <a href="#agility-and-layering" data-matched-text="[[[#agility-and-layering]]]" class="sec-ref"><bdi class="secno">5.4 </bdi>Agility and Layering</a> to understand the particulars.
          </dd>
          <dt>Progressive Extensibility</dt>
          <dd>
Creating and deploying new cryptographic protection mechanisms is designed to be
a deliberate, iterative, and careful process that acknowledges that extension
happens in phases from experimentation, to implementation, to standardization.
This specification strives to balance the need for an increase in the rate of
innovation in cryptography with the need for stable production-grade
cryptography suites. See section <a href="#cryptographic-suites" data-matched-text="[[[#cryptographic-suites]]]" class="sec-ref"><bdi class="secno">3. </bdi>Cryptographic Suites</a> for instructions on
establishing new types of cryptographic proofs.
          </dd>
          <dt>Serialization Flexibility</dt>
          <dd>
Cryptographic proofs can be serialized in many different but equivalent ways and
have often been tightly bound to the original document syntax. This
specification enables one to create cryptographic proofs that are not
bound to the original document syntax, which enables more advanced use cases
such as being able to use a single digital signature across a variety of
serialization syntaxes such as JSON and CBOR without the need to regenerate the
cryptographic proof. See section <a href="#transformations" data-matched-text="[[[#transformations]]]" class="sec-ref"><bdi class="secno">5.5 </bdi>Transformations</a> for an explanation of
the benefits of such an approach.
          </dd>
        </dl>

      <div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>Note</span><span class="issue-label">: Application of technology to broader use cases</span></div><p class="">
While this specification primarily focuses on <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a>, the
design of this technology is generalized, such that it can be used for other use
cases. In these instances, implementers are expected to perform their own due
diligence and expert review as to the applicability of the technology to their
use case.
      </p></div>

      </section>

      <section id="conformance"><div class="header-wrapper"><h3 id="x1-3-conformance"><bdi class="secno">1.3 </bdi>Conformance</h3><a class="self-link" href="#conformance" aria-label="Permalink for Section 1.3"></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
        The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class="rfc2119">OPTIONAL</em>, and <em class="rfc2119">SHOULD</em> in this document
        are to be interpreted as described in
        <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p>
        <p>
A <dfn data-plurals="conforming secured documents" id="dfn-conforming-secured-document" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">conforming secured document</dfn> is any <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence">byte sequence</a> that can be
converted to a
<a href="https://infra.spec.whatwg.org/#parse-json-bytes-to-a-javascript-value">
JSON document</a> that follows the relevant normative requirements in
Sections <a href="#proofs" data-matched-text="[[[#proofs]]]" class="sec-ref"><bdi class="secno">2.1 </bdi>Proofs</a>, <a href="#proof-purposes" data-matched-text="[[[#proof-purposes]]]" class="sec-ref"><bdi class="secno">2.2 </bdi>Proof Purposes</a>, <a href="#resource-integrity" data-matched-text="[[[#resource-integrity]]]" class="sec-ref"><bdi class="secno">2.3 </bdi>Resource Integrity</a>,
<a href="#contexts-and-vocabularies" data-matched-text="[[[#contexts-and-vocabularies]]]" class="sec-ref"><bdi class="secno">2.4 </bdi>Contexts and Vocabularies</a>, and <a href="#dataintegrityproof" data-matched-text="[[[#dataintegrityproof]]]" class="sec-ref"><bdi class="secno">3.1 </bdi>DataIntegrityProof</a>.
        </p>

        <p>
A <dfn class="lint-ignore" id="dfn-conforming-cryptographic-suite-specification" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">conforming cryptographic suite specification</dfn> is
any specification that follows the relevant normative requirements in Section
<a href="#cryptographic-suites" data-matched-text="[[[#cryptographic-suites]]]" class="sec-ref"><bdi class="secno">3. </bdi>Cryptographic Suites</a>.
        </p>

        <p>
A <dfn class="lint-ignore" data-plurals="conforming processors" id="dfn-conforming-processor" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">conforming processor</dfn> is any algorithm realized
as software and/or hardware that generates and/or consumes a
<a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-1">conforming secured document</a> according to the relevant normative statements
in Section <a href="#algorithms" data-matched-text="[[[#algorithms]]]" class="sec-ref"><bdi class="secno">4. </bdi>Algorithms</a>. Conforming processors <em class="rfc2119">MUST</em> produce errors when
non-conforming documents are consumed.
        </p>

      </section>

      <section id="terminology"><div class="header-wrapper"><h3 id="x1-4-terminology"><bdi class="secno">1.4 </bdi>Terminology</h3><a class="self-link" href="#terminology" aria-label="Permalink for Section 1.4"></a></div>
        

        <p>
This section defines the terms used in this specification. A link to these terms
is included whenever they appear in this specification.
        </p>

        <dl class="termlist definitions" data-sort="ascending"><dt><dfn id="dfn-controller-document" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">controller document</dfn></dt>

          <dd data-defines="#dfn-controller-document">
A document that contains public cryptographic material as defined in the
<cite><a data-matched-text="[[[CONTROLLER-DOCUMENT]]]" href="https://www.w3.org/TR/controller-document/">Controller Documents 1.0</a></cite> specification.
          </dd>

          <dt><dfn class="export" data-lt="cryptosuite|cryptographic suite" data-export="" data-plurals="cryptographic suites|cryptosuites" id="dfn-cryptosuite" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">cryptographic suite</dfn></dt>
          <dd data-defines="#dfn-cryptosuite">
A specification defining the usage of specific cryptographic primitives in
order to achieve a particular security goal. These documents are often used
to specify <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-1">verification methods</a>, digital signature types,
their identifiers, and other related properties. See Section
<a href="#cryptographic-suites" data-matched-text="[[[#cryptographic-suites]]]" class="sec-ref"><bdi class="secno">3. </bdi>Cryptographic Suites</a> for further detail.
          </dd>

          <dt><dfn class="export" data-export="" data-plurals="data integrity proofs" id="dfn-data-integrity-proof" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">data integrity proof</dfn></dt>
          <dd data-defines="#dfn-data-integrity-proof">
A set of attributes that represent a digital proof and the parameters required
to verify it. A <strong>digital signature</strong> is a type of data integrity
proof.
          </dd>
          <dt><dfn class="export" data-export="" data-plurals="proof purposes" id="dfn-proof-purpose" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">proof purpose</dfn></dt>
          <dd data-defines="#dfn-proof-purpose">
The specific intent for the proof; the reason why an entity created it. The
protected declaration acts as a safeguard to prevent the proof from being
misused for a purpose other than the one it was intended for.
          </dd>

          <dt><dfn id="dfn-public-key" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">public key</dfn></dt>
          <dd data-defines="#dfn-public-key">
Cryptographic material that can be used to verify digital proofs created with a
corresponding <a data-link-type="dfn|abstract-op" href="#dfn-secret-key" class="internalDFN" id="ref-for-dfn-secret-key-1">secret key</a>.
          </dd>
          <dt><dfn id="dfn-secret-key" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">secret key</dfn></dt>
          <dd data-defines="#dfn-secret-key">
Cryptographic material, sometimes referred to as a
<strong>private key</strong>, that is not to be shared with anyone, and is used
to generate digital proofs and/or digital signatures.
          </dd>
          <dt><dfn class="export" data-export="" data-plurals="verification methods" id="dfn-verification-method" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verification method</dfn></dt>

          <dd data-defines="#dfn-verification-method">
            <p>
A set of parameters that can be used together with a process to independently
verify a proof. For example, a cryptographic <a data-link-type="dfn|abstract-op" href="#dfn-public-key" class="internalDFN" id="ref-for-dfn-public-key-1">public key</a> can be used as a
verification method with respect to a digital signature; in such usage, it
verifies that the signer possessed the associated cryptographic <a data-link-type="dfn|abstract-op" href="#dfn-secret-key" class="internalDFN" id="ref-for-dfn-secret-key-2">secret key</a>.
            </p>
            <p>
"Verification" and "proof" in this definition are intended to apply broadly. For
example, a cryptographic public key might be used during Diffie-Hellman key
exchange to negotiate a shared symmetric key for encryption. This guarantees the
integrity of the key agreement process. It is thus another type of verification
method, even though descriptions of the process might not use the words
"verification" or "proof."
            </p>
          </dd>

          

          <dt><dfn data-lt="verifier|verifiers|verifier's" id="dfn-verifier" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verifier</dfn></dt>
          <dd data-defines="#dfn-verifier">
A role an entity performs by receiving data containing one or more
<a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-1">data integrity proofs</a> and then determining whether or not the proof
is legitimate.
          </dd>

          </dl>

      </section>
    </section>

    <section id="data-model"><div class="header-wrapper"><h2 id="x2-data-model"><bdi class="secno">2. </bdi>Data Model</h2><a class="self-link" href="#data-model" aria-label="Permalink for Section 2."></a></div>
      

      <p>
This section specifies the data model that is used for expressing
<a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-2">data integrity proofs</a> and the integrity of related resources.
      </p>

      <p>
All of the data model properties and types in this specification map to URLs.
The vocabulary where these URLs are defined is the <cite><a data-matched-text="[[[?SECURITY-VOCABULARY]]]" href="https://w3id.org/security">The Security Vocabulary</a></cite>.
The explicit mechanism that is used to perform this mapping in a secured
document is the <code>@context</code> property.
      </p>

      <p>
The mapping mechanism is defined by <cite><a data-matched-text="[[[JSON-LD11]]]" href="https://www.w3.org/TR/json-ld11/">JSON-LD 1.1</a></cite>. To ensure a document can be
interoperably consumed without the use of a JSON-LD library, document authors
are advised to ensure that domain experts have 1) specified the expected order
for all values associated with a <code>@context</code> property, 2) published cryptographic
hashes for each <code>@context</code> file, and 3) deemed that the contents of each
<code>@context</code> file are appropriate for the intended use case.
      </p>

      <p>
When a document is processed by a processor that does not utilize JSON-LD
libraries, and there is a requirement to use the same semantics as those used in
a JSON-LD environment, implementers are advised to 1) enforce the expected order
and values in the <code>@context</code> property, and 2) ensure that each <code>@context</code> file
matches the known cryptographic hashes for each <code>@context</code> file.
      </p>

      <p>
Using static, versioned, <code>@context</code> files with published cryptographic hashes in
conjunction with JSON Schema is one acceptable approach to implementing the
mechanisms described above, which ensures proper term identification, typing,
and order, when a processor that does not utilize a JSON-LD library is used.
See the section on
<a href="https://www.w3.org/TR/vc-data-model-2.0/#type-specific-credential-processing">
Type-Specific Processing</a> in <cite><a data-matched-text="[[[?VC-DATA-MODEL-2.0]]]" href="https://www.w3.org/TR/vc-data-model-2.0/">Verifiable Credentials Data Model v2.0</a></cite> for more details.
      </p>

      <section id="proofs"><div class="header-wrapper"><h3 id="x2-1-proofs"><bdi class="secno">2.1 </bdi>Proofs</h3><a class="self-link" href="#proofs" aria-label="Permalink for Section 2.1"></a></div>
        
        <p>
A <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-3">data integrity proof</a> provides information about the proof mechanism,
parameters required to verify that proof, and the proof value itself. All of
this information is provided using Linked Data vocabularies such as
<cite><a data-matched-text="[[[?SECURITY-VOCABULARY]]]" href="https://w3id.org/security">The Security Vocabulary</a></cite>.
        </p>

        <p>
When expressing a <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-4">data integrity proof</a> on an object, a
<dfn class="lint-ignore" data-plurals="proofs" id="dfn-proof" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><code>proof</code></dfn> property <em class="rfc2119">MUST</em> be used. The <code>proof</code>
property within a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a> is a <a data-link-type="dfn|abstract-op" href="#dfn-named-graph" class="internalDFN" id="ref-for-dfn-named-graph-1">named graph</a>. If present,
its value <em class="rfc2119">MUST</em> be either a single object, or an unordered set of objects,
expressed using the properties below:
        </p>

        <dl style="margin-left: 1em;">
          <dt>id</dt>
          <dd>
An optional identifier for the proof, which <em class="rfc2119">MUST</em> be a URL [<cite><a class="bibref" data-link-type="biblio" href="#bib-url" title="URL Standard">URL</a></cite>], such as
a UUID as a URN (<code>urn:uuid:6a1676b8-b51f-11ed-937b-d76685a20ff5</code>).
The usage of this property is further explained in Section <a href="#proof-chains" data-matched-text="[[[#proof-chains]]]" class="sec-ref"><bdi class="secno">2.1.2 </bdi>Proof Chains</a>.
          </dd>

          <dt>type</dt>
          <dd>
The specific type of proof <em class="rfc2119">MUST</em> be specified as a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> that maps to a URL
[<cite><a class="bibref" data-link-type="biblio" href="#bib-url" title="URL Standard">URL</a></cite>]. Examples of proof types include <code>DataIntegrityProof</code> and
<code>Ed25519Signature2020</code>. Proof types determine what other fields are required to
secure and verify the proof.
          </dd>

          <dt><dfn class="lint-ignore" id="dfn-proofpurpose" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">proofPurpose</dfn></dt>
          <dd>
The reason the proof was created <em class="rfc2119">MUST</em> be specified as a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> that maps to a
URL [<cite><a class="bibref" data-link-type="biblio" href="#bib-url" title="URL Standard">URL</a></cite>]. The proof purpose acts as a safeguard to prevent the proof from
being misused by being applied to a purpose other than the one that was
intended. For example, without this value the creator of a proof could be
tricked into using cryptographic material typically used to create a Verifiable
Credential (<code>assertionMethod</code>) during a login process (<code>authentication</code>) which
would then result in the creation of a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a> they never meant to
create instead of the intended action, which was to merely log in to a website.
          </dd>

          <dt>verificationMethod</dt>
          <dd>
A verification method is the means and information needed to verify the proof.
If included, the value <em class="rfc2119">MUST</em> be a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> that maps to a [<cite><a class="bibref" data-link-type="biblio" href="#bib-url" title="URL Standard">URL</a></cite>]. Inclusion of
<code>verificationMethod</code> is <em class="rfc2119">OPTIONAL</em>, but if it is not included, other properties
such as <code>cryptosuite</code> might provide a mechanism by which to obtain the information
necessary to verify the proof. Note that when <code>verificationMethod</code> is
expressed in a <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-5">data integrity proof</a>, the value points to the actual location
of the data; that is, the <code>verificationMethod</code> references, via a URL, the
location of the <a data-link-type="dfn|abstract-op" href="#dfn-public-key" class="internalDFN" id="ref-for-dfn-public-key-2">public key</a> that can be used to verify the proof. This
<a data-link-type="dfn|abstract-op" href="#dfn-public-key" class="internalDFN" id="ref-for-dfn-public-key-3">public key</a> data is stored in a <a data-link-type="dfn|abstract-op" href="#dfn-controller-document" class="internalDFN" id="ref-for-dfn-controller-document-1">controller document</a>, which contains a
full description of the verification method.
          </dd>

          <dt>cryptosuite</dt>
          <dd>
An identifier for the cryptographic suite that can be used to verify the proof. See
<a href="#cryptographic-suites" data-matched-text="[[[#cryptographic-suites]]]" class="sec-ref"><bdi class="secno">3. </bdi>Cryptographic Suites</a> for more information. If the proof <code>type</code> is
<code>DataIntegrityProof</code>, <code>cryptosuite</code> <em class="rfc2119">MUST</em> be specified; otherwise,  <code>cryptosuite</code>
<em class="rfc2119">MAY</em> be specified. If specified, its value <em class="rfc2119">MUST</em> be a string.
          </dd>

          <dt><dfn class="lint-ignore" id="dfn-created" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">created</dfn></dt>
          <dd>
The date and time the proof was created is <em class="rfc2119">OPTIONAL</em> and, if included, <em class="rfc2119">MUST</em> be
specified as an [<cite><a class="bibref" data-link-type="biblio" href="#bib-xmlschema11-2" title="W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes">XMLSCHEMA11-2</a></cite>] <code>dateTimeStamp</code> string, either in Universal
Coordinated Time (UTC), denoted by a Z at the end of the value, or with a time
zone offset relative to UTC. A <a data-link-type="dfn|abstract-op" href="#dfn-conforming-processor" class="internalDFN" id="ref-for-dfn-conforming-processor-1">conforming processor</a> <em class="rfc2119">MAY</em> chose to consume
time values that were incorrectly serialized without an offset. Incorrectly
serialized time values without an offset are to be interpreted as UTC.
          </dd>

          <dt id="defn-proof-expires">expires</dt>
          <dd>
The <code>expires</code> property is <em class="rfc2119">OPTIONAL</em> and, if present, specifies when the proof
expires. If present, it <em class="rfc2119">MUST</em> be an [<cite><a class="bibref" data-link-type="biblio" href="#bib-xmlschema11-2" title="W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes">XMLSCHEMA11-2</a></cite>] <code>dateTimeStamp</code> string,
either in Universal Coordinated Time (UTC), denoted by a Z at the end of the
value, or with a time zone offset relative to UTC. A <a data-link-type="dfn|abstract-op" href="#dfn-conforming-processor" class="internalDFN" id="ref-for-dfn-conforming-processor-2">conforming processor</a>
<em class="rfc2119">MAY</em> chose to consume time values that were incorrectly serialized without an
offset. Incorrectly serialized time values without an offset are to be
interpreted as UTC.
          </dd>

          <dt id="defn-domain">domain</dt>
          <dd>
The <code>domain</code> property is <em class="rfc2119">OPTIONAL</em>. It conveys one or more security domains in which the
proof is meant to be used. If specified, the associated value <em class="rfc2119">MUST</em> be either a
string, or an unordered set of strings. A verifier <em class="rfc2119">SHOULD</em> use the value to
ensure that the proof was intended to be used in the security domain in which
the verifier is operating. The specification of the <code>domain</code> parameter is useful
in challenge-response protocols where the verifier is operating from within a
security domain known to the creator of the proof. Example domain values
include: <code>domain.example</code> (DNS domain), <code>https://domain.example:8443</code>
(Web origin), <code>mycorp-intranet</code> (bespoke text string), and
<code>b31d37d4-dd59-47d3-9dd8-c973da43b63a</code> (UUID).
          </dd>

          <dt id="defn-challenge"><dfn id="dfn-challenge" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">challenge</dfn></dt>
          <dd>
A <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> value that <em class="rfc2119">SHOULD</em> be included in a proof if a <code>domain</code> is specified.
The value is used once for a particular <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://url.spec.whatwg.org/#concept-domain">domain</a> and window of time. This
value is used to mitigate replay attacks. Examples of a challenge value include:
<code>1235abcd6789</code>, <code>79d34551-ae81-44ae-823b-6dadbab9ebd4</code>, and <code>ruby</code>.
          </dd>

          <dt><dfn class="lint-ignore" id="dfn-proofvalue" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">proofValue</dfn></dt>
          <dd>
A <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> value that expresses base-encoded binary data necessary to verify the
digital proof using the <code>verificationMethod</code> specified. The value <em class="rfc2119">MUST</em> use a
header and encoding as described in Section
<a href="https://www.w3.org/TR/controller-document/#multibase-0">2.4 Multibase</a> of the
<cite><a data-matched-text="[[[CONTROLLER-DOCUMENT]]]" href="https://www.w3.org/TR/controller-document/">Controller Documents 1.0</a></cite> specification to express the binary data.
The contents of this value are determined by a specific cryptosuite and set
to the <em>proof value</em> generated by the <a href="#add-proof">Add Proof Algorithm</a>
for that cryptosuite. Alternative properties with different encodings specified by the
cryptosuite <em class="rfc2119">MAY</em> be used, instead of this property, to encode the data necessary
to verify the digital proof.
          </dd>

          <dt><dfn class="lint-ignore" id="dfn-previousproof" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">previousProof</dfn></dt>
          <dd>
The <code>previousProof</code> property is <em class="rfc2119">OPTIONAL</em>. If present, it <em class="rfc2119">MUST</em> be a string
value or an unordered list of string values. Each value identifies another
<a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-6">data integrity proof</a>, all of which <em class="rfc2119">MUST</em> also verify for the current
proof to be considered verified. This property is used in Section
<a href="#proof-chains" data-matched-text="[[[#proof-chains]]]" class="sec-ref"><bdi class="secno">2.1.2 </bdi>Proof Chains</a>.
          </dd>

          <dt><dfn class="lint-ignore" id="dfn-nonce" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">nonce</dfn></dt>
          <dd>
An <em class="rfc2119">OPTIONAL</em> <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> value supplied by the proof creator. One use of this
field is to increase privacy by decreasing linkability that is the result
of deterministically generated signatures.
          </dd>

        </dl>

        <p>
A proof can be added to a JSON document like the following:
        </p>

        <div class="example" id="example-a-simple-json-data-document">
        <div class="marker">
    <a class="self-link" href="#example-a-simple-json-data-document">Example<bdi> 1</bdi></a><span class="example-title">: A simple JSON data document</span>
  </div> <pre class="nohighlight">{
  "myWebsite": "https://hello.world.example/"
};</pre>
      </div>

        <p>
The following proof secures the document above using the <code>eddsa-jcs-2022</code>
cryptography suite [<cite><a class="bibref" data-link-type="biblio" href="#bib-di-eddsa" title="The Edwards Digital Signature Algorithm Cryptosuites v1.0">DI-EDDSA</a></cite>], which produces a verifiable digital proof by
transforming the input data using the JSON Canonicalization Scheme (JCS)
[<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8785" title="JSON Canonicalization Scheme (JCS)">RFC8785</a></cite>] and then digitally signing it using an Edwards Digital Signature
Algorithm (EdDSA).
        </p>

        <div class="example" id="example-a-simple-signed-json-data-document">
        <div class="marker">
    <a class="self-link" href="#example-a-simple-signed-json-data-document">Example<bdi> 2</bdi></a><span class="example-title">: A simple signed JSON data document</span>
  </div> <pre class="nohighlight">{
  "myWebsite": "https://hello.world.example/",
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "eddsa-jcs-2022",
    "created": "2023-03-05T19:23:24Z",
    "verificationMethod": "https://di.example/issuer#z6MkjLrk3gKS2nnkeWcm<wbr>cxiZPGskmesDpuwRBorgHxUXfxnG",
    "proofPurpose": "assertionMethod",
    "proofValue": "zQeVbY4oey5q2M3XKaxup3tmzN4DRFTLVqpLMweBrSxMY2xHX5XTYV<wbr>8nQApmEcqaqA3Q1gVHMrXFkXJeV6doDwLWx"
  }
}</pre>
      </div>

        <p>
Similarly, a proof can be added to a JSON-LD data document like the following:
        </p>

        <div class="example" id="example-a-simple-json-ld-data-document">
        <div class="marker">
    <a class="self-link" href="#example-a-simple-json-ld-data-document">Example<bdi> 3</bdi></a><span class="example-title">: A simple JSON-LD data document</span>
  </div> <pre class="nohighlight">{
  "@context": {"myWebsite": "https://vocabulary.example/myWebsite"},
  "myWebsite": "https://hello.world.example/"
};</pre>
      </div>

        <p>
The following proof secures the document above by using the <code>ecdsa-rdfc-2019</code>
cryptography suite [<cite><a class="bibref" data-link-type="biblio" href="#bib-di-ecdsa" title="The Elliptic Curve Digital Signature Algorithm Cryptosuites v1.0">DI-ECDSA</a></cite>], which produces a verifiable digital proof by
transforming the input data using the RDF Dataset Canonicalization Scheme
[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] and then digitally signing it using the Elliptic Curve Digital
Signature Algorithm (ECDSA).
        </p>

        <div class="example" id="example-a-simple-signed-json-ld-data-document">
        <div class="marker">
    <a class="self-link" href="#example-a-simple-signed-json-ld-data-document">Example<bdi> 4</bdi></a><span class="example-title">: A simple signed JSON-LD data document</span>
  </div> <pre class="nohighlight">{
  "@context": [
    {"myWebsite": "https://vocabulary.example/myWebsite"},
    "https://w3id.org/security/data-integrity/v2"
  ],
  "myWebsite": "https://hello.world.example/",
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "ecdsa-rdfc-2019",
    "created": "2020-06-11T19:14:04Z",
    "verificationMethod": "https://ldi.example/issuer#zDnaepBuvsQ8cpsWrVK<wbr>w8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
    "proofPurpose": "assertionMethod",
    "proofValue": "zXb23ZkdakfJNUhiTEdwyE598X7RLrkjnXEADLQZ7vZyUGXX8cyJZR<wbr>BkNw813SGsJHWrcpo4Y8hRJ7adYn35Eetq"
  }
}</pre>
      </div>

        <div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="4"><span>Note</span><span class="issue-label">: Representing time values to individuals</span></div><p class="">
This specification enables the expression of dates and times, such as through
the <code>created</code> and <code>expires</code> properties. This information might be indirectly
exposed to an individual if a proof is processed and is detected to be outside
an allowable time range. When displaying date and time values related to the
validity of cryptographic proofs, implementers are advised to respect the
<a href="https://www.w3.org/TR/ltli/#locale">locale</a>
and local calendar preferences of the individual [<cite><a class="bibref" data-link-type="biblio" href="#bib-ltli" title="Language Tags and Locale Identifiers for the World Wide Web">LTLI</a></cite>]. Conversion of
timestamps to local time values are expected to consider the time zone
expectations of the individual. See
<a href="https://www.w3.org/TR/vc-data-model-2.0/#representing-time">Verifiable Credentials Data Model v2.0</a> for more details about
representing time values to individuals.
        </p></div>

        <div class="example" id="example-a-data-document-with-an-attached-proof-that-uses-the-expires-property">
        <div class="marker">
    <a class="self-link" href="#example-a-data-document-with-an-attached-proof-that-uses-the-expires-property">Example<bdi> 5</bdi></a><span class="example-title">: A data document with an attached proof that uses the 'expires' property</span>
  </div> <pre class="nohighlight">{
  "@context": [
    {"myWebsite": "https://vocabulary.example/myWebsite"},
    "https://w3id.org/security/data-integrity/v2"
  ],
  "myWebsite": "https://hello.world.example/",
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "ecdsa-rdfc-2019",
    "created": "2020-06-11T19:14:04Z",
    <span class="comment">// the proof expires a month after it was created</span>
    <span class="highlight">"expires": "2020-07-11T19:14:04Z"</span>,
    "verificationMethod": "https://ldi.example/issuer#zDnaepBuvsQ8cpsWrVK<wbr>w8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
    "proofPurpose": "assertionMethod",
    "proofValue": "z98X7RLrkjnXEADJNUhiTEdwyE5GXX8cyJZRLQZ7vZyUXb23Zkdakf<wbr>RJ7adYY8hn35EetqBkNw813SGsJHWrcpo4"
  }
}</pre>
      </div>

      <p>
The Data Integrity specification supports the concept of multiple
proofs in a single document. There are two types of multi-proof
approaches that are identified: Proof Sets (un-ordered) and Proof Chains
(ordered).
      </p>

      <section id="proof-sets"><div class="header-wrapper"><h4 id="x2-1-1-proof-sets"><bdi class="secno">2.1.1 </bdi>Proof Sets</h4><a class="self-link" href="#proof-sets" aria-label="Permalink for Section 2.1.1"></a></div>
        
        <p>
A <dfn id="dfn-proof-set" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">proof set</dfn> is useful when the same data needs to be secured by
multiple entities, but where the order of proofs does not matter, such as in the
case of a set of signatures on a contract. A proof set, which has no order, is
represented by associating a set of proofs with the <code>proof</code> key in a document.
        </p>
        <div class="example" id="example-a-proof-set-in-a-data-document">
        <div class="marker">
    <a class="self-link" href="#example-a-proof-set-in-a-data-document">Example<bdi> 6</bdi></a><span class="example-title">: A proof set in a data document</span>
  </div> <pre class="nohighlight">{
  "@context": [
    {"myWebsite": "https://vocabulary.example/myWebsite"},
    "https://w3id.org/security/data-integrity/v2"
  ],
  "myWebsite": "https://hello.world.example/",
  <span class="highlight">"proof": [{
    <span class="comment">// This is one of the proofs in the set</span>
    "type": "DataIntegrityProof",
    "cryptosuite": "eddsa-rdfc-2022",
    "created": "2020-11-05T19:23:24Z",
    "verificationMethod": "https://ldi.example/issuer/1#z6MkjLrk3gKS2nnkeW<wbr>cmcxiZPGskmesDpuwRBorgHxUXfxnG",
    "proofPurpose": "assertionMethod",
    "proofValue": "z4oey5q2M3XKaxup3tmzN4DRFTLVqpLMweBrSxMY2xHX5XTYVQeVbY8<wbr>nQAVHMrXFkXJpmEcqdoDwLWxaqA3Q1geV6"
  }, {
    <span class="comment">// This is the other proof in the set</span>
    "type": "DataIntegrityProof",
    "cryptosuite": "eddsa-rdfc-2022",
    "created": "2020-11-05T13:08:49Z",
    "verificationMethod": "https://pfps.example/issuer/2#z6MkGskxnGjLrk3gK<wbr>S2mesDpuwRBokeWcmrgHxUXfnncxiZP",
    "proofPurpose": "assertionMethod",
    "proofValue": "z5QLBrp19KiWXerb8ByPnAZ9wujVFN8PDsxxXeMoyvDqhZ6Qnzr5CG9<wbr>876zNht8BpStWi8H2Mi7XCY3inbLrZrm95"
  }]</span>
}</pre>
      </div>

      </section>

      <section id="proof-chains"><div class="header-wrapper"><h4 id="x2-1-2-proof-chains"><bdi class="secno">2.1.2 </bdi>Proof Chains</h4><a class="self-link" href="#proof-chains" aria-label="Permalink for Section 2.1.2"></a></div>
        
        <p>
A <dfn id="dfn-proof-chain" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">proof chain</dfn> is useful when the same data needs to be signed by
multiple entities and the order of when the proofs occurred matters, such as in
the case of a notary counter-signing a proof that had been created on a
document. A proof chain, where proof order needs to be preserved, is expressed
by providing at least one proof with an <code>id</code>, such as a UUID [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc9562" title="Universally Unique IDentifiers (UUIDs)">RFC9562</a></cite>], and
another proof with a <code>previousProof</code> value that identifies the previous proof.
        </p>
        <div class="example" id="example-a-proof-chain-in-a-data-document">
        <div class="marker">
    <a class="self-link" href="#example-a-proof-chain-in-a-data-document">Example<bdi> 7</bdi></a><span class="example-title">: A proof chain in a data document</span>
  </div> <pre class="nohighlight">{
  "@context": [
    {"myWebsite": "https://vocabulary.example/myWebsite"},
    "https://w3id.org/security/data-integrity/v2"
],
  "myWebsite": "https://hello.world.example/",
  <span class="highlight">"proof": [{
    <span class="comment">// The 'id' value identifies this specific proof</span>
    "id": "urn:uuid:60102d04-b51e-11ed-acfe-2fcd717666a7",
    "type": "DataIntegrityProof",
    "cryptosuite": "eddsa-rdfc-2022",
    "created": "2020-11-05T19:23:42Z",
    "verificationMethod": "https://ldi.example/issuer/1#z6MkjLrk3gKS2nnke<wbr>WcmcxiZPGskmesDpuwRBorgHxUXfxnG",
    "proofPurpose": "assertionMethod",
    "proofValue": "zVbY8nQAVHMrXFkXJpmEcqdoDwLWxaqA3Q1geV64oey5q2M3XKaxup<wbr>3tmzN4DRFTLVqpLMweBrSxMY2xHX5XTYVQe"
  }, {
    "type": "DataIntegrityProof",
    "cryptosuite": "eddsa-rdfc-2022",
    "created": "2020-11-05T21:28:14Z",
    "verificationMethod": "https://pfps.example/issuer/2#z6MkGskxnGjLrk3g<wbr>KS2mesDpuwRBokeWcmrgHxUXfnncxiZP",
    "proofPurpose": "assertionMethod",
    "proofValue": "z6Qnzr5CG9876zNht8BpStWi8H2Mi7XCY3inbLrZrm955QLBrp19Ki<wbr>WXerb8ByPnAZ9wujVFN8PDsxxXeMoyvDqhZ",
    <span class="comment">// The 'previousProof' value identifies which proof is verified before this one</span>
    "previousProof": "urn:uuid:60102d04-b51e-11ed-acfe-2fcd717666a7"
  }]</span>
}</pre>
      </div>

      </section>

      <section id="proof-graphs"><div class="header-wrapper"><h4 id="x2-1-3-proof-graphs"><bdi class="secno">2.1.3 </bdi>Proof Graphs</h4><a class="self-link" href="#proof-graphs" aria-label="Permalink for Section 2.1.3"></a></div>
        

        <p>
When securing data in a document, it is important to clearly delineate the data
being protected, which is every graph expressed in the document except the
one containing the data associated with a securing mechanism, which is called
a <dfn class="export" data-export="" data-plurals="proof graphs" id="dfn-proof-graph" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">proof graph</dfn>. Creating this separation enables the
processing algorithms to deterministically protect and verify a secured
document.
        </p>

        <p>
The information contained in an input document before a
<a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-7">data integrity proof</a> is added to the document is expressed in one or more
graphs. To ensure that information from different <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-8">data integrity proofs</a> is not
accidentally co-mingled, the concept of a <a data-link-type="dfn|abstract-op" href="#dfn-proof-graph" class="internalDFN" id="ref-for-dfn-proof-graph-1">proof graph</a> is used to encapsulate
each <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-9">data integrity proof</a>. Each value associated with the <code>proof</code> property of the
document identifies a separate graph, which is sometimes referred to as a
<dfn class="export" data-export="" data-plurals="named graphs" id="dfn-named-graph" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">named graph</dfn>, of type
<dfn class="export" data-export="" id="dfn-proofgraph" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">ProofGraph</dfn>, which contains a single <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-10">data integrity proof</a>.
        </p>

        <p>
Using these graphs has a concrete effect when performing JSON-LD processing, as
this properly separates statements expressed in one graph from those in another
graph. Implementers that limit their processing to other media types, such as
JSON, YAML, or CBOR, will need to keep this in mind if they merge data from one
document with data from another, such as when an <code>id</code> value string is the same
in both documents. It is important to not merge objects that seem to have similar
properties, when those objects do not have an <code>id</code> property and/or use a global
identifier type such as a URL, as without these, is not possible to tell whether
two such objects are expressing information about the same entity.
        </p>
      </section>

    </section>

      <section id="proof-purposes"><div class="header-wrapper"><h3 id="x2-2-proof-purposes"><bdi class="secno">2.2 </bdi>Proof Purposes</h3><a class="self-link" href="#proof-purposes" aria-label="Permalink for Section 2.2"></a></div>
        

        <p>
A proof that describes its purpose helps prevent it from being misused for some
other purpose. <a data-link-type="dfn|abstract-op" href="#dfn-proof-purpose" class="internalDFN" id="ref-for-dfn-proof-purpose-1">Proof purposes</a> enable <a data-link-type="dfn|abstract-op" href="#dfn-verifier" class="internalDFN" id="ref-for-dfn-verifier-1">verifiers</a> to know the
intent of the creator of a proof so a message cannot be accidentally abused for
another purpose. For example, a message signed for the purpose of merely making an
assertion (perhaps intended to be widely shared) being abused as a
message to authenticate to a service or take some action (such as invoking a
capability to do something).
        </p>

        <p>
It is important to note that <a data-link-type="dfn|abstract-op" href="#dfn-proof-purpose" class="internalDFN" id="ref-for-dfn-proof-purpose-2">proof purposes</a> are a different mechanism from
the <code>key_ops</code> restrictions in <cite><a data-matched-text="[[[?RFC7517]]]" href="https://www.rfc-editor.org/rfc/rfc7517">JSON Web Key (JWK)</a></cite>, the <code>KeyUsage</code> restriction in the
<cite><a data-matched-text="[[[?WEBCRYPTOAPI]]]" href="https://www.w3.org/TR/WebCryptoAPI/">Web Cryptography API</a></cite> and the <cite><a data-matched-text="[[[?RFC5280]]]" href="https://www.rfc-editor.org/rfc/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a></cite>. <a data-link-type="dfn|abstract-op" href="#dfn-proof-purpose" class="internalDFN" id="ref-for-dfn-proof-purpose-3">Proof purposes</a> are expressions
on why a <a data-link-type="dfn|abstract-op" href="#dfn-proof" class="internalDFN" id="ref-for-dfn-proof-1">proof</a> was created and its intended domain of usage whereas the
other mechanisms mentioned are intended to limit what a private key can be used
to do. A <a data-link-type="dfn|abstract-op" href="#dfn-proof-purpose" class="internalDFN" id="ref-for-dfn-proof-purpose-4">proof purpose</a> "travels" with the <a data-link-type="dfn|abstract-op" href="#dfn-proof" class="internalDFN" id="ref-for-dfn-proof-2">proof</a> while a key restriction
does not.
        </p>

        <p>
The following is a list of commonly used <a data-link-type="dfn|abstract-op" href="#dfn-proof-purpose" class="internalDFN" id="ref-for-dfn-proof-purpose-5">proof purpose</a> values.
        </p>

        <dl>
          <dt><dfn class="external" id="dfn-authentication" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">authentication</dfn></dt>
          <dd>
Indicates that a given proof is only to be used for the purposes of an
authentication protocol.
          </dd>
          <dt><dfn class="external lint-ignore" id="dfn-assertionmethod" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">assertionMethod</dfn></dt>
          <dd>
Indicates that a proof can only be used for making assertions, for example
signing a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a>.
          </dd>
          <dt><dfn class="external lint-ignore" id="dfn-keyagreement" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">keyAgreement</dfn></dt>
          <dd>
Indicates that a proof is used for for key agreement protocols, such as
Elliptic Curve Diffie Hellman key agreement used by popular encryption
libraries.
          </dd>
          <dt><dfn class="external lint-ignore" id="dfn-capabilitydelegation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">capabilityDelegation</dfn></dt>
          <dd>
Indicates that the proof can only be used for delegating capabilities. See the
Authorization Capabilities [<cite><a class="bibref" data-link-type="biblio" href="#bib-zcap" title="Authorization Capabilities for Linked Data">ZCAP</a></cite>] specification for more detail.
          </dd>
          <dt><dfn class="external lint-ignore" id="dfn-capabilityinvocation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">capabilityInvocation</dfn></dt>
          <dd>
Indicates that the proof can only be used for invoking capabilities. See the
Authorization Capabilities [<cite><a class="bibref" data-link-type="biblio" href="#bib-zcap" title="Authorization Capabilities for Linked Data">ZCAP</a></cite>] specification for more detail.
          </dd>
        </dl>

      </section>

      <section id="resource-integrity"><div class="header-wrapper"><h3 id="x2-3-resource-integrity"><bdi class="secno">2.3 </bdi>Resource Integrity</h3><a class="self-link" href="#resource-integrity" aria-label="Permalink for Section 2.3"></a></div>
        

        <p>
When a link to an external resource is included in a
<a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-2">conforming secured document</a>, it is desirable to know whether the resource
that is identified has changed since the proof was created. This applies to
cases where there is an external resource that is remotely retrieved as well as
to cases where the <a data-link-type="dfn|abstract-op" href="#dfn-verifier" class="internalDFN" id="ref-for-dfn-verifier-2">verifier</a> might have a locally cached copy of the
resource.
        </p>
        <p>
To enable confirmation that a resource referenced by a <a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-3">conforming secured document</a>
has not changed since the document was secured, an implementer <em class="rfc2119">MAY</em> include a
property named <dfn class="lint-ignore" id="dfn-digestmultibase" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><code>digestMultibase</code></dfn> in any object
that includes an <code>id</code> property. If present, the <code>digestMultibase</code> value <em class="rfc2119">MUST</em> be
a single <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> value, or an <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> of <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> values, each of which is a
<a href="https://www.w3.org/TR/controller-document/#multibase">Multibase</a>-encoded
<a href="https://www.w3.org/TR/controller-document/#multihash">Multihash</a> value.
        </p>
        <p>
JSON-LD context authors are expected to add <code>digestMultibase</code> to contexts that
will be used in documents that refer to other resources and to include an
associated cryptographic digest. For example, the <cite><a data-matched-text="[[[?VC-DATA-MODEL-2.0]]]" href="https://www.w3.org/TR/vc-data-model-2.0/">Verifiable Credentials Data Model v2.0</a></cite> base
context (<code>https://www.w3.org/ns/credentials/v2</code>) includes the
<code>digestMultibase</code> property.
        </p>

        <p>
An example of a resource integrity protected object is shown below:
        </p>

        <div class="example" id="example-an-integrity-protected-image-that-is-associated-with-an-object">
        <div class="marker">
    <a class="self-link" href="#example-an-integrity-protected-image-that-is-associated-with-an-object">Example<bdi> 8</bdi></a><span class="example-title">: An integrity-protected image that is associated with an object</span>
  </div> <pre class="nohighlight">{
  ...
  "image": {
    "id": "https://university.example.org/images/58473",
    <span class="highlight">"digestMultibase": "zQmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"</span>
  },
  ...
}</pre>
      </div>

        <p>
Implementers are urged to consult appropriate sources, such as the
<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">
FIPS 180-4 Secure Hash Standard</a> and the
<a href="https://media.defense.gov/2022/Sep/07/2003071834/-1/-1/0/CSA_CNSA_2.0_ALGORITHMS_.PDF">
Commercial National Security Algorithm Suite 2.0</a> to ensure that they are
choosing a hash algorithm that is appropriate for their use case.
        </p>

      </section>

      <section id="contexts-and-vocabularies"><div class="header-wrapper"><h3 id="x2-4-contexts-and-vocabularies"><bdi class="secno">2.4 </bdi>Contexts and Vocabularies</h3><a class="self-link" href="#contexts-and-vocabularies" aria-label="Permalink for Section 2.4"></a></div>
        

        <div class="issue" id="issue-container-number-2"><div role="heading" class="issue-title marker" id="h-issue-0" aria-level="4"><span>Issue 2</span><span class="issue-label">: (AT RISK) Hash values might change during Candidate Recommendation</span></div><p class="">
This section lists cryptographic hash values that might change during the
Candidate Recommendation phase based on implementer feedback that requires
the referenced files to be modified.
        </p></div>
        <p>
Implementations that perform JSON-LD processing <em class="rfc2119">MUST</em> treat the following
JSON-LD context URLs as already resolved, where the resolved document matches
the corresponding hash values below:
        </p>

        <table class="simple">
          <thead>
            <tr><th>Context URL and Hash</th>
          </tr></thead>
          <tbody>
            <tr>
              <td style="white-space: nowrap;">
<strong>URL:</strong> https://w3id.org/security/data-integrity/v2<br>
<strong>SHA2-256 Digest:</strong> <code><span class="vc-hash" data-hash-url="https://w3id.org/security/data-integrity/v2" data-hash-format="openssl dgst -sha256">67f21e6e33a6c14e5ccfd2fc7865f7474fb71a04af7e94136cb399dfac8ae8f4</span></code>
              </td>
            </tr>
            <tr>
              <td style="white-space: nowrap;">
<strong>URL:</strong> https://w3id.org/security/multikey/v1<br>
<strong>SHA2-256 Digest:</strong> <code><span class="vc-hash" data-hash-url="https://w3id.org/security/multikey/v1" data-hash-format="openssl dgst -sha256">ba2c182de2d92f7e47184bcca8fcf0beaee6d3986c527bf664c195bbc7c58597</span></code>
              </td>
            </tr>
            <tr>
              <td style="white-space: nowrap;">
<strong>URL:</strong> https://w3id.org/security/jwk/v1<br>
<strong>SHA2-256 Digest:</strong> <code><span class="vc-hash" data-hash-url="https://w3id.org/security/jwk/v1" data-hash-format="openssl dgst -sha256">0f14b62f6071aafe00df265770ea0c7508e118247d79b7d861a406d2aa00bece</span></code>
              </td>
            </tr>
          </tbody>
        </table>

        <p>
It is possible to confirm the cryptographic digests listed above by running a
command like the following (replacing <code>&lt;DOCUMENT_URL&gt;</code> with the appropriate
value) through a modern UNIX-like OS command line interface: <code>curl -sL -H
"Accept: application/ld+json" &lt;DOCUMENT_URL&gt; | openssl dgst -sha256</code>
        </p>

        <p>
The security vocabulary terms that the JSON-LD contexts listed above resolve
to are in the <a href="https://w3id.org/security">https://w3id.org/security#</a>
namespace. That is, all security terms in this vocabulary are of the form
<code>https://w3id.org/security#TERM</code>, where <code>TERM</code> is the name of a term.
        </p>

        <p>
Implementations that perform RDF processing <em class="rfc2119">MUST</em> treat
the JSON-LD serialization of the vocabulary URL as already dereferenced, where the dereferenced document matches
the corresponding hash value below.
        </p>

        <div class="note" role="note" id="issue-container-generatedID-1"><div role="heading" class="note-title marker" id="h-note-1" aria-level="4"><span>Note</span></div><p class="">
Beyond the security terms defined by this specification, the
<a href="https://w3id.org/security">https://w3id.org/security#</a> namespace
also includes the terms defined in the <cite><a data-matched-text="[[[CONTROLLER-DOCUMENT]]]" href="https://www.w3.org/TR/controller-document/">Controller Documents 1.0</a></cite>&nbsp;[<cite><a class="bibref" data-link-type="biblio" href="#bib-controller-document" title="Controller Documents 1.0">CONTROLLER-DOCUMENT</a></cite>]
specification, with the corresponding mappings in the context files listed above.
        </p></div>

        <p>
When dereferencing the
<a href="https://w3id.org/security">https://w3id.org/security#</a> URL,
the media type of the data that is returned depends on HTTP content negotiation. These are as follows:
        </p>

        <table class="simple">
          <thead>
            <tr>
              <th>Media Type</th>
              <th>Description and Hash</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
application/ld+json
              </td>
              <td>
The vocabulary in JSON-LD format [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld11" title="JSON-LD 1.1">JSON-LD11</a></cite>].<br><br>

<strong>SHA2-256 Digest:</strong> <code><span class="vc-hash" data-hash-url="https://w3c.github.io/vc-data-integrity/vocab/security/vocabulary.jsonld" data-hash-format="openssl dgst -sha256">10a012489a3abe38f9871b986f27fbfa49a54d8d9edbe857a60bb2ce7baed416</span></code>
              </td>
            </tr>
            <tr>
              <td>
text/turtle
              </td>
              <td>
The vocabulary in Turtle format [<cite><a class="bibref" data-link-type="biblio" href="#bib-turtle" title="RDF 1.1 Turtle">TURTLE</a></cite>].<br><br>

<strong>SHA2-256 Digest:</strong> <code><span class="vc-hash" data-hash-url="https://w3c.github.io/vc-data-integrity/vocab/security/vocabulary.ttl" data-hash-format="openssl dgst -sha256">2f7e055d789cbde920ac0279bfd147f56e07140811abcf273a8d8164a4afdfcb</span></code>
              </td>
            </tr>
            <tr>
              <td>
text/html
              </td>
              <td>
The vocabulary in HTML+RDFa Format [<cite><a class="bibref" data-link-type="biblio" href="#bib-html-rdfa" title="HTML+RDFa 1.1 - Second Edition">HTML-RDFA</a></cite>].<br><br>


<strong>SHA2-256 Digest:</strong> <code><span class="vc-hash" data-hash-url="https://w3c.github.io/vc-data-integrity/vocab/security/vocabulary.html" data-hash-format="openssl dgst -sha256">eeea4710c7cb7640bb70f9d016e86eab7dc06ab804dc70057cc7c05cce1f8489</span></code>
              </td>
            </tr>
          </tbody>
        </table>

        <p>
It is possible to confirm the cryptographic digests listed above by running
a command like the following (replacing <code>&lt;MEDIA_TYPE&gt;</code> and <code>&lt;DOCUMENT_URL&gt;</code>
with the appropriate values) through a modern UNIX-like OS command line interface:
<code>curl -sL -H "Accept: &lt;MEDIA_TYPE&gt;" &lt;DOCUMENT_URL&gt; | openssl dgst -sha256</code>
        </p>

        <p>
Authors of application-specific vocabularies and specifications <em class="rfc2119">SHOULD</em> ensure
that their JSON-LD context and vocabulary files are permanently cacheable
using the approaches to caching described above or a functionally equivalent
mechanism.
        </p>

        <p>
Implementations <em class="rfc2119">MAY</em> load application-specific JSON-LD context files from the
network during development, but <em class="rfc2119">SHOULD</em> permanently cache JSON-LD context files
used by <a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-4">conforming secured documents</a> in production settings, to increase
their security and privacy characteristics. Goals of processing speed <em class="rfc2119">MAY</em> be
achieved through caching approaches such as those described above or
functionally equivalent mechanisms.
        </p>
        <p>
Some applications, such as digital wallets, that are capable of holding arbitrary
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a> or other data-integrity-protected documents, from
any issuer and using any contexts, might need to be able to load externally
linked resources, such as JSON-LD context files, in production settings. This is
expected to increase user choice, scalability, and decentralized upgrades in the
ecosystem over time. Authors of such applications are advised to read the
security and privacy sections of this document for further considerations.
        </p>

        <p>
For further information regarding processing of JSON-LD contexts and
vocabularies, see <a href="https://www.w3.org/TR/vc-data-model-2.0/#base-context">Verifiable
Credentials v2.0: Base Context</a> and <a href="https://www.w3.org/TR/vc-data-model-2.0/#vocabularies">
Verifiable Credentials v2.0: Vocabularies</a>.
        </p>

        <section id="validating-contexts"><div class="header-wrapper"><h4 id="x2-4-1-validating-contexts"><bdi class="secno">2.4.1 </bdi>Validating Contexts</h4><a class="self-link" href="#validating-contexts" aria-label="Permalink for Section 2.4.1"></a></div>
          

          <p>
It is necessary to ensure that a consuming application has explicitly approved
of the types, and therefore the semantics, of input documents that it will
process. Not checking JSON-LD context values against known good values can lead
to security vulnerabilities, due to variance in the semantics that they convey.
Applications <em class="rfc2119">MUST</em> use the algorithm in Section <a href="#context-validation" data-matched-text="[[[#context-validation]]]" class="sec-ref"><bdi class="secno">4.6 </bdi>Context Validation</a>, or one
that achieves equivalent protections, to validate contexts in a <a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-5">conforming secured document</a>. Context validation <em class="rfc2119">MUST</em> be run <em>after</em> running the
applicable algorithm in either Section <a href="#verify-proof" data-matched-text="[[[#verify-proof]]]" class="sec-ref"><bdi class="secno">4.4 </bdi>Verify Proof</a> or Section
<a href="#verify-proof-sets-and-chains" data-matched-text="[[[#verify-proof-sets-and-chains]]]" class="sec-ref"><bdi class="secno">4.5 </bdi>Verify Proof Sets and Chains</a>.
          </p>

          <p>
While the algorithm described in Section <a href="#context-validation" data-matched-text="[[[#context-validation]]]" class="sec-ref"><bdi class="secno">4.6 </bdi>Context Validation</a> provides one
way of checking context values, and one optional way of safely processing
unknown context values, implementers <em class="rfc2119">MAY</em> use alternative approaches, or a
different ordering of the steps, that provide the same protections.
          </p>

          <p>
For example, if no JSON-LD processing is to occur, then, rather than performing
this check, an application could follow the guidance in whatever trusted
documentation is provided out of band for properly understanding the semantics
of that type of document.
          </p>

          <p>
Another approach would be to configure an application to use a JSON-LD Context
loader, sometimes referred to as a document loader, to use only local copies of
approved context files. This would guarantee that neither the context files nor
their cryptographic hashes would ever change, effectively resulting in the same
result as the algorithm in Section <a href="#context-validation" data-matched-text="[[[#context-validation]]]" class="sec-ref"><bdi class="secno">4.6 </bdi>Context Validation</a>.
          </p>

          <p>
Another alternative approach, also effectively equivalent to the algorithm in
Section <a href="#context-validation" data-matched-text="[[[#context-validation]]]" class="sec-ref"><bdi class="secno">4.6 </bdi>Context Validation</a>, would be for an application to keep a list of
well known context URLs and their associated approved cryptographic hashes,
without storing every context file locally. This would allow these contexts to
be safely loaded from the network without compromising the security expectations
of the application.
          </p>

          <p>
Yet another valid approach would be for a transmitting application to
<a href="https://www.w3.org/TR/json-ld11-api/#compaction-algorithm">compact</a> a document to
exactly what a receiving application requests, via a protocol such as one
requesting a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-presentation">verifiable presentation</a>, omitting additional sender-specific
context values that were used when securing the original document. As long as
the cryptography suite's verification algorithm provides a successful
verification result, such transformations are valid and would result in full
URLs for terms that were previously compacted by the omitted context. That is, a
term that was previously compacted to <code>foo</code> based on a sender-supplied context
that is unknown to a receiver (e.g., `<code>https://ontology.example/v1</code>) would
instead be "expanded" to a URL like <code>https://ontology.example#foo</code>, which would
then be "compacted" to the same URL, once the unknown context is omitted and the
JSON-LD compaction algorithm is applied by the receiving application.
          </p>

        </section>

        <section id="context-injection"><div class="header-wrapper"><h4 id="x2-4-2-context-injection"><bdi class="secno">2.4.2 </bdi>Context Injection</h4><a class="self-link" href="#context-injection" aria-label="Permalink for Section 2.4.2"></a></div>
          

          <p>
The <code>@context</code> property is used to ensure that implementations are using the
same semantics when terms in this specification are processed. For example, this
can be important when properties like <code>type</code> are processed and its value, such
as <code>DataIntegrityProof</code>, are used.
          </p>

          <p>
When an application is securing a document, if an <code>@context</code> property is not
provided in the document or the Data Integrity terms used in the document are
not mapped by existing values in the <code>@context</code> property, implementations <em class="rfc2119">SHOULD</em>
inject or append an <code>@context</code> property with a value of
<code>https://w3id.org/security/data-integrity/v2</code> or one or more contexts with at
least the same declarations, such as the Verifiable Credential Data Model v2.0
context (<code>https://www.w3.org/ns/credentials/v2</code>).
          </p>

          <p>
Implementations that do not intend to use JSON-LD processing <em class="rfc2119">MAY</em> choose to not
include an <code>@context</code> declaration at the top-level of the document. However, if
an <code>@context</code> declaration is not included, extensions (such as the addition of
new properties) related to this specification or corresponding cryptosuites
<em class="rfc2119">MUST NOT</em> be made.
          </p>

        </section>

        <section id="securing-data-losslessly"><div class="header-wrapper"><h4 id="x2-4-3-securing-data-losslessly"><bdi class="secno">2.4.3 </bdi>Securing Data Losslessly</h4><a class="self-link" href="#securing-data-losslessly" aria-label="Permalink for Section 2.4.3"></a></div>
          

          <p>
HTML processors are designed to continue processing if recoverable errors are
detected. JSON-LD processors operate in a similar manner. This design philosophy
was meant to ensure that developers could use only the parts of the JSON-LD
language that they find useful, without causing the processor to throw errors
on things that might not be important to the developer. Among other effects,
this philosophy led to JSON-LD processors being designed to not throw errors,
but rather warn developers, when encountering things such as undefined terms.
          </p>

          <p>
When converting from JSON-LD to an RDF Dataset, such as when canonicalizing a
document [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>], undefined terms and relative URLs can be dropped
silently. When values are dropped, they are not protected by a digital proof. This
creates a mismatch of expectations, where a developer, who is unaware of how
a JSON-LD processor works, might think that certain data was being secured,
and then be surprised to find that it was not, when no error was thrown.
This specification requires that any recoverable loss of data when
performing JSON-LD transformations result in an error, to avoid a mismatch
in the security expectations of developers.
          </p>

          <p>
Implementations that use JSON-LD processing, such as RDF Dataset
Canonicalization [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>], <em class="rfc2119">MUST</em> throw an error, which <em class="rfc2119">SHOULD</em> be
<code>DATA_LOSS_DETECTION_ERROR</code>, when data is dropped by a JSON-LD processor,
such as when an undefined term is detected in an input document.
          </p>

          <p>
Similarly, since <a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-6">conforming secured documents</a> can be transferred from one
security domain to another, <a data-link-type="dfn|abstract-op" href="#dfn-conforming-processor" class="internalDFN" id="ref-for-dfn-conforming-processor-3">conforming processors</a> that process the
<a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-7">conforming secured document</a> cannot assume any particular base URL for
the document. When deserializing to RDF, implementations <em class="rfc2119">MUST</em> ensure that the
base URL is set to null.
          </p>
        </section>

        <section id="datatypes"><div class="header-wrapper"><h4 id="x2-4-4-datatypes"><bdi class="secno">2.4.4 </bdi>Datatypes</h4><a class="self-link" href="#datatypes" aria-label="Permalink for Section 2.4.4"></a></div>
          

          <p>
This section defines datatypes that are used by this specification.
          </p>

        <section id="the-cryptosuitestring-datatype"><div class="header-wrapper"><h5 id="cryptosuiteString"><bdi class="secno">2.4.4.1 </bdi>The <code>cryptosuiteString</code> Datatype</h5><a class="self-link" href="#cryptosuiteString" aria-label="Permalink for Section 2.4.4.1"></a></div>
          

          <p>
This specification encodes cryptographic suite identifiers as enumerable
strings, which is useful in processes that need to efficiently encode such
strings, such as compression algorithms. In environments that support data types
for <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> values, such as RDF [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-concepts" title="Resource Description Framework (RDF): Concepts and Abstract Syntax">RDF-CONCEPTS</a></cite>], cryptographic identifier
content is indicated using a literal value whose datatype is set to
<code>https://w3id.org/security#cryptosuiteString</code>.
          </p>

          <p>
The <code>cryptosuiteString</code> datatype is defined as follows:
          </p>

          <dl>
            <dt>The URL denoting this datatype</dt>
            <dd>
<code>https://w3id.org/security#cryptosuiteString</code>
            </dd>
            <dt>The lexical space</dt>
            <dd>
The union of all cryptosuite strings, expressed using American Standard Code
for Information Interchange [<cite><a class="bibref" data-link-type="biblio" href="#bib-ascii" title="ISO/IEC 646:1991, Information technology -- ISO 7-bit coded character set for information interchange">ASCII</a></cite>] strings, that are defined by the
collection of all Data Integrity cryptosuite specifications.
            </dd>
            <dt>The value space</dt>
            <dd>
The union of all cryptosuite types that are expressed using the <code>cryptosuite</code>
property, as defined in Section <a href="#dataintegrityproof" data-matched-text="[[[#dataintegrityproof]]]" class="sec-ref"><bdi class="secno">3.1 </bdi>DataIntegrityProof</a>.
            </dd>
            <dt>The lexical-to-value mapping</dt>
            <dd>
Any element of the lexical space is mapped to the result of parsing it into an
internal representation that uniquely identifies the cryptosuite type from all
other possible cryptosuite types.
            </dd>
            <dt>The canonical mapping</dt>
            <dd>
Any element of the value space is mapped to the corresponding string in the
lexical space.
            </dd>
          </dl>
        </section>

      </section>

    </section>

      <section id="relationship-to-linked-data"><div class="header-wrapper"><h3 id="x2-5-relationship-to-linked-data"><bdi class="secno">2.5 </bdi>Relationship to Linked Data</h3><a class="self-link" href="#relationship-to-linked-data" aria-label="Permalink for Section 2.5"></a></div>
        
        <p>
The term Linked Data is used to describe a recommended best practice for
exposing, sharing, and connecting information on the Web using standards, such
as URLs, to identify things and their properties. When information is presented
as Linked Data, other related information can be easily discovered and new
information can be easily linked to it. Linked Data is extensible in a
decentralized way, greatly reducing barriers to large scale integration.
        </p>

        <p>
With the increase in usage of Linked Data for a variety of applications, there
is a need to be able to verify the authenticity and integrity of Linked Data
documents. This specification adds authentication and integrity protection to
data documents through the use of mathematical proofs without sacrificing Linked
Data features such as extensibility and composability.
        </p>

        <div class="note" role="note" id="issue-container-generatedID-2"><div role="heading" class="note-title marker" id="h-note-2" aria-level="4"><span>Note</span><span class="issue-label">: Use of Linked Data is an optional feature</span></div><p class="">
While  this specification provides mechanisms to digitally sign Linked Data, the
use  of Linked Data is not necessary to gain some of the advantages provided by
this specification.
        </p></div>

      </section>

      <section id="relationship-to-verifiable-credentials"><div class="header-wrapper"><h3 id="x2-6-relationship-to-verifiable-credentials"><bdi class="secno">2.6 </bdi>Relationship to Verifiable Credentials</h3><a class="self-link" href="#relationship-to-verifiable-credentials" aria-label="Permalink for Section 2.6"></a></div>
        

        <p>
Cryptographic suites that implement this specification can be used to secure
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a> and <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-presentation">verifiable presentations</a>. Implementers
that are addressing those use cases are cautioned that additional checks might
be appropriate when processing those types of documents.
        </p>

        <p>
There are some use cases where it is important to ensure that the
<a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-3">verification method</a> used in a proof is associated with the
<a href="https://www.w3.org/TR/vc-data-model-2.0/#issuer"><code>issuer</code></a> in a
<a href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">
verifiable credential</a>, or the
<a href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-holders"><code>holder</code></a> in a
<a href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-presentation">
verifiable presentation</a>, during the process of
<a href="https://www.w3.org/TR/vc-data-model-2.0/#issuer-0">validation</a>. One
way to check for such an association is to ensure that the value of the
<code>controller</code> property of a proof's <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-4">verification method</a>
matches the URL value used to identify the
<a href="https://www.w3.org/TR/vc-data-model-2.0/#issuer"><code>issuer</code></a> or
<a href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-holders"><code>holder</code></a>, respectively, and
that the verification method is expressed under a verification relationship that
is acceptable given the proof's purpose. This particular association indicates
that the
<a href="https://www.w3.org/TR/vc-data-model-2.0/#issuer"><code>issuer</code></a> or
<a href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-holders"><code>holder</code></a>, respectively,
is the controller of the <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-5">verification method</a> used to verify
the proof.
        </p>

        <p>
Document authors and implementers are advised to understand the difference
between the validity period of a <a href="#proofs">proof</a>, which is expressed
using the <a href="#dfn-created" id="ref-for-dfn-created-1"><code>created</code></a> and <a href="#defn-proof-expires"><code>expires</code></a> properties, and the validity period of
a <a href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-credential">credential</a>,
which is expressed using the
<a href="https://www.w3.org/TR/vc-data-model-2.0/#defn-validFrom"><code>validFrom</code></a> and
<a href="https://www.w3.org/TR/vc-data-model-2.0/#defn-validUntil"><code>validUntil</code></a> properties.
While these properties might sometimes express the same validity periods, at
other times they might not be aligned. When verifying a
<a href="#proofs">proof</a>, it is important to ensure that the time of interest
(which might be the current time or any other time) is within the
validity period for the proof (that is, between
<a href="#dfn-created" id="ref-for-dfn-created-2"><code>created</code></a> and
<a href="#defn-proof-expires"><code>expires</code></a> ).
When <a href="https://www.w3.org/TR/vc-data-model-2.0/#validation">validating</a> a
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a>, it is important to ensure that the time of
interest is within the validity period for the
<a href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-credential">credential</a> (that is,
betweeen
<a href="https://www.w3.org/TR/vc-data-model-2.0/#defn-validFrom"><code>validFrom</code></a> and
<a href="https://www.w3.org/TR/vc-data-model-2.0/#defn-validUntil"><code>validUntil</code></a>). Note that a
failure to validate either the validity period for the <a href="#proofs">proof</a>, or the validity period for the
<a href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-credential">credential</a>, might result
in accepting data that ought to have been rejected.
        </p>

        <p>
Finally, implementers are also urged to understand that there is a difference
between the revocation information associated with a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a>,
and the <a href="https://www.w3.org/TR/controller-document/#dfn-revoked">revocation</a>
and <a href="https://www.w3.org/TR/controller-document/#defn-vm-expires">expiration</a> times
for a <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-6">verification method</a>. The
<a href="https://www.w3.org/TR/controller-document/#dfn-revoked">revocation</a> and
<a href="https://www.w3.org/TR/controller-document/#defn-vm-expires">expiration</a> times for a
<a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-7">verification method</a> are expressed using the <code>revocation</code> and <code>expires</code>
properties, respectively; are related to events such as a <a data-link-type="dfn|abstract-op" href="#dfn-secret-key" class="internalDFN" id="ref-for-dfn-secret-key-3">secret key</a> being
compromised or expiring; and can provide timing information which might reveal
details about a controller, such as their security practices or when they might
have been compromised. The revocation information for a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a> is expressed using the <code>credentialStatus</code> property; is related
to events such as an individual losing the privilege that is granted by the
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a>; and does not provide timing information, which
enhances privacy.
        </p>
      </section>

    </section>

    <section id="cryptographic-suites"><div class="header-wrapper"><h2 id="x3-cryptographic-suites"><bdi class="secno">3. </bdi>Cryptographic Suites</h2><a class="self-link" href="#cryptographic-suites" aria-label="Permalink for Section 3."></a></div>
      
      <p>
A <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-11">data integrity proof</a> is designed to be easy to use by developers and
therefore strives to minimize the amount of information one has to remember to
generate a proof. Often, just the <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-3">cryptographic suite</a> name (such as
<code>eddsa-rdfc-2022</code>) is required from developers to initiate the creation of a
proof. These <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-4">cryptographic suite</a>s are often created and reviewed by people
that have the requisite cryptographic training to ensure that safe combinations
of cryptographic primitives are used. This section specifies the requirements
for authoring cryptographic suite specifications.
      </p>

      <p>
The requirements for all data integrity cryptographic suite specifications are
as follows:
      </p>

      <ul>
        <li>
The specification <em class="rfc2119">MUST</em> be published as a human-readable document at a URL.
        </li>
        <li>
The specification <em class="rfc2119">MUST</em> identify a cryptographic suite <code>type</code> and any
parameters that can be used with the suite.
        </li>
        <li>
The specification <em class="rfc2119">MUST</em> detail the <a data-link-type="dfn|abstract-op" href="#dfn-transformation-algorithm" class="internalDFN" id="ref-for-dfn-transformation-algorithm-1">transformation algorithms</a> (if any),
parameters, and other necessary details, used to modify input data into the data
to be protected.
        </li>
        <li>
The specification <em class="rfc2119">MUST</em> detail the <a data-link-type="dfn|abstract-op" href="#dfn-hashing-algorithm" class="internalDFN" id="ref-for-dfn-hashing-algorithm-1">hashing algorithms</a>
parameters, and other necessary details used to perform cryptographic hashing to
the data to be protected.
        </li>
        <li>
The specification <em class="rfc2119">MUST</em> detail the <a data-link-type="dfn|abstract-op" href="#dfn-proof-serialization-algorithm" class="internalDFN" id="ref-for-dfn-proof-serialization-algorithm-1">proof serialization algorithms</a>,
parameters, and other necessary details used to perform cryptographic protection
of the data.
        </li>
        <li>
The specification <em class="rfc2119">MUST</em> detail the <a data-link-type="dfn|abstract-op" href="#dfn-proof-verification-algorithm" class="internalDFN" id="ref-for-dfn-proof-verification-algorithm-1">proof verification algorithms</a>,
parameters, and other necessary details used to perform cryptographic
verification of the data.
        </li>
        <li>
The specification <em class="rfc2119">MUST</em> define a <dfn class="export" data-lt="cryptosuite instantiation algorithm|data integrity cryptographic suite instantiation algorithm" data-export="" data-plurals="cryptosuite instantiation algorithms" id="dfn-cryptosuite-instantiation-algorithm" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">data integrity cryptographic suite instantiation
algorithm</dfn> that accepts a set of options (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>options</var>) and returns a
<a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-cryptographic-suite-instance" class="internalDFN" id="ref-for-dfn-data-integrity-cryptographic-suite-instance-1">cryptosuite instance</a> (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a> <var>cryptosuite</var>). This algorithm <em class="rfc2119">SHOULD</em> be
listed in the <cite><a data-matched-text="[[[?VC-EXTENSIONS]]]" href="https://w3c.github.io/vc-extensions/">Verifiable Credential Extensions</a></cite> document. A <dfn class="export" data-local-lt="cryptosuite instance" data-export="" data-lt="data integrity cryptographic suite instance|cryptosuite instance" id="dfn-data-integrity-cryptographic-suite-instance" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">data integrity cryptographic suite
instance</dfn> <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a> has the following <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a>.
          <dl data-dfn-for="cryptosuite instance">
            <dt><dfn id="dfn-createproof" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">createProof</dfn></dt>
            <dd>
An algorithm that takes an <a data-link-type="dfn|abstract-op" href="#dfn-input-document" class="internalDFN" id="ref-for-dfn-input-document-1">input document</a> (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>
<var>inputDocument</var>) and proof options (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>options</var>) as input, and
produces a <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-12">data integrity proof</a> (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>) or an error.
            </dd>
            <dt><dfn id="dfn-verifyproof" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verifyProof</dfn></dt>
            <dd>
An algorithm that takes a <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-1">secured data document</a> (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>
<var>securedDocument</var>) as input, and produces a <dfn id="dfn-cryptosuite-verification-result" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">cryptosuite verification
result</dfn> or an error. The <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite-verification-result" class="internalDFN" id="ref-for-dfn-cryptosuite-verification-result-1">cryptosuite verification result</a> is a
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a> that contains the following <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a>:
              <dl data-dfn-for="cryptosuite verification result">
                <dt><dfn class="lint-ignore" id="dfn-verified" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verified</dfn></dt>
                <dd>
A <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#boolean">boolean</a> that is <code>true</code> if the verification succeeded, or <code>false</code>
otherwise.
                </dd>
                <dt><dfn class="lint-ignore" id="dfn-verifieddocument" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verifiedDocument</dfn></dt>
                <dd>
A <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> that represents the <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-2">secured data document</a> with the verified
proofs removed if <a data-link-type="dfn|abstract-op" href="#dfn-verified" class="internalDFN" id="ref-for-dfn-verified-1">verified</a> is <code>true</code>, or
<a href="https://infra.spec.whatwg.org/#nulls">null</a> otherwise.
                </dd>
              </dl>
The structure <em class="rfc2119">MAY</em> contain other implementation-specific information that is
useful for developers, such as debugging information. If an error is produced,
the verification process failed to complete. An error, such as a network error,
does not mean that a future attempt at verification would fail.
            </dd>
          </dl>
        </li>
        <li>
The specification <em class="rfc2119">MUST</em> detail any known resource starvation attack that can
occur in an algorithm and provide testable mitigations against each attack.
        </li>
        <li>
The specification <em class="rfc2119">MUST</em> contain a Security Considerations section detailing
security considerations specific to the cryptographic suite.
        </li>
        <li>
The specification <em class="rfc2119">MUST</em> contain a Privacy Considerations section detailing
privacy considerations specific to the cryptographic suite.
        </li>
        <li>
The JSON-LD context associated with the cryptographic suite <em class="rfc2119">MUST</em> have its terms
protected from unsafe redefinition, by use of the <code>@protected</code> keyword.
        </li>
      </ul>

      <p>
A <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-cryptographic-suite-instance" class="internalDFN" id="ref-for-dfn-data-integrity-cryptographic-suite-instance-2">cryptosuite instance</a> is instantiated using a <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite-instantiation-algorithm" class="internalDFN" id="ref-for-dfn-cryptosuite-instantiation-algorithm-1">cryptosuite instantiation algorithm</a> and is made available to algorithms in an implementation-specific
manner. Implementations <em class="rfc2119">MAY</em> use the <cite><a data-matched-text="[[[?VC-EXTENSIONS]]]" href="https://w3c.github.io/vc-extensions/">Verifiable Credential Extensions</a></cite> document to discover
known <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite-instantiation-algorithm" class="internalDFN" id="ref-for-dfn-cryptosuite-instantiation-algorithm-2">cryptosuite instantiation algorithms</a>.
      </p>

      <section id="dataintegrityproof"><div class="header-wrapper"><h3 id="x3-1-dataintegrityproof"><bdi class="secno">3.1 </bdi>DataIntegrityProof</h3><a class="self-link" href="#dataintegrityproof" aria-label="Permalink for Section 3.1"></a></div>
        

        <p>
A number of <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-5">cryptographic suites</a> follow the same basic pattern when
expressing a <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-13">data integrity proof</a>. This section specifies that general
design pattern, a <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-6">cryptographic suite</a> type called a <code>DataIntegrityProof</code>,
which reduces the burden of writing and implementing <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-7">cryptographic suites</a>
through the reuse of design primitives and source code.
        </p>

        <p>
When specifing a <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-8">cryptographic suite</a> that utilizes this design pattern, the
<code>proof</code> value takes the following form:
        </p>

        <dl>
          <dt>type</dt>
          <dd>
The <code>type</code> property <em class="rfc2119">MUST</em> contain the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> <code>DataIntegrityProof</code>.
          </dd>
          <dt>cryptosuite</dt>
          <dd>
The value of the <code>cryptosuite</code> property <em class="rfc2119">MUST</em> be a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> that identifies the
<a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-9">cryptographic suite</a>. If the processing environment supports <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a>
subtypes, the subtype of the <code>cryptosuite</code> value <em class="rfc2119">MUST</em> be the
<code>https://w3id.org/security#cryptosuiteString</code> subtype.
          </dd>
          <dt>proofValue</dt>
          <dd>
The <code>proofValue</code> property <em class="rfc2119">MUST</em> be used, as specified in Section <a href="#proofs" data-matched-text="[[[#proofs]]]" class="sec-ref"><bdi class="secno">2.1 </bdi>Proofs</a>.
          </dd>
        </dl>

        <p>
<a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-10">Cryptographic suite</a> designers <em class="rfc2119">MUST</em> use mandatory <code>proof</code> value properties
defined in Section <a href="#proofs" data-matched-text="[[[#proofs]]]" class="sec-ref"><bdi class="secno">2.1 </bdi>Proofs</a>, and <em class="rfc2119">MAY</em> define other properties specific to
their cryptographic suite.
        </p>

        <div class="note" role="note" id="issue-container-generatedID-3"><div role="heading" class="note-title marker" id="h-note-3" aria-level="4"><span>Note</span><span class="issue-label">: Design Patterns of Legacy Cryptographic Suites</span></div><p class="">
One of the design patterns seen in Data Integrity cryptosuites from
2012 to 2020 was use of the <code>type</code> property to establish a specific type for a
cryptographic suite; the
<a href="https://www.w3.org/TR/vc-di-eddsa/#the-ed25519signature2020-suite">
Ed25519Signature2020 cryptographic suite</a> was one such specification. This
led to a greater burden on cryptographic suite implementations, where every new
cryptographic suite required specification of a new JSON-LD Context, resulting
in a sub-optimal developer experience. A streamlined version of this design
pattern emerged in 2020, such that a developer would only need to include a
single JSON-LD Context to support all modern cryptographic suites. This
encouraged more modern cryptosuites — such as the EdDSA Cryptosuites
[<cite><a class="bibref" data-link-type="biblio" href="#bib-di-eddsa" title="The Edwards Digital Signature Algorithm Cryptosuites v1.0">DI-EDDSA</a></cite>] and the ECDSA Cryptosuites [<cite><a class="bibref" data-link-type="biblio" href="#bib-di-ecdsa" title="The Elliptic Curve Digital Signature Algorithm Cryptosuites v1.0">DI-ECDSA</a></cite>] — to be built
based on the streamlined pattern described in this section.
        <br><br>
To improve the developer experience, authors creating new Data Integrity
cryptographic suite specifications <em class="rfc2119">SHOULD</em> use the modern pattern — where
the <code>type</code> is set to <code>DataIntegrityProof</code>; the <code>cryptosuite</code> property carries
the identifier for the cryptosuite; and any cryptosuite-specific cryptographic
data is encapsulated (i.e., not directly exposed as application layer data)
within <code>proofValue</code>. A list of cryptographic suite specifications that are
known to follow this pattern is provided in the
<a href="https://w3c.github.io/vc-extensions/#securing-mechanisms">
Securing Mechanisms section of the Verifiable Credentials Extensions</a>
document.
        </p></div>
      </section>

    </section>

    <section id="algorithms"><div class="header-wrapper"><h2 id="x4-algorithms"><bdi class="secno">4. </bdi>Algorithms</h2><a class="self-link" href="#algorithms" aria-label="Permalink for Section 4."></a></div>
      

      <p>
The algorithms defined below operate on documents represented as <dfn id="dfn-json-objects" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.rfc-editor.org/rfc/rfc8259#section-4">JSON objects</a></dfn>. This specification follows the
<cite><a data-matched-text="[[[JSON-LD11-API]]]" href="https://www.w3.org/TR/json-ld11-api/">JSON-LD 1.1 Processing Algorithms and API</a></cite> specification in representing a JSON object as a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>.
An <dfn class="export" data-export="" id="dfn-unsecured-data-document" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">unsecured data document</dfn> is a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> that contains
no proof values. An <dfn id="dfn-input-document" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">input document</dfn> is an <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> that has not yet had
the current proof added to it, but it <em class="rfc2119">MAY</em> contain a proof value that was added
to it by a previous process. A <dfn class="export" data-export="" data-plurals="secured data documents" id="dfn-secured-data-document" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">secured data document</dfn>
is a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> that contains one or more proof values.
      </p>

      <p>
Implementers <em class="rfc2119">MAY</em> implement reasonable defaults and safeguards in addition to the
algorithms below, to help mitigate developer error, excessive resource
consumption, newly discovered attack models against which there is a particular
protection, and other improvements. The algorithms provided below are the
minimum requirements for an interoperable implementation, and developers are
urged to include additional measures that could contribute to a safer and more
efficient ecosystem.
      </p>

      <section class="normative" id="processing-model"><div class="header-wrapper"><h3 id="x4-1-processing-model"><bdi class="secno">4.1 </bdi>Processing Model</h3><a class="self-link" href="#processing-model" aria-label="Permalink for Section 4.1"></a></div>
        

        <p>
The processing model used by a <a data-link-type="dfn|abstract-op" href="#dfn-conforming-processor" class="internalDFN" id="ref-for-dfn-conforming-processor-4">conforming processor</a> and its
application-specific software is described in this section. When software
is to ensure information is tamper-evident, it performs the following steps:
        </p>

        <ol>
          <li>
The software arranges the information into a document, such as a JSON or
JSON-LD document.
          </li>
          <li>
If the document is a JSON-LD document, the software selects one or more
JSON-LD Contexts and expresses them using the <code>@context</code> property.
          </li>
          <li>
The software selects one or more cryptography suites that meet the needs of
the use case, such as one that provides full, selective, or unlinkable
disclosure, using acceptable cryptographic key material.
          </li>
          <li>
The software uses the applicable algorithm(s) provided in Section <a href="#add-proof" data-matched-text="[[[#add-proof]]]" class="sec-ref"><bdi class="secno">4.2 </bdi>Add Proof</a>
or Section <a href="#add-proof-set-chain" data-matched-text="[[[#add-proof-set-chain]]]" class="sec-ref"><bdi class="secno">4.3 </bdi>Add Proof Set/Chain</a> to add one or more proofs.
          </li>
        </ol>

        <p>
When software needs to use information that was transmitted to it using
a mechanism described by this specification, it performs the following steps:
        </p>

        <ol>
          <li>
The software transforms the incoming data into a document that can be understood
by the applicable algorithm provided in Section <a href="#verify-proof" data-matched-text="[[[#verify-proof]]]" class="sec-ref"><bdi class="secno">4.4 </bdi>Verify Proof</a> or Section
<a href="#verify-proof-sets-and-chains" data-matched-text="[[[#verify-proof-sets-and-chains]]]" class="sec-ref"><bdi class="secno">4.5 </bdi>Verify Proof Sets and Chains</a>.
          </li>
          <li>
The software uses JSON Schema or an equivalent mechanism to validate that the
incoming document follows an expected schema used by the application.
          </li>
          <li>
The software uses the applicable algorithm(s) provided in Section <a href="#verify-proof" data-matched-text="[[[#verify-proof]]]" class="sec-ref"><bdi class="secno">4.4 </bdi>Verify Proof</a>
or Section <a href="#verify-proof-sets-and-chains" data-matched-text="[[[#verify-proof-sets-and-chains]]]" class="sec-ref"><bdi class="secno">4.5 </bdi>Verify Proof Sets and Chains</a> to verify the integrity of the
incoming document.
          </li>
          <li>
If the document is a JSON-LD document, the software uses the algorithm provided
in Section <a href="#context-validation" data-matched-text="[[[#context-validation]]]" class="sec-ref"><bdi class="secno">4.6 </bdi>Context Validation</a>, or one providing equivalent protections,
to validate all JSON-LD Context values used in the document.
          </li>
        </ol>

      </section>

      <section class="normative" id="add-proof"><div class="header-wrapper"><h3 id="x4-2-add-proof"><bdi class="secno">4.2 </bdi>Add Proof</h3><a class="self-link" href="#add-proof" aria-label="Permalink for Section 4.2"></a></div>
        

        <p>
The following algorithm specifies how a digital proof can be added to an <a data-link-type="dfn|abstract-op" href="#dfn-input-document" class="internalDFN" id="ref-for-dfn-input-document-2">input document</a>, and can then be used to verify the output document's authenticity
and integrity. Required inputs are an <a data-link-type="dfn|abstract-op" href="#dfn-input-document" class="internalDFN" id="ref-for-dfn-input-document-3">input document</a> (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>
<var>inputDocument</var>), a <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-cryptographic-suite-instance" class="internalDFN" id="ref-for-dfn-data-integrity-cryptographic-suite-instance-3">cryptosuite instance</a> (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a> <var>cryptosuite</var>), and a
set of options (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>options</var>). Output is a <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-3">secured data document</a>
(<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>) or an error. Whenever this algorithm encodes strings, it <em class="rfc2119">MUST</em> use
UTF-8 encoding.
        </p>

        <ol class="algorithm">
          <li>
Let <var>proof</var> be the result of calling the <a data-link-type="dfn|abstract-op" href="#dfn-createproof" class="internalDFN" id="ref-for-dfn-createproof-1">createProof</a>
algorithm specified in <var>cryptosuite</var>.<var>createProof</var> with <var>inputDocument</var>
and <var>options</var> passed as a parameters. If the algorithm produces an error,
the error <em class="rfc2119">MUST</em> be propagated and <em class="rfc2119">SHOULD</em> convey the error type.
          </li>
          <li>
If one or more of the <var>proof</var>.<var>type</var>, <var>proof</var>.<var>verificationMethod</var>, and
<var>proof</var>.<var>proofPurpose</var> values is not set, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em>
convey an error type of
<a href="#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
          </li>
          <li>
If <var>options</var> has a non-null <var>domain</var> <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">item</a>, it <em class="rfc2119">MUST</em> be equal to
<var>proof</var>.<var>domain</var> or an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey
an error type of <a href="#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
          </li>
          <li>
If <var>options</var> has a non-null <var>challenge</var> <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">item</a>, it <em class="rfc2119">MUST</em> be equal to
<var>proof</var>.<var>challenge</var> or an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em>
convey an error type of
<a href="#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
          </li>
          <li>
Let <var>securedDataDocument</var> be a copy of <var>inputDocument</var>.
          </li>
          <li>
Set <var>securedDataDocument</var>.<var>proof</var> to the value of <var>proof</var>.
          </li>
          <li>
Return <var>securedDataDocument</var> as the <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-4">secured data document</a>.
          </li>
        </ol>

      </section>
      <section id="add-proof-set-chain"><div class="header-wrapper"><h3 id="x4-3-add-proof-set-chain"><bdi class="secno">4.3 </bdi>Add Proof Set/Chain</h3><a class="self-link" href="#add-proof-set-chain" aria-label="Permalink for Section 4.3"></a></div>
        
        <p>
The following algorithm specifies how to incrementally add a proof to a proof
set or proof chain starting with a secured document containing either a proof or
proof set/chain. Required inputs are a <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-5">secured data document</a> (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>
<var>securedDocument</var>), a <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-11">cryptographic suite</a> (<a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-cryptographic-suite-instance" class="internalDFN" id="ref-for-dfn-data-integrity-cryptographic-suite-instance-4">cryptosuite instance</a> <var>suite</var>), and a set of options (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>options</var>). Output is a new
<a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-6">secured data document</a> (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>). Whenever this algorithm encodes strings, it
<em class="rfc2119">MUST</em> use UTF-8 encoding.
        </p>

        <ol class="algorithm">
          <li>
Let <var>proof</var> be set to <var>securedDocument</var>.<var>proof</var>. Let
<var>allProofs</var> be an empty list. If <var>proof</var> is a list, copy all
the elements of <var>proof</var> to <var>allProofs</var>. If <var>proof</var>
is an object add a copy of that object to <var>allProofs</var>.
          </li>
          <li>
Let the <var>inputDocument</var> be a copy of the <var>securedDocument</var>
with the <var>proof</var> attribute removed. Let <var>output</var> be a copy of
the <var>inputDocument</var>.
          </li>
          <li>
Let <var>matchingProofs</var> be an empty list.
          </li>
          <li>
If <var>options</var> has a <code>previousProof</code> <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">item</a> that is a string, add the
element from <var>allProofs</var> with an <code>id</code> attribute matching <code>previousProof</code> to
<var>matchingProofs</var>. If a proof with <code>id</code> equal to <code>previousProof</code> does not exist in
<var>allProofs</var>, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
          </li>
          <li>
If <var>options</var> has a <code>previousProof</code> <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">item</a> that is an array, add each
element from <var>allProofs</var> with an <code>id</code> attribute that matches an element of that
array. If any element of <code>previousProof</code> <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> has an <code>id</code> attribute that does
not match the <code>id</code> attribute of any element of <var>allProofs</var>, an error <em class="rfc2119">MUST</em> be
raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
          </li>
          <li>
Set <var>inputDocument</var>.<var>proof</var> to <var>matchingProofs</var>.
            <div class="note" role="note" id="issue-container-generatedID-4"><div role="heading" class="note-title marker" id="h-note-4" aria-level="4"><span>Note</span><span class="issue-label">: This step protects the document and existing proofs</span></div><div class="">
              <p>
This step adds references to the <a data-link-type="dfn|abstract-op" href="#dfn-named-graph" class="internalDFN" id="ref-for-dfn-named-graph-2">named graphs</a>, as well as adding a copy of
<em>all</em> the claims contained in the <a data-link-type="dfn|abstract-op" href="#dfn-proof-graph" class="internalDFN" id="ref-for-dfn-proof-graph-2">proof graphs</a>. The step is critical,
as it <q>binds</q> any matching proofs to the document prior to applying the
current proof. The <var>proof</var> value for the document will be updated in a later
step of this algorithm.
              </p>
            </div></div>
          </li>
          <li>
Run steps 1 through 6 of the algorithm in section <a href="#add-proof" data-matched-text="[[[#add-proof]]]" class="sec-ref"><bdi class="secno">4.2 </bdi>Add Proof</a>, passing
<var>inputDocument</var>, <var>suite</var>, and <var>options</var>. If no exceptions are raised, append
the generated <var>proof</var> value to the <var>allProofs</var>; otherwise, raise the exception.
          </li>
          <li>
Set <var>output</var>.<var>proof</var> to the value of <var>allProofs</var>.
          </li>
          <li>
Return <var>output</var> as the new <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-7">secured data document</a>.
          </li>
        </ol>
      </section>

      <section id="verify-proof"><div class="header-wrapper"><h3 id="x4-4-verify-proof"><bdi class="secno">4.4 </bdi>Verify Proof</h3><a class="self-link" href="#verify-proof" aria-label="Permalink for Section 4.4"></a></div>
        

        <p>
The following algorithm specifies how to check the authenticity and integrity of
a <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-8">secured data document</a> by verifying its digital proof. The algorithm
takes as input:
        </p>

        <dl>
          <dt><var>mediaType</var></dt>
          <dd>
A <a data-link-type="dfn|abstract-op" data-lt="MIME type" data-type="dfn" href="https://mimesniff.spec.whatwg.org/#mime-type">media type</a> as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-mimesniff" title="MIME Sniffing Standard">MIMESNIFF</a></cite>]
          </dd>
          <dt><var>documentBytes</var></dt>
          <dd>
A <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence">byte sequence</a> whose media type is <var>mediaType</var>
          </dd>
          <dt><var>cryptosuite</var></dt>
          <dd>
A <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-cryptographic-suite-instance" class="internalDFN" id="ref-for-dfn-data-integrity-cryptographic-suite-instance-5">cryptosuite instance</a>
          </dd>
          <dt><var>expectedProofPurpose</var></dt>
          <dd>
An optional <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a>, used to ensure that the <var>proof</var> was generated by the
proof creator for the expected reason by the verifier. See <a href="#proof-purposes" data-matched-text="[[[#proof-purposes]]]" class="sec-ref"><bdi class="secno">2.2 </bdi>Proof Purposes</a>
for common values
          </dd><dt><var>domain</var></dt>
          <dd>
An optional <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set">set</a> of <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">strings</a>, used by the proof creator to lock a proof to
a particular security domain, and used by the verifier to ensure that a proof is
not being used across different security domains
          </dd>
          <dt><var>challenge</var></dt>
          <dd>
An optional <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> <a data-link-type="dfn|abstract-op" href="#dfn-challenge" class="internalDFN" id="ref-for-dfn-challenge-1">challenge</a>, used by the verifier to ensure that an
attacker is not replaying previously created proofs
          </dd>
        </dl>

        <p>
This algorithm returns a <dfn data-plurals="verification results" id="dfn-verification-result" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verification result</dfn>, a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a> whose
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a> are:
        </p>
        <dl data-dfn-for="verification result">
          <dt><dfn data-dfn-for="verification result" id="dfn-verified-0" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verified</dfn></dt>
          <dd><code>true</code> or <code>false</code></dd>
          <dt><dfn data-dfn-for="verification result" id="dfn-verifieddocument-0" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verifiedDocument</dfn></dt>
          <dd>
<a href="https://infra.spec.whatwg.org/#nulls">Null</a>, if <a data-link-type="dfn|abstract-op" href="#dfn-verified-0" class="internalDFN" id="ref-for-dfn-verified-0-1">verified</a> is
<code>false</code>; otherwise, an <a data-link-type="dfn|abstract-op" href="#dfn-input-document" class="internalDFN" id="ref-for-dfn-input-document-4">input document</a>
          </dd>
          <dt><dfn data-dfn-for="verification result" id="dfn-mediatype" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">mediaType</dfn></dt>
          <dd>
<a href="https://infra.spec.whatwg.org/#nulls">Null</a>, if <a data-link-type="dfn|abstract-op" href="#dfn-verified-0" class="internalDFN" id="ref-for-dfn-verified-0-2">verified</a> is
<code>false</code>; otherwise, a <a data-link-type="dfn|abstract-op" data-lt="MIME type" data-type="dfn" href="https://mimesniff.spec.whatwg.org/#mime-type">media type</a>, which <em class="rfc2119">MAY</em> include <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://mimesniff.spec.whatwg.org/#parameters">parameters</a>
          </dd>
          <dt><dfn data-dfn-for="verification result" class="lint-ignore" id="dfn-warnings" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">warnings</dfn></dt>
          <dd>
a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> of <a data-link-type="dfn|abstract-op" href="#dfn-problemdetails" class="internalDFN" id="ref-for-dfn-problemdetails-1">ProblemDetails</a>, which defaults to an empty <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a>
          </dd>
          <dt><dfn data-dfn-for="verification result" id="dfn-errors" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">errors</dfn></dt>
          <dd>
a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> of <a data-link-type="dfn|abstract-op" href="#dfn-problemdetails" class="internalDFN" id="ref-for-dfn-problemdetails-2">ProblemDetails</a>, which defaults to an empty <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a>
          </dd>
        </dl>

        <p>
When a step says "an error <em class="rfc2119">MUST</em> be raised", it means that a <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-1">verification result</a> <em class="rfc2119">MUST</em> be returned with a <a data-link-type="dfn|abstract-op" href="#dfn-verified-0" class="internalDFN" id="ref-for-dfn-verified-0-3">verified</a> value of
<code>false</code> and a non-empty <a data-link-type="dfn|abstract-op" href="#dfn-errors" class="internalDFN" id="ref-for-dfn-errors-1">errors</a> list.
        </p>

        <ol class="algorithm">
          <li>
Let <var data-type="map">securedDocument</var> be the result of running <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#parse-json-bytes-to-an-infra-value">parse JSON bytes to an Infra value</a> on <var>documentBytes</var>.
          </li>
          <li>
If either <var data-type="map">securedDocument</var> is not a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> or <var data-type="map">securedDocument</var>.<var>proof</var>
is not a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/VC-DATA-MODEL-2.0#PARSING_ERROR">
PARSING_ERROR</a>.
          </li>
          <li>
Let <var data-type="map">proof</var> be <var data-type="map">securedDocument</var>.<var data-type="map">proof</var>.
          </li>
          <li>
If one or more of <var data-type="map">proof</var>.<var>type</var>,
<var data-type="map">proof</var>.<var>verificationMethod</var>, and
<var data-type="map">proof</var>.<var>proofPurpose</var> does not <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#map-exists">exist</a>,
an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>.
          </li>
          <li>
If <var>expectedProofPurpose</var> was given, and it does not match
<var data-type="map">proof</var>.<var>proofPurpose</var>,
an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>.
          </li>
          <li>
If <var>domain</var> was given, and it does not contain the same <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">strings</a> as
<var data-type="map">proof</var>.<var>domain</var> (treating a single <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> as a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set">set</a> containing just
that <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a>), an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of <a href="#INVALID_DOMAIN_ERROR">INVALID_DOMAIN_ERROR</a>.
          </li>
          <li>
If <var>challenge</var> was given, and it does not match
<var data-type="map">proof</var>.<var>challenge</var>, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em>
convey an error type of
<a href="#INVALID_CHALLENGE_ERROR">INVALID_CHALLENGE_ERROR</a>.
          </li>
          <li>
Let <var>cryptosuiteVerificationResult</var> be the result of running the
<var>cryptosuite</var>.<a data-link-type="dfn|abstract-op" href="#dfn-verifyproof" class="internalDFN" id="ref-for-dfn-verifyproof-1">verifyProof</a> algorithm with
<var data-type="map">securedDocument</var> provided as input.
          </li>
          <li>
Return a <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-2">verification result</a> with <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a>:
            <dl data-link-for="verification result">
              <dt><a data-link-type="dfn|abstract-op" href="#dfn-verified-0" class="internalDFN" id="ref-for-dfn-verified-0-4">verified</a></dt>
              <dd><var>cryptosuiteVerificationResult</var>.<var>verified</var></dd>
              <dt><a data-link-type="dfn|abstract-op" href="#dfn-verifieddocument-0" class="internalDFN" id="ref-for-dfn-verifieddocument-0-1">verifiedDocument</a></dt>
              <dd><var>cryptosuiteVerificationResult</var>.<var>verifiedDocument</var></dd>
              <dt><a data-link-type="dfn|abstract-op" href="#dfn-mediatype" class="internalDFN" id="ref-for-dfn-mediatype-1">mediaType</a></dt>
              <dd><var>mediaType</var></dd>
            </dl>
          </li>
        </ol>

      </section>
      <section id="verify-proof-sets-and-chains"><div class="header-wrapper"><h3 id="x4-5-verify-proof-sets-and-chains"><bdi class="secno">4.5 </bdi>Verify Proof Sets and Chains</h3><a class="self-link" href="#verify-proof-sets-and-chains" aria-label="Permalink for Section 4.5"></a></div>
        
        <p>
In a <a data-link-type="dfn|abstract-op" href="#dfn-proof-set" class="internalDFN" id="ref-for-dfn-proof-set-1">proof set</a> or <a data-link-type="dfn|abstract-op" href="#dfn-proof-chain" class="internalDFN" id="ref-for-dfn-proof-chain-1">proof chain</a>, a <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-9">secured data document</a> has a <code>proof</code>
attribute which contains a list of <a data-link-type="dfn|abstract-op" href="#dfn-proof" class="internalDFN" id="ref-for-dfn-proof-3">proofs</a> (<var>allProofs</var>). The following
algorithm provides one method of checking the authenticity and integrity of a
<a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-10">secured data document</a>, achieved by verifying every proof in <var>allProofs</var>.
Other approaches are possible, particularly if it is only desired to verify a
subset of the proofs contained in <var>allProofs</var>. If another approach is taken to
verify only a subset of the proofs, then it is important to note that any proof
in that subset with a <code>previousProof</code> can only be considered verified if the
proofs it references are also considered verified.
        </p>
        <p>
Required input is a <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-11">secured data document</a> (<var>securedDocument</var>). A list of
<a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-3">verification results</a> corresponding to each proof in <var>allProofs</var> is
generated, and a single combined <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-4">verification result</a> is returned as output.
Implementations <em class="rfc2119">MAY</em> return any of the other <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-5">verification result</a>s and/or any
other metadata alongside the combined <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-6">verification result</a>.
        </p>
        <ol class="algorithm">
          <li>
Set <var>allProofs</var> to <var>securedDocument</var>.<var>proof</var>.
          </li>
          <li>
Set <var>verificationResults</var> to an empty list.
          </li>
          <li>
For each <var>proof</var> in <var>allProofs</var>, do the following steps:
            <ol class="algorithm">
              <li>
Let <var>matchingProofs</var> be an empty list.
              </li>
              <li>
If <var>proof</var> contains a <code>previousProof</code> attribute and the value of that
attribute is a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a>, add the element from <var>allProofs</var> with an <code>id</code>
attribute value matching the value of <code>previousProof</code> to <code>matchingProofs</code>.
If a proof with <code>id</code> value equal to the value of <code>previousProof</code> does not
exist in <var>allProofs</var>, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error
type of
<a href="#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>. If the
<code>previousProof</code> attribute is a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a>, add each element from <var>allProofs</var>
with an <code>id</code> attribute value that matches the value of an element of that
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a>. If any element of <code>previousProof</code> <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> has an <code>id</code> attribute
value that does not match the <code>id</code> attribute value of any element of
<var>allProofs</var>, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>.
              </li>
              <li>
Let <var>inputDocument</var> be a copy of <var>securedDocument</var> with the proof value
removed and then set <var>inputDocument</var>.<var>proof</var> to <var>matchingProofs</var>.

                <div class="note" role="note" id="issue-container-generatedID-5"><div role="heading" class="note-title marker" id="h-note-5" aria-level="4"><span>Note</span><span class="issue-label">: Secure document and previous proofs</span></div><p class="">
See the note in Step 6 of Section <a href="#add-proof-set-chain" data-matched-text="[[[#add-proof-set-chain]]]" class="sec-ref"><bdi class="secno">4.3 </bdi>Add Proof Set/Chain</a> to learn about
what document properties and previous proofs this step secures.
                </p></div>
              </li>
              <li>
Run steps 4 through 8 of the algorithm in section <a href="#verify-proof" data-matched-text="[[[#verify-proof]]]" class="sec-ref"><bdi class="secno">4.4 </bdi>Verify Proof</a> on
<var>inputDocument</var>; if no exceptions are raised, append <var>cryptosuiteVerificationResult</var>
to <var>verificationResults</var>.
                </li>
            </ol>
          </li>
          <li>
Set <var>successfulVerificationResults</var> to an empty list.
          </li>
          <li>
Let <var>combinedVerificationResult</var> be an empty struct. Set <var>combinedVerificationResult</var>.<var>status</var>
to <code>true</code>, <var>combinedVerificationResult</var>.<var>document</var> to <code>null</code>, and
<var>combinedVerificationResult</var>.<var>mediaType</var> to <code>null</code>.
          </li>
          <li>
For each <var>cryptosuiteVerificationResult</var> in <var>verificationResults</var>:
            <ol class="algorithm">
              <li>
If <var>cryptosuiteVerificationResult</var>.<var>verified</var> is <code>false</code>, set <var>combinedVerificationResult</var>.<var>verified</var>
to <code>false</code>.
              </li>
              <li>
Otherwise, set <var>combinedVerificationResult</var>.<var>document</var> to
<var>cryptosuiteVerificationResult</var>.<var>verifiedDocument</var>, set
<var>combinedVerificationResult</var>.<var>mediaType</var> to <var>cryptosuiteVerificationResult</var>.<var>mediaType</var>, and
append <var>cryptosuiteVerificationResult</var> to <var>successfulVerificationResults</var>.
              </li>
            </ol>
          </li>
          <li>
If <var>combinedVerificationResult</var>.<var>status</var> is <code>false</code>, set
<var>combinedVerificationResult</var>.<var>document</var> to <code>null</code> and
<var>combinedVerificationResult</var>.<var>mediaType</var> to <code>null</code>.
          </li>
          <li>
Return <var>combinedVerificationResult</var>, <var>successfulVerificationResults</var>.
          </li>
        </ol>
      </section>

      <section class="normative" id="context-validation"><div class="header-wrapper"><h3 id="x4-6-context-validation"><bdi class="secno">4.6 </bdi>Context Validation</h3><a class="self-link" href="#context-validation" aria-label="Permalink for Section 4.6"></a></div>
        

        <p>
The following algorithm provides one mechanism that can be used to ensure that
an application understands the contexts associated with a document before it
executed business rules specific to the input in the document. For more
rationale related to this algorithm, see Section <a href="#validating-contexts" data-matched-text="[[[#validating-contexts]]]" class="sec-ref"><bdi class="secno">2.4.1 </bdi>Validating Contexts</a>.
This algorithm takes inputs of a document (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>inputDocument</var>), a set of
known JSON-LD Contexts (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> <var>knownContext</var>), and a boolean to
recompact when unknown contexts are detected (<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#boolean">boolean</a> <var>recompact</var>).
        </p>

        <p>
This algorithm returns a <dfn class="lint-ignore" id="dfn-context-validation-result" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">context validation result</dfn>,
a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a> whose <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a> are:
        </p>
        <dl data-dfn-for="context validation result">
          <dt><dfn data-dfn-for="context validation result" id="dfn-validated" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">validated</dfn></dt>
          <dd><code>true</code> or <code>false</code></dd>
          <dt><dfn data-dfn-for="context validation result" class="lint-ignore" id="dfn-validateddocument" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">validatedDocument</dfn></dt>
          <dd>
<a href="https://infra.spec.whatwg.org/#nulls">Null</a>, if <a data-link-type="dfn|abstract-op" href="#dfn-validated" class="internalDFN" id="ref-for-dfn-validated-1">validated</a> is
<code>false</code>; otherwise, an <a data-link-type="dfn|abstract-op" href="#dfn-input-document" class="internalDFN" id="ref-for-dfn-input-document-5">input document</a>
          </dd>
          <dt><dfn data-dfn-for="context validation result" class="lint-ignore" id="dfn-warnings-0" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">warnings</dfn></dt>
          <dd>
a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> of <a data-link-type="dfn|abstract-op" href="#dfn-problemdetails" class="internalDFN" id="ref-for-dfn-problemdetails-3">ProblemDetails</a>, which defaults to an empty <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a>
          </dd>
          <dt><dfn data-dfn-for="context validation result" class="lint-ignore" id="dfn-errors-0" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">errors</dfn></dt>
          <dd>
a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> of <a data-link-type="dfn|abstract-op" href="#dfn-problemdetails" class="internalDFN" id="ref-for-dfn-problemdetails-4">ProblemDetails</a>, which defaults to an empty <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a>
          </dd>
        </dl>

        <p>
The context validation algorithm is as follows:
        </p>

        <ol class="algorithm">
          <li>
Set <var>result</var>.<var>validated</var> to <code>false</code>, <var>result</var>.<var>warnings</var> to an empty list,
<var>result</var>.<var>errors</var> to an empty list, <var>compactionContext</var> to an empty list;
and clone <var>inputDocument</var> to <var>result</var>.<var>validatedDocument</var>.
          </li>
          <li>
Let <var>contextValue</var> be the value of the <code>@context</code> property of <var>result</var>.<var>validatedDocument</var>,
which might be undefined.
          </li>
          <li>
If <var>contextValue</var> does not deeply equal <var>knownContext</var>, any subtree in
<var>result</var>.<var>validatedDocument</var> contains an <code>@context</code> property, or any URI in
<var>contextValue</var> dereferences to a JSON-LD Context file that does not match a
known good value or cryptographic hash, then perform the applicable action:
            <ol class="algorithm">
              <li>
If <var>recompact</var> is <code>true</code>, set <var>result</var>.<var>validatedDocument</var> to the result
of running the <a href="https://www.w3.org/TR/json-ld11-api/#compaction-algorithm">
JSON-LD Compaction Algorithm</a> with the <var>inputDocument</var> and
<var>knownContext</var> as inputs. If the compaction fails, add at least one error
to <var>result</var>.<var>errors</var>.
              </li>
              <li>
If <var>recompact</var> is not <code>true</code>, add at least one error to <var>result</var>.<var>errors</var>.
              </li>
            </ol>
          </li>
          <li>
If <var>result</var>.<var>errors</var> is empty, set <var>result</var>.<var>validated</var> to <code>true</code>; otherwise, set
<var>result</var>.<var>validated</var> to <code>false</code>, and remove the <var>document</var> property from <var>result</var>.
          </li>
          <li>
Return the value of <var>result</var>.
          </li>
        </ol>

        <p>
Implementations <em class="rfc2119">MAY</em> include additional warnings or errors that enforce
further validation rules that are specific to the implementation or a
particular use case.
        </p>

      </section>

      <section class="normative" id="processing-errors"><div class="header-wrapper"><h3 id="x4-7-processing-errors"><bdi class="secno">4.7 </bdi>Processing Errors</h3><a class="self-link" href="#processing-errors" aria-label="Permalink for Section 4.7"></a></div>
        

        <p>
The algorithms described in this specification, as well as in various cryptographic
suite specifications, throw specific types of errors. Implementers might find
it useful to convey these errors to other libraries or software systems. This
section provides specific URLs, descriptions, and error codes for the errors,
such that an ecosystem implementing technologies described by this
specification might interoperate more effectively when errors occur.
        </p>

        <p>
When exposing these errors through an HTTP interface, implementers <em class="rfc2119">SHOULD</em> use
[<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc9457" title="Problem Details for HTTP APIs">RFC9457</a></cite>] to encode the error data structure as a <dfn id="dfn-problemdetails" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">ProblemDetails</dfn>
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>. If [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc9457" title="Problem Details for HTTP APIs">RFC9457</a></cite>] is used:
        </p>

        <ul>
          <li>
The <code>type</code> value of the error object <em class="rfc2119">MUST</em> be a URL that starts with the value
<code>https://w3id.org/security#</code> and ends with the value in the section listed
below.
          </li>
          <li>
The <code>code</code> value <em class="rfc2119">MUST</em> be the integer code described in the table below
(in parentheses, beside the type name).
          </li>
          <li>
The <code>title</code> value <em class="rfc2119">SHOULD</em> provide a short but specific human-readable <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> for
the error.
          </li>
          <li>
The <code>detail</code> value <em class="rfc2119">SHOULD</em> provide a longer human-readable <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#string">string</a> for the error.
          </li>
        </ul>

        <dl>
          <dt id="PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR (-16)</dt>
          <dd>
A request to generate a proof failed. See Section <a href="#add-proof" data-matched-text="[[[#add-proof]]]" class="sec-ref"><bdi class="secno">4.2 </bdi>Add Proof</a>, and Section
<a href="#add-proof-set-chain" data-matched-text="[[[#add-proof-set-chain]]]" class="sec-ref"><bdi class="secno">4.3 </bdi>Add Proof Set/Chain</a>.
          </dd>
          <dt id="PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR (-17)</dt>
          <dd>
An error was encountered during proof verification. See Section <a href="#verify-proof" data-matched-text="[[[#verify-proof]]]" class="sec-ref"><bdi class="secno">4.4 </bdi>Verify Proof</a>.
          </dd>
          <dt id="PROOF_TRANSFORMATION_ERROR">PROOF_TRANSFORMATION_ERROR  (-18)</dt>
          <dd>
An error was encountered during the transformation process.
          </dd>
          <dt id="INVALID_DOMAIN_ERROR">INVALID_DOMAIN_ERROR (-19)</dt>
          <dd>
The <code>domain</code> value in a proof did not match the expected value. See Section
<a href="#verify-proof" data-matched-text="[[[#verify-proof]]]" class="sec-ref"><bdi class="secno">4.4 </bdi>Verify Proof</a>.
          </dd>
          <dt id="INVALID_CHALLENGE_ERROR">INVALID_CHALLENGE_ERROR (-20)</dt>
          <dd>
The <code>challenge</code> value in a proof did not match the expected value. See Section
<a href="#verify-proof" data-matched-text="[[[#verify-proof]]]" class="sec-ref"><bdi class="secno">4.4 </bdi>Verify Proof</a>.
          </dd>
        </dl>
      </section>
    </section>

    <section id="security-considerations"><div class="header-wrapper"><h2 id="x5-security-considerations"><bdi class="secno">5. </bdi>Security Considerations</h2><a class="self-link" href="#security-considerations" aria-label="Permalink for Section 5."></a></div>
      
      <p>
The following section describes security considerations that developers
implementing this specification should be aware of in order to create secure
software.
      </p>

      <section id="versioning-cryptography-suites"><div class="header-wrapper"><h3 id="x5-1-versioning-cryptography-suites"><bdi class="secno">5.1 </bdi>Versioning Cryptography Suites</h3><a class="self-link" href="#versioning-cryptography-suites" aria-label="Permalink for Section 5.1"></a></div>
        

        <p>
Cryptography secures information through the use of secrets. Knowledge of the
necessary secret makes it computationally easy to access certain information. The
same information can be accessed if a computationally-difficult, brute-force effort
successfully guesses the secret. All modern cryptography requires the
computationally difficult approach to remain difficult throughout time, which
does not always hold due to breakthroughs in science and mathematics. That is
to say that <em>Cryptography has a shelf life</em>.
        </p>
        <p>
This specification plans for the obsolescence of all cryptographic approaches by
asserting that whatever cryptography is in use today is highly likely to be
broken over time. Software systems have to be able to change the cryptography
in use over time in order to continue to secure information. Such changes might
involve increasing required secret sizes or modifications to the cryptographic
primitives used. However, some combinations of cryptographic parameters
might actually reduce security. Given these assumptions, systems need to be able to
distinguish different combinations of safe cryptographic parameters, also known
as cryptographic suites, from one another. When identifying or versioning
cryptographic suites, there are several approaches that can be taken which
include: parameters, numbers, and dates.
        </p>
        <p>
Parametric versioning specifies the particular cryptographic parameters that are
employed in a cryptographic suite. For example, one could use an identifier such
as <code>RSASSA-PKCS1-v1_5-SHA1</code>. The benefit to this scheme is that a well-trained
cryptographer will be able to determine all of the parameters in play by the
identifier. The drawback to this scheme is that most of the population that
uses these sorts of identifiers are not well trained and thus will not understand
that the previously mentioned identifier is a cryptographic suite that is no
longer safe to use. Additionally, this lack of knowledge might lead software
developers to generalize the parsing of cryptographic suite identifiers
such that any combination of cryptographic primitives becomes acceptable,
resulting in reduced security. Ideally, cryptographic suites are implemented
in software as specific, acceptable profiles of cryptographic parameters instead.
        </p>
        <p>
Numbered versioning might specify a major and minor version number such as
<code>1.0</code> or <code>2.1</code>. Numbered versioning conveys a specific order and suggests that
higher version numbers are more capable than lower version numbers. The benefit
of this approach is that it removes complex parameters that less expert
developers might not understand with a simpler model that conveys that an
upgrade might be appropriate. The drawback of this approach is that its not
clear if an upgrade is necessary, as software version number increases often
don't require an upgrade for the software to continue functioning. This can
lead to developers thinking their usage of a particular version is safe, when
it is not. Ideally, additional signals would be given to developers that use
cryptographic suites in their software that periodic reviews of those
suites for continued security are required.
        </p>
        <p>
Date-based versioning specifies a particular release date for a specific
cryptographic suite. The benefit of a date, such as a year, is that it is
immediately clear to a developer if the date is relatively old or new. Seeing
an old date might prompt the developer to go searching for a newer
cryptographic suite, where as a parametric or number-based versioning scheme
might not. The downside of a date-based version is that some cryptographic
suites might not expire for 5-10 years, prompting the developer to go
searching for a newer cryptographic suite only to not find one that is newer.
While this might be an inconvenience, it is one that results in safer
ecosystem behavior.
        </p>

      </section>

      <section id="protecting-application-developers"><div class="header-wrapper"><h3 id="x5-2-protecting-application-developers"><bdi class="secno">5.2 </bdi>Protecting Application Developers</h3><a class="self-link" href="#protecting-application-developers" aria-label="Permalink for Section 5.2"></a></div>
        

        <p>
Modern cryptographic algorithms provide a number of tunable parameters and
options to ensure that the algorithms can meet the varied requirements of different use cases.
For example, embedded systems have limited processing and memory environments
and might not have the resources to generate the strongest digital signatures
for a given algorithm. Other environments, like financial trading systems,
might only need to protect data for a day while the trade is occurring, while
other environments might need to protect data for multiple decades. To meet
these needs, cryptographic algorithm designers often provide multiple ways to
configure a cryptographic algorithm.
        </p>
        <p>
Cryptographic library implementers often take the specifications created by
cryptographic algorithm designers and specification authors and implement them
such that all options are available to the application developers that use their
libraries. This can be due to not knowing which combination of features a
particular application developer might need for a given cryptographic deployment.
All options are often exposed to application developers.
        </p>
        <p>
Application developers that use cryptographic libraries often do not have the
requisite cryptographic expertise and knowledge necessary to appropriately
select cryptographic parameters and options for a given application. This lack
of expertise can lead to an inappropriate selection of cryptographic parameters
and options for a particular application.
        </p>
        <p>
This specification sets the priority of constituencies to protect application
developers over cryptographic library implementers over cryptographic
specification authors over cryptographic algorithm designers. Given these
priorities, the following recommendations are made:
        </p>
        <ul>
          <li>
Cryptographic algorithm designers are advised [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7696" title="Guidelines for Cryptographic Algorithm Agility and Selecting Mandatory-to-Implement Algorithms">RFC7696</a></cite>] to minimize the
number of options and parameters to as few as possible to ensure that
cryptographic library implementers have a more easily auditable security attack
surface for their software libraries.
          </li>
          <li>
Cryptographic specification authors are advised to, if possible, further
minimize the number of options and parameters to as few as possible to ensure
cryptographic agility while also keeping the auditable security
attack surface for downstream software libraries to a minimum.
          </li>
          <li>
Cryptographic library implementers are advised to, if possible, provide known
good combinations of options and parameters to application developers. There
would ideally be two pre-set default configurations for any algorithmic
class, such as Elliptic Curve Digital Signatures, with no ability
to fine tune parameters and options when using these pre-sets. Library options can be provided to
experts to fine tune their use of the library, use of those options by the general
application developer population is to be discouraged.
          </li>
          <li>
Cryptographic library implementers can provide deprecated and experimental
cryptographic functionality, but are advised to only do so when explicitly
requested by the developer, such as through a library option, and such that the
library produces warnings that deprecated or experimental cryptography has
been enabled for the application.
          </li>
          <li>
Application developers are advised to choose from a number of pre-set
cryptography library configurations and to avoid modifying cryptographic
options and parameters, or using experimental or deprecated cryptography.
          </li>
        </ul>

        <p>
The guidance above is meant to ensure that useful cryptographic options and
parameters are provided at the lower layers of the architecture while not
exposing those options and parameters to application developers who may not
fully understand the balancing benefits and drawbacks of each option.
        </p>

      </section>

      <section id="conventions-for-naming-cryptography-suites"><div class="header-wrapper"><h3 id="x5-3-conventions-for-naming-cryptography-suites"><bdi class="secno">5.3 </bdi>Conventions for Naming Cryptography Suites</h3><a class="self-link" href="#conventions-for-naming-cryptography-suites" aria-label="Permalink for Section 5.3"></a></div>
        
        <p>
Section <a href="#versioning-cryptography-suites" data-matched-text="[[[#versioning-cryptography-suites]]]" class="sec-ref"><bdi class="secno">5.1 </bdi>Versioning Cryptography Suites</a> emphasized the importance of
providing relatively easy to understand information concerning the timeliness of
particular cryptographic suite, while section
<a href="#protecting-application-developers" data-matched-text="[[[#protecting-application-developers]]]" class="sec-ref"><bdi class="secno">5.2 </bdi>Protecting Application Developers</a> further emphasized minimizing the
number of options to be specified. Indeed, section <a href="#cryptographic-suites" data-matched-text="[[[#cryptographic-suites]]]" class="sec-ref"><bdi class="secno">3. </bdi>Cryptographic Suites</a>
lists requirements for cryptographic suites which include detailed specification
of algorithm, transformation, hashing, and serialization. Hence, the name of the
cryptographic suite does not need to include all this detail, which implies the
<em>parametric versioning</em> mentioned in section
<a href="#versioning-cryptography-suites" data-matched-text="[[[#versioning-cryptography-suites]]]" class="sec-ref"><bdi class="secno">5.1 </bdi>Versioning Cryptography Suites</a> is neither necessary nor desirable.
        </p>
        <p>
The recommended naming convention for cryptographic suites is a
string composed of a signature algorithm identifier, separated by a hyphen from
an option identifier (if the cryptosuite supports incompatible
implementation options), followed by a hyphen and designation of the
approximate year that the suite was proposed.
        </p>
        <p>
For example, the [<cite><a class="bibref" data-link-type="biblio" href="#bib-di-eddsa" title="The Edwards Digital Signature Algorithm Cryptosuites v1.0">DI-EDDSA</a></cite>] is based on EdDSA digital signatures, supports
two incompatible options based on canonicalization approaches, and was proposed
in roughly the year 2022, so it would have two different cryptosuite names:
<q>eddsa-rdfc-2022</q> and <q>eddsa-jcs-2022</q>.
        </p>
        <p>
Although the [<cite><a class="bibref" data-link-type="biblio" href="#bib-di-ecdsa" title="The Elliptic Curve Digital Signature Algorithm Cryptosuites v1.0">DI-ECDSA</a></cite>] is based on ECDSA digital signatures, supports the
same two incompatible canonicalization approaches as [<cite><a class="bibref" data-link-type="biblio" href="#bib-di-eddsa" title="The Edwards Digital Signature Algorithm Cryptosuites v1.0">DI-EDDSA</a></cite>], and supports
two different levels of security (128 bit and 192 bit) via two alternative sets
of elliptic curves and hashes, it has only two cryptosuite names:
<q>ecdsa-rdfc-2019</q> and <q>ecdsa-jcs-2019</q>. The security level and corresponding
curves and hashes are determined from the multi-key format of the public key
used in validation.
        </p>
      </section>

      <section id="agility-and-layering"><div class="header-wrapper"><h3 id="x5-4-agility-and-layering"><bdi class="secno">5.4 </bdi>Agility and Layering</h3><a class="self-link" href="#agility-and-layering" aria-label="Permalink for Section 5.4"></a></div>
        

        <p>
<dfn class="lint-ignore" id="dfn-cryptographic-agility" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Cryptographic agility</dfn> is a practice by which one designs
<em>frequently connected</em> information security systems to support
<em>switching between multiple cryptographic primitives and/or algorithms</em>. The primary
goal of cryptographic agility is to enable systems to rapidly adapt to new
cryptographic primitives and algorithms without making disruptive changes to the
systems' infrastructure. Thus, when a particular cryptographic primitive, such
as the SHA-1 algorithm, is determined to be no longer safe to use, systems can
be reconfigured to use a newer primitive via a simple configuration file change.
        </p>
        <p>
Cryptographic agility is most effective when the client and the server in
the information security system are in regular contact. However, when the
messages protected by a particular cryptographic algorithm are long-lived, as
with <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a>, and/or when the client (holder) might not be
able to easily recontact the server (issuer), then cryptographic agility does
not provide the desired protections.
        </p>
        <p>
<dfn class="lint-ignore" id="dfn-cryptographic-layering" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Cryptographic layering</dfn> is a practice where one
designs <em>rarely connected</em> information security systems to
<em>employ multiple primitives and/or algorithms at the same time</em>. The
primary goal of cryptographic layering is to enable systems to survive the
failure or one or more cryptographic algorithms or primitives without losing
cryptographic protection on the payload. For example, digitally signing a single
piece of information using RSA, ECDSA, and Falcon algorithms in parallel would
provide a mechanism that could survive the failure of two of these three digital
signature algorithms. When a particular cryptographic protection is compromised,
such as an RSA digital signature using 768-bit keys, systems can still utilize
the non-compromised cryptographic protections to continue to protect the
information. Developers are urged to take advantage of this feature for all
signed content that might need to be protected for a year or longer.
        </p>
        <p>
This specification provides for both forms of agility. It provides for
cryptographic agility, which allows one to easily switch from one algorithm to
another. It also provides for cryptographic layering, which allows one to
simultaneously use multiple cryptographic algorithms, typically in parallel,
such that any of those used to protect information can be used without reliance
on or requirement of the others, while still keeping the digital proof format
easy to use for developers.
        </p>
        <p>
        </p>
      </section>

      <section id="transformations"><div class="header-wrapper"><h3 id="x5-5-transformations"><bdi class="secno">5.5 </bdi>Transformations</h3><a class="self-link" href="#transformations" aria-label="Permalink for Section 5.5"></a></div>
        

        <p>
At times, it is beneficial to transform the data being protected during the
cryptographic protection process. Such "in-line" transformation can enable a
particular type of cryptographic protection to be agnostic to the data format it
is carried in. For example, some Data Integrity cryptographic suites utilize RDF
Dataset Canonicalization [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] which transforms the initial
representation into a canonical form [<cite><a class="bibref" data-link-type="biblio" href="#bib-n-quads" title="RDF 1.1 N-Quads">N-QUADS</a></cite>] that is then serialized,
hashed, and digitally signed. As long as any syntax expressing the protected
data can be transformed into this canonical form, the digital signature can be
verified. This enables the same digital signature over the information to be
expressed in JSON, CBOR, YAML, and other compatible syntaxes without having to
create a cryptographic proof for every syntax.
        </p>
        <p>
Being able to express the same digital signature across a variety of syntaxes is
beneficial because systems often have native data formats with which they
operate. For example, some systems are written against JSON data, while others
are written against CBOR data. Without transformation, systems that process
their data internally as CBOR are required to store the digitally signed data
structures as JSON (or vice-versa). This leads to double-storing data and can
lead to increased security attack surface if the unsigned representation stored in
databases accidentally deviates from the signed representation. By using
transformations, the digital proof can live in the native data format to
help prevent otherwise undetectable database drift over time.
        </p>
        <p>
This specification is designed to avoid requiring the duplication of signed
information by utilizing "in-line" data transformations. Application developers are urged
to work with cryptographically protected data in the native data format for
their application and not separate storage of cryptographic proofs from the data
being protected. Developers are also urged to regularly confirm that the
cryptographically protected data has not been tampered with as it is written to
and read from application storage.
        </p>
        <p class="advisement">
Some transformations, such as RDF Dataset Canonicalization [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>], have
mitigations for input data sets that can be used by attackers to consume
excessive processing cycles. This class of attack is called
<a href="https://www.w3.org/TR/rdf-canon/#dataset-poisoning">dataset poisoning</a>, and all
modern RDF Dataset canonicalizers are required to detect these sorts of bad
inputs and halt processing. The test suites for RDF Dataset Canonicalization
includes such poisoned datasets to ensure that such mitigations exist in all
conforming implementations. Generally speaking, cryptographic suite
specifications that use transformations are required to mitigate these sorts of
attacks, and implementers are urged to ensure that the software libraries that
they use enforce these mitigations. These attacks are in the same general
category as any resource starvation attack, such as HTTP clients that
deliberately slow connections, thus starving connections on the server.
Implementers are advised to consider these sorts of attacks when implementing
defensive security strategies.
        </p>
      </section>

      <section id="protected-information"><div class="header-wrapper"><h3 id="x5-6-protected-information"><bdi class="secno">5.6 </bdi>Protected Information</h3><a class="self-link" href="#protected-information" aria-label="Permalink for Section 5.6"></a></div>
        

        <p>
The data that is protected by any <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-14">data integrity proof</a> is the
<a data-link-type="dfn|abstract-op" data-lt="transformation" href="#dfn-transformation" class="internalDFN" id="ref-for-dfn-transformation-2">transformed data</a>. <a data-link-type="dfn|abstract-op" data-lt="transformation" href="#dfn-transformation" class="internalDFN" id="ref-for-dfn-transformation-3">Transformed data</a>
is generated by a <a data-link-type="dfn|abstract-op" href="#dfn-transformation-algorithm" class="internalDFN" id="ref-for-dfn-transformation-algorithm-2">transformation algorithm</a> that is specified by a
particular <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-12">cryptosuite</a>. This protection mechanism differs from some
more traditional digital signature mechanisms that do not perform any sort of
<a data-link-type="dfn|abstract-op" href="#dfn-transformation" class="internalDFN" id="ref-for-dfn-transformation-4">transformation</a> on the input data. The benefits of <a data-link-type="dfn|abstract-op" href="#dfn-transformation" class="internalDFN" id="ref-for-dfn-transformation-5">transformation</a> are
detailed in Section <a href="#transformations" data-matched-text="[[[#transformations]]]" class="sec-ref"><bdi class="secno">5.5 </bdi>Transformations</a>.
        </p>

        <p>
For example, <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-13">cryptosuites</a> such as
<a href="https://www.w3.org/TR/vc-di-ecdsa/#ecdsa-jcs-2019">ecdsa-jcs-2019</a> and
<a href="https://www.w3.org/TR/vc-di-eddsa/#eddsa-jcs-2022">eddsa-jcs-2022</a> use the
<cite><a data-matched-text="[[[?RFC8785]]]" href="https://www.rfc-editor.org/rfc/rfc8785">JSON Canonicalization Scheme (JCS)</a></cite> to <a data-link-type="dfn|abstract-op" data-lt="transformation" href="#dfn-transformation" class="internalDFN" id="ref-for-dfn-transformation-6">transform</a> the data to canonicalized JSON,
which is then cryptographically hashed and digitally signed. One benefit of this
approach is that adding or removing formatting characters that do not impact the
meaning of the information being signed, such as spaces, tabs, and newlines,
does not invalidate the digital signature. More traditional digital signature
mechanisms do not have this capability.
        </p>

        <p>
Other <a data-link-type="dfn|abstract-op" href="#dfn-cryptosuite" class="internalDFN" id="ref-for-dfn-cryptosuite-14">cryptosuites</a> such as
<a href="https://www.w3.org/TR/vc-di-ecdsa/#ecdsa-rdfc-2019">ecdsa-rdfc-2019</a> and
<a href="https://www.w3.org/TR/vc-di-eddsa/#eddsa-rdfc-2022">eddsa-rdfc-2022</a> use
<cite><a data-matched-text="[[[?RDF-CANON]]]" href="https://www.w3.org/TR/rdf-canon/">RDF Dataset Canonicalization</a></cite> to <a data-link-type="dfn|abstract-op" data-lt="transformation" href="#dfn-transformation" class="internalDFN" id="ref-for-dfn-transformation-7">transform</a> the data to canonicalized
N-Quads [<cite><a class="bibref" data-link-type="biblio" href="#bib-n-quads" title="RDF 1.1 N-Quads">N-QUADS</a></cite>], which is then cryptographically hashed and digitally
signed. One benefit of this approach is that the cryptographic signature is
portable to a variety of different syntaxes, such as JSON, YAML, and CBOR,
without invalidating the signature. More traditional cryptographic signature
mechanisms do not have this capability.
        </p>

        <p>
Implementers and developers are urged to not trust information
that contains a <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-15">data integrity proof</a> unless the proof has been <a data-link-type="dfn|abstract-op" href="#dfn-verified" class="internalDFN" id="ref-for-dfn-verified-2">verified</a>
and the verified data is provided in a return value from a software library
that has confirmed that all data returned has been successfully protected.
        </p>

      </section>

      <section id="data-opacity"><div class="header-wrapper"><h3 id="x5-7-data-opacity"><bdi class="secno">5.7 </bdi>Data Opacity</h3><a class="self-link" href="#data-opacity" aria-label="Permalink for Section 5.7"></a></div>
        

        <p>
The inspectability of application data has effects on system efficiency and
developer productivity. When cryptographically protected application data, such
as base-encoded binary data, is not easily processed by application subsystems,
such as databases, it increases the effort of working with the cryptographically
protected information. For example, a cryptographically protected payload that
can be natively stored and indexed by a database will result in a simpler system
that:
        </p>

        <ul>
          <li>
benefits from utilizing existing industry-standard database features with no
changes to the protected information,
          </li>
          <li>
avoids the complexity of duplicating data where one copy of the data preserves
the message and digital signature, while the other copy only stores and indexes
the message and is what drives system behaviour,
          </li>
          <li>
avoids the complexity of bespoke solutions that have to structurally modify
the protected information, such as serializing and deserializing nested
digitally signed data that has multiple nested base-encoded payloads.
          </li>
        </ul>

        <p>
Similarly, a cryptographically protected payload that can be processed by
multiple upstream networked systems increases the ability to properly layer
security architectures. For example, if upstream systems do not have to
repeatedly decode the incoming payload, it increases the ability for a system to
distribute processing load by specializing upstream subsystems to actively
combat attacks. While a digital signature needs to always be checked before
taking substantive action, other upstream checks can be performed on transparent
payloads — such as identifier-based rate limiting, signature expiration
checking, or nonce/challenge checking — to reject obviously bad requests.
        </p>
        <p>
Additionally, if a developer is not able to easily view data in a system, the
ability to easily audit or debug system correctness is hampered. For example,
requiring application developers to cut-and-paste base-encoded application data
makes development more challenging and increases the chances that obvious bugs
will be missed because every message needs to go through a manually operated
base-decoding tool.
        </p>
        <p>
There are times, however, where the correct design decision is to make data
opaque. Data that does not need to be processed by other application subsystems,
as well as data that does not need to be modified or accessed by an application
developer, can be serialized into opaque formats. Examples include digital
signature values, cryptographic key parameters, and other data fields that only
need to be accessed by a cryptographic library and need not be modified by the
application developer. There are also examples where data opacity is appropriate
when the underlying subsystem does not expose the application developer to the
underlying complexity of the opaque data, such as databases that perform
encryption at rest. In these cases, the application developer continues to
develop against transparent application data formats while the database manages
the complexity of encrypting and decrypting the application data to and from
long-term storage.
        </p>
        <p>
This specification strives to provide an architecture where application data
remains in its native format and is not made opaque, while other cryptographic
data, such as digital signatures, are kept in their opaque binary encoded form.
Cryptographic suite implementers are urged to consider appropriate use of data
opacity when designing their suites, and to weigh the design trade-offs when
making application data opaque versus providing access to cryptographic data at
the application layer.
        </p>
      </section>

      <section id="verification-method-binding"><div class="header-wrapper"><h3 id="x5-8-verification-method-binding"><bdi class="secno">5.8 </bdi>Verification Method Binding</h3><a class="self-link" href="#verification-method-binding" aria-label="Permalink for Section 5.8"></a></div>
        

        <p>
Implementers ensure that a <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-8">verification method</a> is bound to a particular
controller by going from the definition of the <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-9">verification method</a> to the
<a data-link-type="dfn|abstract-op" href="#dfn-controller-document" class="internalDFN" id="ref-for-dfn-controller-document-2">controller document</a>, and then ensuring that the <a data-link-type="dfn|abstract-op" href="#dfn-controller-document" class="internalDFN" id="ref-for-dfn-controller-document-3">controller document</a> also
contains a reference to the <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-10">verification method</a>. This process is described
in the algorithm for
<a href="https://www.w3.org/TR/controller-document/#retrieve-verification-method">
retrieving a verification method</a>.
        </p>
      </section>

      <section id="verification-relationship-validation"><div class="header-wrapper"><h3 id="x5-9-verification-relationship-validation"><bdi class="secno">5.9 </bdi>Verification Relationship Validation</h3><a class="self-link" href="#verification-relationship-validation" aria-label="Permalink for Section 5.9"></a></div>
        

        <p>
When an implementation is <a href="#verify-proof">verifying a proof</a>, it is
imperative that it verify not only that the <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-11">verification method</a> used to
generate the proof is listed in the <a data-link-type="dfn|abstract-op" href="#dfn-controller-document" class="internalDFN" id="ref-for-dfn-controller-document-4">controller document</a>, but also that it
was intended to be used to generate the proof that is being verified. This process
is known as "verification relationship validation".
        </p>
        <p>
The process of validating a verification relationship is outlined in
Section
<a href="https://www.w3.org/TR/controller-document/#retrieve-verification-method">
3.3 Retrieve Verification Method</a> of the <cite><a data-matched-text="[[[CONTROLLER-DOCUMENT]]]" href="https://www.w3.org/TR/controller-document/">Controller Documents 1.0</a></cite>
specification.
        </p>
        <p>
This process is used to ensure that cryptographic material, such as a private
cryptographic key, is not misused by application to an unintended purpose. An
example of cryptographic material misuse would be if a private cryptographic
key meant to be used to issue a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a> was instead used to
log into a website (that is, for authentication). Not checking a verification relationship
is dangerous because the restriction and protection profile for some
cryptographic material could be determined by its intended use. For example,
some applications could be trusted to use cryptographic material for only
one purpose, or some cryptographic material could be more protected,
such as through storage in a hardware security module in a data center
versus as an unencrypted file on a laptop.
        </p>
      </section>

      <section id="proof-purpose-validation"><div class="header-wrapper"><h3 id="x5-10-proof-purpose-validation"><bdi class="secno">5.10 </bdi>Proof Purpose Validation</h3><a class="self-link" href="#proof-purpose-validation" aria-label="Permalink for Section 5.10"></a></div>
        

        <p>
When an implementation is <a href="#verify-proof">verifying a proof</a>, it is
imperative that it verify that the <a data-link-type="dfn|abstract-op" href="#dfn-proof-purpose" class="internalDFN" id="ref-for-dfn-proof-purpose-6">proof purpose</a> match the intended use.
        </p>

        <p>
This process is used to ensure that proofs are not misused by an application for
an unintended purpose, as this is dangerous for the proof creator. An example of
misuse would be if a proof that stated its purpose was for securing assertions
in <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a> was instead used for <a data-link-type="dfn|abstract-op" href="#dfn-authentication" class="internalDFN" id="ref-for-dfn-authentication-1">authentication</a> to
log into a website. In this case, the proof creator attached proofs to any
number of <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a> that they expected to be distributed to
an unbounded number of other parties. Any one of these parties could log into a
website as the proof creator if the website erroneously accepted such a proof as
<a data-link-type="dfn|abstract-op" href="#dfn-authentication" class="internalDFN" id="ref-for-dfn-authentication-2">authentication</a> instead of its intended purpose.
        </p>

      </section>

      <section id="canonicalization-method-security"><div class="header-wrapper"><h3 id="x5-11-canonicalization-method-security"><bdi class="secno">5.11 </bdi>Canonicalization Method Security</h3><a class="self-link" href="#canonicalization-method-security" aria-label="Permalink for Section 5.11"></a></div>
        

        <p>
The way in which a transformation, such as canonicalization, is performed can
affect the security characteristics of a system. Selecting the best
canonicalization mechanisms depends on the use case. Often,
the simplest mechanism that satisfies the desired security requirements
is the best choice. This section attempts to provide simple guidance to help
implementers choose between the two main canonicalization mechanisms referred to
in this specification, namely JSON Canonicalization Scheme [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8785" title="JSON Canonicalization Scheme (JCS)">RFC8785</a></cite>] and
RDF Dataset Canonicalization [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>].
        </p>
        <p>
If an application only uses JSON and does not depend on any form of RDF
semantics, then using a cryptography suite that uses JSON
Canonicalization Scheme [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8785" title="JSON Canonicalization Scheme (JCS)">RFC8785</a></cite>] is an attractive approach.
        </p>
        <p>
If an application uses JSON-LD and needs to secure the semantics of
the document, then using a cryptography suite that
uses RDF Dataset Canonicalization [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] is an attractive
approach.
        </p>
        <p>
Implementers are also advised that other mechanisms that perform no
transformations are available, that secure the data by wrapping it in a
cryptographic envelope instead of embedding the proof in the data, such as
JWTs [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7519" title="JSON Web Token (JWT)">RFC7519</a></cite>] and CWTs [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8392" title="CBOR Web Token (CWT)">RFC8392</a></cite>]. These approaches have simplicity
advantages in some use cases, at the expense of some of the benefits provided
by the approach detailed in this specification.
        </p>
      </section>

      <section id="canonicalization-method-correctness"><div class="header-wrapper"><h3 id="x5-12-canonicalization-method-correctness"><bdi class="secno">5.12 </bdi>Canonicalization Method Correctness</h3><a class="self-link" href="#canonicalization-method-correctness" aria-label="Permalink for Section 5.12"></a></div>
        

        <p>
One of the algorithmic processes used by this specification is canonicalization,
which is a type of <a data-link-type="dfn|abstract-op" href="#dfn-transformation" class="internalDFN" id="ref-for-dfn-transformation-8">transformation</a>. Canonicalization is the process of
taking information that might be expressed in a variety of semantically
equivalent ways as input, and expressing all output in a single way, called a
"canonical form".
        </p>
        <p>
The security of a resulting <a data-link-type="dfn|abstract-op" href="#dfn-data-integrity-proof" class="internalDFN" id="ref-for-dfn-data-integrity-proof-16">data integrity proof</a> that utilizes
canonicalization is highly dependent on the correctness of the algorithm. For
example, if a canonicalization algorithm converts two inputs that have different
meanings into the same output, then the author's intentions can be
misrepresented to a <a data-link-type="dfn|abstract-op" href="#dfn-verifier" class="internalDFN" id="ref-for-dfn-verifier-3">verifier</a>. This can be used as an attack vector by
adversaries.
        </p>
        <p>
Additionally, if semantically relevant information in an input is not present in
the output, then an attacker could insert such information into a message
without causing proof verification to fail. This is similar to another
transformation that is commonly used when cryptographically signing messages:
cryptographic hashing. If an attacker is able to produce the same cryptographic
hash from a different input, then the cryptographic hash algorithm is not
considered secure.
        </p>
        <p>
Implementers are strongly urged to ensure proper vetting of any canonicalization
algorithms to be used for <a data-link-type="dfn|abstract-op" href="#dfn-transformation" class="internalDFN" id="ref-for-dfn-transformation-9">transformation</a> of input to a <a data-link-type="dfn|abstract-op" href="#dfn-hashing" class="internalDFN" id="ref-for-dfn-hashing-2">hashing</a>
process. Proper vetting includes, at a minimum, association with a peer reviewed
mathematical proof of algorithm correctness; multiple implementations and vetting
by experts in a standards setting organization is preferred. Implementers are
strongly urged not to invent or use new mechanisms unless they have formal
training in information canonicalization and/or access to experts in the field
who are capable of producing a peer reviewed mathematical proof of algorithm
correctness.
        </p>
      </section>

      <section id="network-requests"><div class="header-wrapper"><h3 id="x5-13-network-requests"><bdi class="secno">5.13 </bdi>Network Requests</h3><a class="self-link" href="#network-requests" aria-label="Permalink for Section 5.13"></a></div>
        

        <p>
This specification is designed in such a way that no network requests are
required when verifying a proof on a <a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-8">conforming secured document</a>.
Readers might note, however, that <a href="#data-model">JSON-LD contexts</a>
and <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-12">verification methods</a> can contain URLs that might be retrieved
over a network connection. This concern exists for any URL that might be
loaded from the network during or after verification.
        </p>
        <p>
To the extent possible, implementers are urged to permanently or aggressively
cache such information to reduce the attack surface on an implementation that
might need to fetch such URLs over the network. For example, caching techniques
for <a href="#data-model">JSON-LD contexts</a> are described in Section
<a href="#contexts-and-vocabularies" data-matched-text="[[[#contexts-and-vocabularies]]]" class="sec-ref"><bdi class="secno">2.4 </bdi>Contexts and Vocabularies</a>, and some <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-13">verification methods</a>, such as
<code>did:key</code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-did-key" title="The did:key Method">DID-KEY</a></cite>], do not need to be fetched from the network at all.
        </p>
        <p>
When it is not possible to use cached information, such as when a specific HTTP
URL-based instance of a <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-14">verification method</a> is encountered for the first
time, implementers are cautioned to use defensive measures to mitigate <a href="https://en.wikipedia.org/wiki/Denial-of-service_attack">
denial-of-service attacks</a> during any process that might fetch a resource
from the network.
        </p>
      </section>

      <section id="other-security-considerations"><div class="header-wrapper"><h3 id="x5-14-other-security-considerations"><bdi class="secno">5.14 </bdi>Other Security Considerations</h3><a class="self-link" href="#other-security-considerations" aria-label="Permalink for Section 5.14"></a></div>
        

        <p>
Since the technology to secure documents described by this specification is
generalized in nature, the security implications of its use might not be
immediately apparent to readers. To understand the sort of security
concerns one might need to consider in a complete software system, implementers
are urged to read about how this technology is used in the
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a> ecosystem [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-model-2.0" title="Verifiable Credentials Data Model v2.0">VC-DATA-MODEL-2.0</a></cite>]; see the section
on <a href="https://www.w3.org/TR/vc-data-model-2.0/#security-considerations">
Verifiable Credential Security Considerations</a> for more information.
        </p>
      </section>

    </section>

    <section id="privacy-considerations"><div class="header-wrapper"><h2 id="x6-privacy-considerations"><bdi class="secno">6. </bdi>Privacy Considerations</h2><a class="self-link" href="#privacy-considerations" aria-label="Permalink for Section 6."></a></div>
      
      <p>
The following section describes privacy considerations that developers
implementing this specification should be aware of in order to create
privacy enhancing software.
      </p>

      <section id="unlinkability"><div class="header-wrapper"><h3 id="x6-1-unlinkability"><bdi class="secno">6.1 </bdi>Unlinkability</h3><a class="self-link" href="#unlinkability" aria-label="Permalink for Section 6.1"></a></div>
        

        <p>
When a digitally-signed payload contains data that is seen by multiple
verifiers, it becomes a point of correlation. An example of such data is a
shopping loyalty card number. Correlatable data can be used for tracking
purposes by verifiers, which can sometimes violate privacy expectations. The
fact that some data can be used for tracking might not be immediately apparent.
Examples of such correlatable data include, but are not limited to, a static
digital signature or a cryptographic hash of an image.
        </p>

        <p>
It is possible to create a digitally-signed payload that does not have any
correlatable tracking data while also providing some level of assurance that the
payload is trustworthy for a given interaction. This characteristic is called
<dfn class="lint-ignore" id="dfn-unlinkability" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">unlinkability</dfn> which ensures that no correlatable
data are used in a digitally-signed payload while still providing some level of
trust, the sufficiency of which must be determined by each verifier.
        </p>

        <p>
It is important to understand that not all use cases require or even permit
unlinkability. There are use cases where linkability and correlation are
required due to regulatory or safety reasons, such as correlating organizations
and individuals that are shipping and storing hazardous materials. Unlinkability
is useful when there is an expectation of privacy for a particular interaction.
        </p>

        <p>
There are at least two mechanisms that can provide some level of unlinkability.
The first method is to ensure that no data value used in the message is ever
repeated in a future message. The second is to ensure that any repeated data
value provides adequate herd privacy such that it becomes practically impossible
to correlate the entity that expects some level of privacy in the interaction.
        </p>

        <p>
A variety of methods can be used to achieve unlinkability. These methods include
ensuring that a message is a single use bearer token with no information that
can be used for the purposes of correlation, using attributes that ensure an
adequate level of herd privacy, and the use of cryptosuites that enable the
entity presenting a message to regenerate new signatures while not compromising
the trust in the message being presented.
        </p>
      </section>

      <section id="selective-disclosure"><div class="header-wrapper"><h3 id="x6-2-selective-disclosure"><bdi class="secno">6.2 </bdi>Selective Disclosure</h3><a class="self-link" href="#selective-disclosure" aria-label="Permalink for Section 6.2"></a></div>
        

        <p>
Selective disclosure is a technique that enables the recipient of a
previously-signed message (that is, a message signed by its creator) to reveal
only parts of the message without disturbing the verifiability of those
parts. For example, one might selectively disclose a digital driver's license for
the purpose of renting a car. This could involve revealing only the issuing
authority, license number, birthday, and authorized motor vehicle class from
the license. Note that in this case, the license number is correlatable
information, but some amount of privacy is preserved because the driver's
full name and address are not shared.
        </p>

        <p>
Not all software or cryptosuites are capable of providing selective disclosure.
If the author of a message wishes it to be selectively disclosable by its
recipient, then they need to enable selective disclosure on the specific
message, and both need to use a capable cryptosuite. The author might also make
it mandatory to disclose certain parts of the message. A recipient that wants to
selectively disclose partial content of the message needs to utilize software
that is able to perform the technique. An example of a cryptosuite that supports
selective disclosure is <code>bbs-2023</code>.
        </p>

        <p>
It is possible to selectively disclose information in a way that does not
preserve unlinkability. For example, one might want to disclose the inspection
results related to a shipment, which include the shipment identifier or lot
number, which might have to be correlatable due to regulatory requirements.
However, disclosure of the entire inspection result might not be required as
selectively disclosing just the pass/fail status could be deemed adequate. For
more information on disclosing information while preserving privacy, see Section
<a href="#unlinkability" data-matched-text="[[[#unlinkability]]]" class="sec-ref"><bdi class="secno">6.1 </bdi>Unlinkability</a>.
        </p>
      </section>

      <section id="previous-proofs"><div class="header-wrapper"><h3 id="x6-3-previous-proofs"><bdi class="secno">6.3 </bdi>Previous Proofs</h3><a class="self-link" href="#previous-proofs" aria-label="Permalink for Section 6.3"></a></div>
        

        <p>
When using the <code>previousProof</code> feature defined in <a href="#proof-chains" data-matched-text="[[[#proof-chains]]]" class="sec-ref"><bdi class="secno">2.1.2 </bdi>Proof Chains</a>,
implementations are required to digitally sign over one or more previous proofs,
so as to include them in the secured payload. This inevitably exposes
information related to each entity that added a previous proof.
        </p>
        <p>
At minimum, the <a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-15">verification method</a> for the previous proof, such as a
public key, is seen by the creator of the next proof in a proof chain. This
can be a privacy concern if the creator of the previous proof did not intend
to be included in a proof chain, but is an inevitable outcome when
adding a non-repudiable digital signature to a document of any kind.
        </p>
        <p>
It is possible to use more advanced cryptographic mechanisms, such as a
<a href="https://en.wikipedia.org/wiki/Group_signature">group signature</a>,
to hide the identity of the signer of a message,
and it is also possible for a Data Integrity cryptographic suite
to mitigate this privacy concern.
        </p>
      </section>

      <section id="fingerprinting-network-requests"><div class="header-wrapper"><h3 id="x6-4-fingerprinting-network-requests"><bdi class="secno">6.4 </bdi>Fingerprinting Network Requests</h3><a class="self-link" href="#fingerprinting-network-requests" aria-label="Permalink for Section 6.4"></a></div>
        

        <p>
Fingerprinting concerns exist for any URL that might be loaded from the network
during or after <a href="#verify-proof">proof verification</a>. This
specification is designed in such a way that no network requests are necessary
when verifying a proof on a <a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-9">conforming secured document</a>. Readers might
note, however, that <a href="#data-model">JSON-LD contexts</a> and
<a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-16">verification methods</a> can contain resource URLs that might be retrieved
over a network connection leading to fingerprinting concerns.
        </p>

        <p>
For example, creators of <a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-10">conforming secured documents</a> might craft unique
per-document URLs for <a href="#data-model">JSON-LD contexts</a> and
<a data-link-type="dfn|abstract-op" href="#dfn-verification-method" class="internalDFN" id="ref-for-dfn-verification-method-17">verification methods</a>. When verifying such a document, a verifier fetching
that information from the network would reveal their interest in the
<a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-11">conforming secured document</a> to the creator of the document, which might lead
to a mismatch in privacy expectations for any entity that is not the creator of
the document.
        </p>

        <p>
Implementers are urged to follow the guidance in Section <a href="#network-requests" data-matched-text="[[[#network-requests]]]" class="sec-ref"><bdi class="secno">5.13 </bdi>Network Requests</a>
on URL caching and implementing defensively when fetching URLs from the network.
Usage of techniques such as
<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ohai-ohttp">
Oblivious HTTP</a> to retrieve resources from the network, without revealing the
client that is making the request, are encouraged. Additionally, heuristics
might be used to determine whether creators of <a data-link-type="dfn|abstract-op" href="#dfn-conforming-secured-document" class="internalDFN" id="ref-for-dfn-conforming-secured-document-12">conforming secured documents</a>
are using fingerprinting URLs in a way that might violate privacy expectations.
These heuristics could be used to display warnings to entities that might
process documents containing suspected fingerprinting URLs.
        </p>
      </section>

      <section id="canonicalization-method-privacy"><div class="header-wrapper"><h3 id="x6-5-canonicalization-method-privacy"><bdi class="secno">6.5 </bdi>Canonicalization Method Privacy</h3><a class="self-link" href="#canonicalization-method-privacy" aria-label="Permalink for Section 6.5"></a></div>
        

        <p>
The way in which a transformation, namely canonicalization, is performed can
affect the privacy characteristics of a system. Selecting the best
canonicalization mechanism depends on the use case.
This section attempts to provide simple guidance to help
implementers pick between the two main canonicalization mechanisms referred to
in this specification, namely JSON Canonicalization Scheme [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8785" title="JSON Canonicalization Scheme (JCS)">RFC8785</a></cite>] and
RDF Dataset Canonicalization [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>], from a privacy perspective.
        </p>
        <p>
If an application does not require performing a selective disclosure of
information in a secured document, nor does it utilize JSON-LD, then JSON
Canonicalization Scheme [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8785" title="JSON Canonicalization Scheme (JCS)">RFC8785</a></cite>] is an attractive approach.
        </p>
        <p>
If an application uses JSON-LD and might require selective disclosure
of information in a secured document, then using a cryptography suite that
uses RDF Dataset Canonicalization [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] is an attractive
approach.
        </p>
        <p>
Implementers are also advised that other selective disclosure mechanisms that
perform no transformations are available, that secure the data by wrapping it in a
cryptographic envelope instead of embedding the proof in the data, such as
SD-JWTs [<cite><a class="bibref" data-link-type="biblio" href="#bib-sd-jwt" title="Selective Disclosure for JWTs (SD-JWT)">SD-JWT</a></cite>]. This approach has simplicity advantages in some use cases,
at the expense of some of the benefits provided by the approach detailed in
this specification.
        </p>
      </section>

      <section id="other-privacy-considerations"><div class="header-wrapper"><h3 id="x6-6-other-privacy-considerations"><bdi class="secno">6.6 </bdi>Other Privacy Considerations</h3><a class="self-link" href="#other-privacy-considerations" aria-label="Permalink for Section 6.6"></a></div>
        

        <p>
Since the technology to secure documents described by this specification is
generalized in nature, the privacy implications of its use might not be
immediately apparent to readers. To understand the sort of privacy
concerns one might need to consider in a complete software system, implementers
are urged to read about how this technology is used in the
<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a> ecosystem [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-model-2.0" title="Verifiable Credentials Data Model v2.0">VC-DATA-MODEL-2.0</a></cite>]; see the section
on <a href="https://www.w3.org/TR/vc-data-model-2.0/#privacy-considerations">
Verifiable Credential Privacy Considerations</a> for more information.
        </p>
      </section>

    </section>

    <section id="accessibility-considerations"><div class="header-wrapper"><h2 id="x7-accessibility-considerations"><bdi class="secno">7. </bdi>Accessibility Considerations</h2><a class="self-link" href="#accessibility-considerations" aria-label="Permalink for Section 7."></a></div>
      
      <p>
The following section describes accessibility considerations that developers
implementing this specification are urged to consider in order to ensure that
their software is usable by people with different cognitive, motor, and visual
needs. As a general rule, this specification is used by system software and does
not directly expose individuals to information subject to accessibility
considerations. However, there are instances where individuals might be
indirectly exposed to information expressed by this specification and thus the
guidance below is provided for those situations.
      </p>

      <section id="presenting-time-values"><div class="header-wrapper"><h3 id="x7-1-presenting-time-values"><bdi class="secno">7.1 </bdi>Presenting Time Values</h3><a class="self-link" href="#presenting-time-values" aria-label="Permalink for Section 7.1"></a></div>
        
        <p>
This specification enables the expression of dates and times related to the
validity period of cryptographic proofs. This information might be indirectly
exposed to an individual if a proof is processed and is detected to be outside
an allowable time range. When exposing these dates and times to an individual,
implementers are urged to take into account
<a href="https://www.w3.org/TR/vc-data-model-2.0/#representing-time">cultural normas and locales
when representing dates and times</a> in display software. In addition to these
considerations, presenting time values in a way that eases the cognitive burden
on the individual receiving the information is a suggested best practice.
        </p>
        <p>
For example, when conveying the expiration date for a particular set of
digitally signed information, implementers are urged to present the time of
expiration using language that is easier to understand rather than language that
optimizes for accuracy. Presenting the expiration time as "This ticket expired
three days ago." is preferred over a phrase such as "This ticket expired on July
25th 2023 at 3:43 PM." The former provides a relative time that is easier to
comprehend than the latter time, which requires the individual to do the
calculation in their head and presumes that they are capable of doing such a
calculation.
        </p>
      </section>

    </section>

    <section class="appendix informative" id="understanding-proof-sets-and-proof-chains"><div class="header-wrapper"><h2 id="a-understanding-proof-sets-and-proof-chains"><bdi class="secno">A. </bdi>Understanding Proof Sets and Proof Chains</h2><a class="self-link" href="#understanding-proof-sets-and-proof-chains" aria-label="Permalink for Appendix A."></a></div><p><em>This section is non-normative.</em></p>
      
      <p>
Sections <a href="#proof-sets" data-matched-text="[[[#proof-sets]]]" class="sec-ref"><bdi class="secno">2.1.1 </bdi>Proof Sets</a> and <a href="#proof-chains" data-matched-text="[[[#proof-chains]]]" class="sec-ref"><bdi class="secno">2.1.2 </bdi>Proof Chains</a> describe how multiple proofs
can be expressed in a <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-12">secured data document</a>; that is, instead of a single
<a data-link-type="dfn|abstract-op" href="#dfn-proof" class="internalDFN" id="ref-for-dfn-proof-4">proof</a> included in the <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-13">secured data document</a>, one can express multiple
proofs in an <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> as shown in <a href="#example-a-proof-set-in-a-data-document" data-matched-text="[[[#example-a-proof-set-in-a-data-document]]]" class="box-ref">Example<bdi> 6</bdi></a> and
<a href="#example-a-proof-chain-in-a-data-document" data-matched-text="[[[#example-a-proof-chain-in-a-data-document]]]" class="box-ref">Example<bdi> 7</bdi></a>. The elements of this <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://infra.spec.whatwg.org/#list">list</a> are
members of a <a data-link-type="dfn|abstract-op" href="#dfn-proof-set" class="internalDFN" id="ref-for-dfn-proof-set-2">proof set</a> and, optionally, a <a data-link-type="dfn|abstract-op" href="#dfn-proof-chain" class="internalDFN" id="ref-for-dfn-proof-chain-2">proof chain</a>. The purpose of
this section is to explain the intended use of each of these features and, in
particular, their differing security properties. These differing security
properties lead to differences in the processing in section
<a href="#add-proof-set-chain" data-matched-text="[[[#add-proof-set-chain]]]" class="sec-ref"><bdi class="secno">4.3 </bdi>Add Proof Set/Chain</a>.
      </p>
      <p>
This section represents <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-14">secured data documents</a>, including their proofs, in
an abbreviated manner so that the important security properties can be
observed.
      </p>
      <p>
Consider a scenario with three signatories: a CEO, a CFO, and a VP of
Engineering. Each will need to have a public key and secret key pair for signing
a document. We denote the secret/public keys of each of these signatories by
<em>secretCEO/publicCEO</em>, <em>secretCFO/publicCFO</em>, and
<em>secretVPE/publicVPE</em>, respectively.
      </p>
      <p>
When constructing a <a data-link-type="dfn|abstract-op" href="#dfn-proof-set" class="internalDFN" id="ref-for-dfn-proof-set-3">proof set</a> where each of the signatories signs an
<var>inputDocument</var> without concern, we construct a proof symbolically as:
      </p>
      <div class="example" id="example-symbolic-expression-of-how-a-proof-is-created">
        <div class="marker">
    <a class="self-link" href="#example-symbolic-expression-of-how-a-proof-is-created">Example<bdi> 9</bdi></a><span class="example-title">: Symbolic expression of how a proof is created</span>
  </div> <pre class="nohighlight">{
  "type": "DataIntegrityProof",
  "cryptosuite": "eddsa-jcs-2022",
  "created": "2023-03-05T19:23:24Z",
  "proofPurpose": "assertionMethod",
  "verificationMethod": <code>publicCEO</code>,
  "proofValue": <strong>signature(<code>secretCEO</code>, <code>inputDocument</code>)</strong>
}</pre>
      </div>
      <p>
Where <em>publicCEO</em> is used as a placeholder for a reference that resolves
to the CEO's public key and <strong>signature(<code>secretKey</code>,
<code>inputDocument</code>)</strong> denotes the computation of a digital signature
by a particular data integrity cryptosuite using a particular secret key over a
particular document. The <code>type</code>, <code>cryptosuite</code>, <code>created</code>, and <code>proofPurpose</code>
attributes do not factor into our discussion so we will omit them. In
particular, below we show all the proofs in a <a data-link-type="dfn|abstract-op" href="#dfn-proof-set" class="internalDFN" id="ref-for-dfn-proof-set-4">proof set</a> on a document that
has been signed by the VP of Engineering, the CFO, and the CEO:
      </p>
      <div class="example" id="example-symbolic-expression-of-a-proof-set">
        <div class="marker">
    <a class="self-link" href="#example-symbolic-expression-of-a-proof-set">Example<bdi> 10</bdi></a><span class="example-title">: Symbolic expression of a proof set</span>
  </div> <pre class="nohighlight">{
  <span class="comment">// Remainder of secured data document not shown (above)</span>
  "proof": [{
    "verificationMethod": <code>publicVPE</code>,
    "proofValue": <strong>signature(<code>secretVPE</code>, <code>inputDocument</code>)</strong>
  }, {
    "verificationMethod": <code>publicCFO</code>,
    "proofValue": <strong>signature(<code>secretCFO</code>, <code>inputDocument</code>)</strong>
  }, {
    "verificationMethod": <code>publicCEO</code>,
    "proofValue": <strong>signature(<code>secretCEO</code>, <code>inputDocument</code>)</strong>
  }]
}</pre>
      </div>
      <p>
A <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-holders">holder</a> or any other intermediary receiving a <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-15">secured data document</a>
containing a <a data-link-type="dfn|abstract-op" href="#dfn-proof-set" class="internalDFN" id="ref-for-dfn-proof-set-5">proof set</a> is able to remove any of the <code>proof</code> values within
the set prior to passing it on to another entity and the <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-16">secured data document</a> will still verify. This might or might not have been the intent. For
the signatories sending a birthday card to a valued employee, using a <a data-link-type="dfn|abstract-op" href="#dfn-proof-set" class="internalDFN" id="ref-for-dfn-proof-set-6">proof set</a> is probably fine. If we are trying to model a business process where
approvals ascend the company hierarchy, this would not be ideal, since any
intermediary could remove signatures from the <a data-link-type="dfn|abstract-op" href="#dfn-proof-set" class="internalDFN" id="ref-for-dfn-proof-set-7">proof set</a> and still have it
verify; for instance, in the example below, it looks like the CFO and CEO
approved something without the VP of Engineering's concurrence.
      </p>
      <div class="example" id="example-removal-of-a-signature-in-a-proof-set">
        <div class="marker">
    <a class="self-link" href="#example-removal-of-a-signature-in-a-proof-set">Example<bdi> 11</bdi></a><span class="example-title">: Removal of a signature in a proof set</span>
  </div> <pre class="nohighlight">{
  <span class="comment">// Remainder of secured data document not shown (above)</span>
  "proof": [{
    "verificationMethod": <code>publicCFO</code>,
    "proofValue": <strong>signature(<code>secretCFO</code>, <code>inputDocument</code>)</strong>
  }, {
    "verificationMethod": <code>publicCEO</code>,
    "proofValue": <strong>signature(<code>secretCEO</code>, <code>inputDocument</code>)</strong>
  }]
}</pre>
      </div>
      <p>
It is possible to introduce a dependency between <a data-link-type="dfn|abstract-op" href="#dfn-proof" class="internalDFN" id="ref-for-dfn-proof-5">proofs</a> in a <a data-link-type="dfn|abstract-op" href="#dfn-proof-set" class="internalDFN" id="ref-for-dfn-proof-set-8">proof set</a>
by setting the <code>id</code> property of each proof such that another proof can reference
it. In other words, a <em>dependent proof</em> will be referenced by other
<em>relying proofs</em> by using the <code>previousProof</code> property. Such
<em>dependency chains</em> can have arbitrary depth. The <strong>intent</strong>
of such a <a data-link-type="dfn|abstract-op" href="#dfn-proof-chain" class="internalDFN" id="ref-for-dfn-proof-chain-3">proof chain</a> is to model an approval chain in a business process or
a notary witnessing analog signatures.
      </p>
      <p>
The examples below demonstrate how a <a data-link-type="dfn|abstract-op" href="#dfn-proof-chain" class="internalDFN" id="ref-for-dfn-proof-chain-4">proof chain</a> can be constructed when the
VP of Engineering signs off on the document first; based on the VP of
Engineering's signature and a review, the CFO then signs off on the document;
and finally, based on both prior signatures and a review, the CEO signs off on
the document. Since others will be referring to the VP of Engineering's
signature, we need to add an <code>id</code> to the proof. First the VP of
Engineering signs the <a data-link-type="dfn|abstract-op" href="#dfn-input-document" class="internalDFN" id="ref-for-dfn-input-document-6">input document</a>:
      </p>
      <div class="example" id="example-proof-chain-containing-first-proof-with-id-property-set">
        <div class="marker">
    <a class="self-link" href="#example-proof-chain-containing-first-proof-with-id-property-set">Example<bdi> 12</bdi></a><span class="example-title">: Proof chain containing first proof with `id` property set</span>
  </div> <pre class="nohighlight">{
  <span class="comment">// Remainder of secured data document not shown (above)</span>
  "proof": {
    <span class="highlight">"id": "urn:proof-1"</span>,
    "verificationMethod": <code>publicVPE</code>,
    "proofValue": <strong>signature(<code>secretVPE</code>, <code>inputDocument</code>)</strong>
  }
}</pre>
      </div>
      <p>
Next, the CFO receives the document, verifies that the VP of Engineering signed
it, and signs it based on a review and on the signature of the VP of
Engineering. For this, we need to set up the <a data-link-type="dfn|abstract-op" href="#dfn-proof-chain" class="internalDFN" id="ref-for-dfn-proof-chain-5">proof chain</a> by indicating a
dependency on the proof in the document just received. We do this by
setting the <code>previousProof</code> property of the second proof to the value
<code>urn:proof-1</code>, which "binds" the second proof to the first proof, which is
then signed. The following example shows how the dependency on the first proof
is created:
      </p>
      <div class="example" id="example-proof-chain-containing-two-proofs">
        <div class="marker">
    <a class="self-link" href="#example-proof-chain-containing-two-proofs">Example<bdi> 13</bdi></a><span class="example-title">: Proof chain containing two proofs</span>
  </div> <pre class="nohighlight">{
  <span class="comment">// Remainder of secured data document not shown (above)</span>
  "proof": [{
    "id": "urn:proof-1",
    "verificationMethod": <code>publicVPE</code>,
    "proofValue": <strong>signature(<code>secretVPE</code>, <code>inputDocument</code>)</strong>
  }, {
    "id": "urn:proof-2",
    "verificationMethod": <code>publicCFO</code>,
    <span class="highlight">"previousProof": "urn:proof-1"</span>,
    "proofValue": <strong>signature(<code>secretCFO</code>, <code>inputDocumentWithProof1</code>)</strong>
  }]
}</pre>
      </div>
      <p>
Now, when the CEO verifies the received <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-17">secured data document</a> with the
above <a data-link-type="dfn|abstract-op" href="#dfn-proof-chain" class="internalDFN" id="ref-for-dfn-proof-chain-6">proof chain</a>, they will check that the CFO signed based on the
signature of the VP of Engineering. First, they will check the proof with an
<code>id</code> property whose value is <code>urn:proof-1</code> against the public key of the VP of
Engineering. Note that this proof is over the original document.
      </p>
      <p>
Next, the CEO will check the proof with an <code>id</code> property whose value is
<code>urn:proof-2</code> against the public key of the CFO. However, to make sure that the
CFO signed the document with proof that the VP of Engineering had already
signed, we verify this proof over the combination of the document and
<code>urn:proof-1</code>. If verification is successful, the CEO signs, producing a proof
over the document which includes <code>urn:proof-1</code> and <code>urn:proof-2</code>. The final
<a data-link-type="dfn|abstract-op" href="#dfn-proof-chain" class="internalDFN" id="ref-for-dfn-proof-chain-7">proof chain</a> looks like this:
      </p>
      <div class="example" id="example-proof-chain-containing-three-proofs">
        <div class="marker">
    <a class="self-link" href="#example-proof-chain-containing-three-proofs">Example<bdi> 14</bdi></a><span class="example-title">: Proof chain containing three proofs</span>
  </div> <pre class="nohighlight">{
  <span class="comment">// Remainder of secured data document not shown (above)</span>
  "proof": [{
    "id": "urn:proof-1",
    "verificationMethod": <code>publicVPE</code>,
    "proofValue": <strong>signature(<code>secretVPE</code>, <code>inputDocument</code>)</strong>
  }, {
    "id": "urn:proof-2",
    "verificationMethod": <code>publicCFO</code>,
    "previousProof": "urn:proof-1",
    "proofValue": <strong>signature(<code>secretCFO</code>, <code>inputDocumentWithProof1</code>)</strong>
  }, {
    "id": "urn:proof-3",
    "verificationMethod": <code>publicCEO</code>,
    "previousProof": "urn:proof-2",
    "proofValue": <strong>signature(<code>secretCEO</code>, <code>inputDocumentWithProof2</code>)</strong>
  }]
}</pre>
      </div>
      <p>
The recipient of this <a data-link-type="dfn|abstract-op" href="#dfn-secured-data-document" class="internalDFN" id="ref-for-dfn-secured-data-document-18">secured data document</a> then validates it in a similar
way, checking each proof in the chain.
      </p>
    </section>

    <section class="appendix informative" id="revision-history"><div class="header-wrapper"><h2 id="b-revision-history"><bdi class="secno">B. </bdi>Revision History</h2><a class="self-link" href="#revision-history" aria-label="Permalink for Appendix B."></a></div><p><em>This section is non-normative.</em></p>
      

      <p>
This section contains the substantive changes that have been made to this
specification over time.
      </p>

      <p>
Changes since the
<a href="https://www.w3.org/TR/2023/CR-vc-data-integrity-20231121/">
First Candidate Recommendation</a>:
      </p>

      <ul>
        <li>
Various editorial changes in algorithms and descriptions to improve readability.
        </li>
        <li>
Moved Multikey definitions to Controller Document.
        </li>
        <li>
Unify error handling between all Data Integrity cryptosuites.
        </li>
        <li>
Ensure that the <code>created</code> proof option is not required and additional proof
options are included in the generated proof.
        </li>
        <li>
Add language related to context injection.
        </li>
        <li>
Update proof serialization format and algorithm arguments for
cryptosuite interfaces.
        </li>
      </ul>

      <p>
Changes since the
<a href="https://www.w3.org/TR/2022/WD-vc-data-integrity-20221110/">
First Public Working Draft</a>:
      </p>
      <ul>
        <li>
Added a section on proof purpose validation.
        </li>
        <li>
Refactored chained proof functionality.
        </li>
        <li>
Added the algorithm to retrieve a verification method.
        </li>
        <li>
Added <code>JsonWebKey</code> and <code>Multikey</code> definitions and context files.
        </li>
        <li>
Deprecated <code>Ed25519Signature2020</code> and moved into separate specification.
        </li>
        <li>
Updated Multibase and Multihash references and add text to normatively define
certain Multikey values.
        </li>
        <li>
Added Internationalization and Accessibility Considerations sections.
        </li>
        <li>
Added cryptographic hashes for context and vocabulary files and note that those
files are to be cached.
        </li>
        <li>
Added section on relationship to Linked Data and <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credentials</a>.
        </li>
        <li>
Added algorithms for proof sets and chains.
        </li>
        <li>
Added <code>nonce</code> and <code>expires</code> to proofs.
        </li>
        <li>
Added requirement to protect terms in JSON-LD mode.
        </li>
        <li>
Required cryptosuite specifications that do RDF canonicalization to abort when
poison graphs are detected.
        </li>
        <li>
Added section on how context injection is implemented.
        </li>
        <li>
Added error definitions with anchors to specification and vocabulary.
        </li>
        <li>
Added definitions for secret key expression.
        </li>
        <li>
Added <code>revoked</code> and <code>expires</code> to verification methods.
        </li>
        <li>
Updated proof <code>domain</code> property to allow for an array of values.
        </li>
        <li>
Added <code>cryptosuiteString</code> type to proofs to enable proof compression.
        </li>
        <li>
Added <code>digestMultibase</code> property and <code>multibase</code> data type for securing remote
content, and guidance on adding <code>digestMultibase</code> to contexts.
        </li>
        <li>
Narrowed date time values to use <code>dateTimeStamp</code>.
        </li>
        <li>
Ensure that base URL is set to null when processing as RDF.
        </li>
        <li>
Added requirement that <code>DataIntegrityProof</code> objects need to contain the <code>cryptosuite</code> property.
        </li>
      </ul>
    </section>

    <section class="informative" id="acknowledgements"><div class="header-wrapper"><h2 id="c-acknowledgements"><bdi class="secno">C. </bdi>Acknowledgements</h2><a class="self-link" href="#acknowledgements" aria-label="Permalink for Section C."></a></div><p><em>This section is non-normative.</em></p>
      

      <p>
Work on this specification has been supported by the Rebooting the
Web of Trust community facilitated by Christopher Allen, Shannon Appelcline,
Kiara Robles, Brian Weller, Betty Dhamers, Kaliya Young, Manu Sporny,
Drummond Reed, Joe Andrieu, Heather Vescent, Kim Hamilton Duffy, Samantha Chase,
and Andrew Hughes. The participants in the Internet Identity Workshop,
facilitated by Phil Windley, Kaliya Young, Doc Searls, and Heidi Nobantu Saul,
also supported the refinement of this work through numerous working sessions
designed to educate about, debate on, and improve this specification.
      </p>

      <p>
The Working Group also thanks our Chairs, Brent Zundel and Kristina Yasuda, as
well as our <abbr title="World Wide Web Consortium">W3C</abbr> Staff Contact, Ivan Herman, for their expert management and steady
guidance of the group through the <abbr title="World Wide Web Consortium">W3C</abbr> standardization process.
      </p>

      <p>
Portions of the work on this specification have been funded by the United States
Department of Homeland Security's Science and Technology Directorate under
contracts 70RSAT20T00000029, 70RSAT21T00000016, 70RSAT23T00000005,
70RSAT20T00000010/P00001, 70RSAT20T00000029, 70RSAT21T00000016/P00001,
70RSAT23T00000005, 70RSAT23C00000030, 70RSAT23R00000006, and the National
Science Foundation through NSF 22-572. The content of this specification does
not necessarily reflect the position or the policy of the U.S. Government and no
official endorsement should be inferred.
      </p>

      <p>
The Working Group would like to thank the following individuals for reviewing
and providing feedback on the specification (in alphabetical order):
      </p>

      <p>
Will Abramson,
Mahmoud Alkhraishi,
Christopher Allen,
Joe Andrieu,
Bohdan Andriyiv,
Anthony,
George Aristy,
Greg Bernstein,
Bob420,
Sarven Capadisli,
Melvin Carvalho,
David Chadwick,
Matt Collier,
Gabe Cohen,
Sebastian Crane,
Kyle Den Hartog,
Veikko Eeva,
Eric Elliott,
Raphael Flechtner,
Julien Fraichot,
Benjamin Goering,
Kim Hamilton Duffy,
Joseph Heenan,
Helge,
Ivan Herman,
Michael Herman,
Anil John,
Andrew Jones,
Michael B. Jones,
Rieks Joosten,
Gregory K,
Gregg Kellogg,
Filip Kolarik,
David I. Lehn,
Charles E. Lehner,
Christine Lemmer-Webber,
Eric Lim,
Dave Longley,
Tobias Looker,
Jer Miller,
nightpool,
Luis Osta,
Nate Otto,
George J. Padayatti,
Addison Phillips,
Mike Prorock,
Brian Richter,
Anders Rundgren,
Eugeniu Rusu,
Markus Sabadello,
silverpill,
Wesley Smith,
Manu Sporny,
Patrick St-Louis,
Orie Steele,
Henry Story,
Oliver Terbu,
Ted Thibodeau Jr,
John Toohey,
Bert Van Nuffelen,
Mike Varley,
Snorre Lothar von Gohren Edwin,
Jeffrey Yasskin,
Kristina Yasuda,
Benjamin Young,
Dmitri Zagidulin,
and
Brent Zundel.
      </p>

    </section>

  

<section id="references" class="appendix"><div class="header-wrapper"><h2 id="d-references"><bdi class="secno">D. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix D."></a></div><section id="normative-references"><div class="header-wrapper"><h3 id="d-1-normative-references"><bdi class="secno">D.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix D.1"></a></div>
    
    <dl class="bibliography"><dt id="bib-ascii">[ASCII]</dt><dd>
      <a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-6/"><cite>ISO/IEC 646:1991, Information technology -- ISO 7-bit coded character set for information interchange</cite></a>.  Ecma International. URL: <a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-6/">https://www.ecma-international.org/publications-and-standards/standards/ecma-6/</a>
    </dd><dt id="bib-controller-document">[CONTROLLER-DOCUMENT]</dt><dd>
      <a href="https://www.w3.org/TR/controller-document/"><cite>Controller Documents 1.0</cite></a>. Manu Sporny; Michael Jones.  W3C. 15 October 2024. W3C Working Draft. URL: <a href="https://www.w3.org/TR/controller-document/">https://www.w3.org/TR/controller-document/</a>
    </dd><dt id="bib-infra">[INFRA]</dt><dd>
      <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Anne van Kesteren; Domenic Denicola.  WHATWG. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
    </dd><dt id="bib-json-ld11">[JSON-LD11]</dt><dd>
      <a href="https://www.w3.org/TR/json-ld11/"><cite>JSON-LD 1.1</cite></a>. Gregg Kellogg; Pierre-Antoine Champin; Dave Longley.  W3C. 16 July 2020. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld11/">https://www.w3.org/TR/json-ld11/</a>
    </dd><dt id="bib-json-ld11-api">[JSON-LD11-API]</dt><dd>
      <a href="https://www.w3.org/TR/json-ld11-api/"><cite>JSON-LD 1.1 Processing Algorithms and API</cite></a>. Gregg Kellogg; Dave Longley; Pierre-Antoine Champin.  W3C. 16 July 2020. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld11-api/">https://www.w3.org/TR/json-ld11-api/</a>
    </dd><dt id="bib-mimesniff">[MIMESNIFF]</dt><dd>
      <a href="https://mimesniff.spec.whatwg.org/"><cite>MIME Sniffing Standard</cite></a>. Gordon P. Hemsley.  WHATWG. Living Standard. URL: <a href="https://mimesniff.spec.whatwg.org/">https://mimesniff.spec.whatwg.org/</a>
    </dd><dt id="bib-rdf-canon">[RDF-CANON]</dt><dd>
      <a href="https://www.w3.org/TR/rdf-canon/"><cite>RDF Dataset Canonicalization</cite></a>. Gregg Kellogg; Dave Longley; Dan Yamamoto.  W3C. 21 May 2024. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf-canon/">https://www.w3.org/TR/rdf-canon/</a>
    </dd><dt id="bib-rfc2119">[RFC2119]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd><dt id="bib-rfc8174">[RFC8174]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
    </dd><dt id="bib-rfc8259">[RFC8259]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8259"><cite>The JavaScript Object Notation (JSON) Data Interchange Format</cite></a>. T. Bray, Ed..  IETF. December 2017. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8259">https://www.rfc-editor.org/rfc/rfc8259</a>
    </dd><dt id="bib-rfc8785">[RFC8785]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8785"><cite>JSON Canonicalization Scheme (JCS)</cite></a>. A. Rundgren; B. Jordan; S. Erdtman.  IETF. June 2020. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc8785">https://www.rfc-editor.org/rfc/rfc8785</a>
    </dd><dt id="bib-rfc9457">[RFC9457]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc9457"><cite>Problem Details for HTTP APIs</cite></a>. M. Nottingham; E. Wilde; S. Dalal.  IETF. July 2023. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc9457">https://www.rfc-editor.org/rfc/rfc9457</a>
    </dd><dt id="bib-url">[URL]</dt><dd>
      <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Anne van Kesteren.  WHATWG. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
    </dd><dt id="bib-vc-data-model-2.0">[VC-DATA-MODEL-2.0]</dt><dd>
      <a href="https://www.w3.org/TR/vc-data-model-2.0/"><cite>Verifiable Credentials Data Model v2.0</cite></a>. Manu Sporny; Ted Thibodeau Jr; Ivan Herman; Michael Jones; Gabe Cohen.  W3C. 19 October 2024. W3C Candidate Recommendation. URL: <a href="https://www.w3.org/TR/vc-data-model-2.0/">https://www.w3.org/TR/vc-data-model-2.0/</a>
    </dd><dt id="bib-xmlschema11-2">[XMLSCHEMA11-2]</dt><dd>
      <a href="https://www.w3.org/TR/xmlschema11-2/"><cite>W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes</cite></a>. David Peterson; Sandy Gao; Ashok Malhotra; Michael Sperberg-McQueen; Henry Thompson; Paul V. Biron et al.  W3C. 5 April 2012. W3C Recommendation. URL: <a href="https://www.w3.org/TR/xmlschema11-2/">https://www.w3.org/TR/xmlschema11-2/</a>
    </dd></dl>
  </section><section id="informative-references"><div class="header-wrapper"><h3 id="d-2-informative-references"><bdi class="secno">D.2 </bdi>Informative references</h3><a class="self-link" href="#informative-references" aria-label="Permalink for Appendix D.2"></a></div>
    
    <dl class="bibliography"><dt id="bib-di-ecdsa">[DI-ECDSA]</dt><dd>
      <a href="https://www.w3.org/TR/vc-di-ecdsa/"><cite>The Elliptic Curve Digital Signature Algorithm Cryptosuites v1.0</cite></a>. David Longley; Manu Sporny; Marty Reed.  W3C Verifiable Credentials Working Group. W3C Working Draft. URL: <a href="https://www.w3.org/TR/vc-di-ecdsa/">https://www.w3.org/TR/vc-di-ecdsa/</a>
    </dd><dt id="bib-di-eddsa">[DI-EDDSA]</dt><dd>
      <a href="https://www.w3.org/TR/vc-di-eddsa/"><cite>The Edwards Digital Signature Algorithm Cryptosuites v1.0</cite></a>. David Longley; Manu Sporny; Dmitri Zagidulin.  W3C Verifiable Credentials Working Group. W3C Working Draft. URL: <a href="https://www.w3.org/TR/vc-di-eddsa/">https://www.w3.org/TR/vc-di-eddsa/</a>
    </dd><dt id="bib-did-core">[DID-CORE]</dt><dd>
      <a href="https://www.w3.org/TR/did-core/"><cite>Decentralized Identifiers (DIDs) v1.0</cite></a>. Manu Sporny; Amy Guy; Markus Sabadello; Drummond Reed.  W3C. 19 July 2022. W3C Recommendation. URL: <a href="https://www.w3.org/TR/did-core/">https://www.w3.org/TR/did-core/</a>
    </dd><dt id="bib-did-key">[DID-KEY]</dt><dd>
      <a href="https://w3c-ccg.github.io/did-method-key/"><cite>The did:key Method</cite></a>. Manu Sporny; Dmitri Zagidulin; Dave Longley; Orie Steele.  W3C Credentials Community Group. CG-DRAFT. URL: <a href="https://w3c-ccg.github.io/did-method-key/">https://w3c-ccg.github.io/did-method-key/</a>
    </dd><dt id="bib-html-rdfa">[HTML-RDFA]</dt><dd>
      <a href="https://www.w3.org/TR/html-rdfa/"><cite>HTML+RDFa 1.1 - Second Edition</cite></a>. Manu Sporny.  W3C. 17 March 2015. W3C Recommendation. URL: <a href="https://www.w3.org/TR/html-rdfa/">https://www.w3.org/TR/html-rdfa/</a>
    </dd><dt id="bib-ltli">[LTLI]</dt><dd>
      <a href="https://www.w3.org/TR/ltli/"><cite>Language Tags and Locale Identifiers for the World Wide Web</cite></a>. Addison Phillips.  W3C. 7 October 2020. W3C Working Draft. URL: <a href="https://www.w3.org/TR/ltli/">https://www.w3.org/TR/ltli/</a>
    </dd><dt id="bib-n-quads">[N-QUADS]</dt><dd>
      <a href="https://www.w3.org/TR/n-quads/"><cite>RDF 1.1 N-Quads</cite></a>. Gavin Carothers.  W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/n-quads/">https://www.w3.org/TR/n-quads/</a>
    </dd><dt id="bib-rdf-concepts">[RDF-CONCEPTS]</dt><dd>
      <a href="https://www.w3.org/TR/rdf-concepts/"><cite>Resource Description Framework (RDF): Concepts and Abstract Syntax</cite></a>. Graham Klyne; Jeremy Carroll.  W3C. 10 February 2004. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf-concepts/">https://www.w3.org/TR/rdf-concepts/</a>
    </dd><dt id="bib-rfc5280">[RFC5280]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc5280"><cite>Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</cite></a>. D. Cooper; S. Santesson; S. Farrell; S. Boeyen; R. Housley; W. Polk.  IETF. May 2008. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc5280">https://www.rfc-editor.org/rfc/rfc5280</a>
    </dd><dt id="bib-rfc7517">[RFC7517]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc7517"><cite>JSON Web Key (JWK)</cite></a>. M. Jones.  IETF. May 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7517">https://www.rfc-editor.org/rfc/rfc7517</a>
    </dd><dt id="bib-rfc7519">[RFC7519]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc7519"><cite>JSON Web Token (JWT)</cite></a>. M. Jones; J. Bradley; N. Sakimura.  IETF. May 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7519">https://www.rfc-editor.org/rfc/rfc7519</a>
    </dd><dt id="bib-rfc7696">[RFC7696]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc7696"><cite>Guidelines for Cryptographic Algorithm Agility and Selecting Mandatory-to-Implement Algorithms</cite></a>. R. Housley.  IETF. November 2015. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc7696">https://www.rfc-editor.org/rfc/rfc7696</a>
    </dd><dt id="bib-rfc8392">[RFC8392]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8392"><cite>CBOR Web Token (CWT)</cite></a>. M. Jones; E. Wahlstroem; S. Erdtman; H. Tschofenig.  IETF. May 2018. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8392">https://www.rfc-editor.org/rfc/rfc8392</a>
    </dd><dt id="bib-rfc9562">[RFC9562]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc9562"><cite>Universally Unique IDentifiers (UUIDs)</cite></a>. K. Davis; B. Peabody; P. Leach.  IETF. May 2024. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc9562">https://www.rfc-editor.org/rfc/rfc9562</a>
    </dd><dt id="bib-sd-jwt">[SD-JWT]</dt><dd>
      <a href="https://datatracker.ietf.org/doc/draft-ietf-oauth-selective-disclosure-jwt/"><cite>Selective Disclosure for JWTs (SD-JWT)</cite></a>. Daniel Fett; Kristina Yasuda; Brian Campbell.  The IETF OAuth Working Group. I-D. URL: <a href="https://datatracker.ietf.org/doc/draft-ietf-oauth-selective-disclosure-jwt/">https://datatracker.ietf.org/doc/draft-ietf-oauth-selective-disclosure-jwt/</a>
    </dd><dt id="bib-security-vocabulary">[SECURITY-VOCABULARY]</dt><dd>
      <a href="https://w3id.org/security"><cite>The Security Vocabulary</cite></a>. Ivan Herman; Manu Sporny; David Longley.  Verifiable Credentials Working Group. W3C Editor's Draft. URL: <a href="https://w3id.org/security">https://w3id.org/security</a>
    </dd><dt id="bib-turtle">[TURTLE]</dt><dd>
      <a href="https://www.w3.org/TR/turtle/"><cite>RDF 1.1 Turtle</cite></a>. Eric Prud'hommeaux; Gavin Carothers.  W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/turtle/">https://www.w3.org/TR/turtle/</a>
    </dd><dt id="bib-vc-di-ecdsa">[VC-DI-ECDSA]</dt><dd>
      <a href="https://www.w3.org/TR/vc-di-ecdsa/"><cite>Data Integrity ECDSA Cryptosuites v1.0</cite></a>. Manu Sporny; Martin Reed; Greg Bernstein; Sebastian Crane.  W3C. 15 October 2024. W3C Candidate Recommendation. URL: <a href="https://www.w3.org/TR/vc-di-ecdsa/">https://www.w3.org/TR/vc-di-ecdsa/</a>
    </dd><dt id="bib-vc-di-eddsa">[VC-DI-EDDSA]</dt><dd>
      <a href="https://www.w3.org/TR/vc-di-eddsa/"><cite>Data Integrity EdDSA Cryptosuites v1.0</cite></a>. Manu Sporny; Dmitri Zagidulin; Greg Bernstein; Sebastian Crane.  W3C. 15 October 2024. W3C Candidate Recommendation. URL: <a href="https://www.w3.org/TR/vc-di-eddsa/">https://www.w3.org/TR/vc-di-eddsa/</a>
    </dd><dt id="bib-vc-extensions">[VC-EXTENSIONS]</dt><dd>
      <a href="https://w3c.github.io/vc-extensions/"><cite>Verifiable Credential Extensions</cite></a>. Manu Sporny.  W3C Verifiable Credentials Working Group. W3C Editor's Draft. URL: <a href="https://w3c.github.io/vc-extensions/">https://w3c.github.io/vc-extensions/</a>
    </dd><dt id="bib-webcryptoapi">[WEBCRYPTOAPI]</dt><dd>
      <a href="https://www.w3.org/TR/WebCryptoAPI/"><cite>Web Cryptography API</cite></a>. Mark Watson.  W3C. 26 January 2017. W3C Recommendation. URL: <a href="https://www.w3.org/TR/WebCryptoAPI/">https://www.w3.org/TR/WebCryptoAPI/</a>
    </dd><dt id="bib-zcap">[ZCAP]</dt><dd>
      <a href="https://w3c-ccg.github.io/zcap-spec/"><cite>Authorization Capabilities for Linked Data</cite></a>.  Credentials Community Group. CGDRAFT. URL: <a href="https://w3c-ccg.github.io/zcap-spec/">https://w3c-ccg.github.io/zcap-spec/</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-transformation" aria-label="Links in this document to definition: Transformation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-transformation" aria-label="Permalink for definition: Transformation. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-transformation-1" title="§ 1.1 How it Works">§ 1.1 How it Works</a> 
    </li><li>
      <a href="#ref-for-dfn-transformation-2" title="§ 5.6 Protected Information">§ 5.6 Protected Information</a> <a href="#ref-for-dfn-transformation-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-transformation-4" title="Reference 3">(3)</a> <a href="#ref-for-dfn-transformation-5" title="Reference 4">(4)</a> <a href="#ref-for-dfn-transformation-6" title="Reference 5">(5)</a> <a href="#ref-for-dfn-transformation-7" title="Reference 6">(6)</a> 
    </li><li>
      <a href="#ref-for-dfn-transformation-8" title="§ 5.12 Canonicalization Method Correctness">§ 5.12 Canonicalization Method Correctness</a> <a href="#ref-for-dfn-transformation-9" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-transformation-algorithm" aria-label="Links in this document to definition: transformation algorithm">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-transformation-algorithm" aria-label="Permalink for definition: transformation algorithm. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-transformation-algorithm-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> 
    </li><li>
      <a href="#ref-for-dfn-transformation-algorithm-2" title="§ 5.6 Protected Information">§ 5.6 Protected Information</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-hashing" aria-label="Links in this document to definition: Hashing">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-hashing" aria-label="Permalink for definition: Hashing. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-hashing-1" title="§ 1.1 How it Works">§ 1.1 How it Works</a> 
    </li><li>
      <a href="#ref-for-dfn-hashing-2" title="§ 5.12 Canonicalization Method Correctness">§ 5.12 Canonicalization Method Correctness</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-hashing-algorithm" aria-label="Links in this document to definition: hashing algorithm">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-hashing-algorithm" aria-label="Permalink for definition: hashing algorithm. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-hashing-algorithm-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-proof-serialization-algorithm" aria-label="Links in this document to definition: proof serialization algorithm">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-proof-serialization-algorithm" aria-label="Permalink for definition: proof serialization algorithm. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-proof-serialization-algorithm-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-proof-verification-algorithm" aria-label="Links in this document to definition: proof verification algorithm">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-proof-verification-algorithm" aria-label="Permalink for definition: proof verification algorithm. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-proof-verification-algorithm-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-conforming-secured-document" aria-label="Links in this document to definition: conforming secured document">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-conforming-secured-document" aria-label="Permalink for definition: conforming secured document. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-conforming-secured-document-1" title="§ 1.3 Conformance">§ 1.3 Conformance</a> 
    </li><li>
      <a href="#ref-for-dfn-conforming-secured-document-2" title="§ 2.3 Resource Integrity">§ 2.3 Resource Integrity</a> <a href="#ref-for-dfn-conforming-secured-document-3" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-conforming-secured-document-4" title="§ 2.4 Contexts and Vocabularies">§ 2.4 Contexts and Vocabularies</a> 
    </li><li>
      <a href="#ref-for-dfn-conforming-secured-document-5" title="§ 2.4.1 Validating Contexts">§ 2.4.1 Validating Contexts</a> 
    </li><li>
      <a href="#ref-for-dfn-conforming-secured-document-6" title="§ 2.4.3 Securing Data Losslessly">§ 2.4.3 Securing Data Losslessly</a> <a href="#ref-for-dfn-conforming-secured-document-7" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-conforming-secured-document-8" title="§ 5.13 Network Requests">§ 5.13 Network Requests</a> 
    </li><li>
      <a href="#ref-for-dfn-conforming-secured-document-9" title="§ 6.4 Fingerprinting Network Requests">§ 6.4 Fingerprinting Network Requests</a> <a href="#ref-for-dfn-conforming-secured-document-10" title="Reference 2">(2)</a> <a href="#ref-for-dfn-conforming-secured-document-11" title="Reference 3">(3)</a> <a href="#ref-for-dfn-conforming-secured-document-12" title="Reference 4">(4)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-conforming-processor" aria-label="Links in this document to definition: conforming processor">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-conforming-processor" aria-label="Permalink for definition: conforming processor. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-conforming-processor-1" title="§ 2.1 Proofs">§ 2.1 Proofs</a> <a href="#ref-for-dfn-conforming-processor-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-conforming-processor-3" title="§ 2.4.3 Securing Data Losslessly">§ 2.4.3 Securing Data Losslessly</a> 
    </li><li>
      <a href="#ref-for-dfn-conforming-processor-4" title="§ 4.1 Processing Model">§ 4.1 Processing Model</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-controller-document" aria-label="Links in this document to definition: controller document">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-controller-document" aria-label="Permalink for definition: controller document. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-controller-document-1" title="§ 2.1 Proofs">§ 2.1 Proofs</a> 
    </li><li>
      <a href="#ref-for-dfn-controller-document-2" title="§ 5.8 Verification Method Binding">§ 5.8 Verification Method Binding</a> <a href="#ref-for-dfn-controller-document-3" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-controller-document-4" title="§ 5.9 Verification Relationship Validation">§ 5.9 Verification Relationship Validation</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-cryptosuite" aria-label="Links in this document to definition: cryptographic suite">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-cryptosuite" aria-label="Permalink for definition: cryptographic suite. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-cryptosuite-1" title="§ 1.1 How it Works">§ 1.1 How it Works</a> 
    </li><li>
      <a href="#ref-for-dfn-cryptosuite-2" title="§ 1.2 Design Goals and Rationale">§ 1.2 Design Goals and Rationale</a> 
    </li><li>
      <a href="#ref-for-dfn-cryptosuite-3" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> <a href="#ref-for-dfn-cryptosuite-4" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-cryptosuite-5" title="§ 3.1 DataIntegrityProof">§ 3.1 DataIntegrityProof</a> <a href="#ref-for-dfn-cryptosuite-6" title="Reference 2">(2)</a> <a href="#ref-for-dfn-cryptosuite-7" title="Reference 3">(3)</a> <a href="#ref-for-dfn-cryptosuite-8" title="Reference 4">(4)</a> <a href="#ref-for-dfn-cryptosuite-9" title="Reference 5">(5)</a> <a href="#ref-for-dfn-cryptosuite-10" title="Reference 6">(6)</a> 
    </li><li>
      <a href="#ref-for-dfn-cryptosuite-11" title="§ 4.3 Add Proof Set/Chain">§ 4.3 Add Proof Set/Chain</a> 
    </li><li>
      <a href="#ref-for-dfn-cryptosuite-12" title="§ 5.6 Protected Information">§ 5.6 Protected Information</a> <a href="#ref-for-dfn-cryptosuite-13" title="Reference 2">(2)</a> <a href="#ref-for-dfn-cryptosuite-14" title="Reference 3">(3)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-data-integrity-proof" aria-label="Links in this document to definition: data integrity proof">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-data-integrity-proof" aria-label="Permalink for definition: data integrity proof. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-data-integrity-proof-1" title="§ 1.4 Terminology">§ 1.4 Terminology</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-proof-2" title="§ 2. Data Model">§ 2. Data Model</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-proof-3" title="§ 2.1 Proofs">§ 2.1 Proofs</a> <a href="#ref-for-dfn-data-integrity-proof-4" title="Reference 2">(2)</a> <a href="#ref-for-dfn-data-integrity-proof-5" title="Reference 3">(3)</a> <a href="#ref-for-dfn-data-integrity-proof-6" title="Reference 4">(4)</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-proof-7" title="§ 2.1.3 Proof Graphs">§ 2.1.3 Proof Graphs</a> <a href="#ref-for-dfn-data-integrity-proof-8" title="Reference 2">(2)</a> <a href="#ref-for-dfn-data-integrity-proof-9" title="Reference 3">(3)</a> <a href="#ref-for-dfn-data-integrity-proof-10" title="Reference 4">(4)</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-proof-11" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> <a href="#ref-for-dfn-data-integrity-proof-12" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-proof-13" title="§ 3.1 DataIntegrityProof">§ 3.1 DataIntegrityProof</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-proof-14" title="§ 5.6 Protected Information">§ 5.6 Protected Information</a> <a href="#ref-for-dfn-data-integrity-proof-15" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-proof-16" title="§ 5.12 Canonicalization Method Correctness">§ 5.12 Canonicalization Method Correctness</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-proof-purpose" aria-label="Links in this document to definition: proof purpose">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-proof-purpose" aria-label="Permalink for definition: proof purpose. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-proof-purpose-1" title="§ 2.2 Proof Purposes">§ 2.2 Proof Purposes</a> <a href="#ref-for-dfn-proof-purpose-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-proof-purpose-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-proof-purpose-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-proof-purpose-5" title="Reference 5">(5)</a> 
    </li><li>
      <a href="#ref-for-dfn-proof-purpose-6" title="§ 5.10 Proof Purpose Validation">§ 5.10 Proof Purpose Validation</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-public-key" aria-label="Links in this document to definition: public key">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-public-key" aria-label="Permalink for definition: public key. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-public-key-1" title="§ 1.4 Terminology">§ 1.4 Terminology</a> 
    </li><li>
      <a href="#ref-for-dfn-public-key-2" title="§ 2.1 Proofs">§ 2.1 Proofs</a> <a href="#ref-for-dfn-public-key-3" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-secret-key" aria-label="Links in this document to definition: secret key">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-secret-key" aria-label="Permalink for definition: secret key. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-secret-key-1" title="§ 1.4 Terminology">§ 1.4 Terminology</a> <a href="#ref-for-dfn-secret-key-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-secret-key-3" title="§ 2.6 Relationship to Verifiable Credentials">§ 2.6 Relationship to Verifiable Credentials</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verification-method" aria-label="Links in this document to definition: verification method">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verification-method" aria-label="Permalink for definition: verification method. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verification-method-1" title="§ 1.4 Terminology">§ 1.4 Terminology</a>  
    </li><li>
      <a href="#ref-for-dfn-verification-method-3" title="§ 2.6 Relationship to Verifiable Credentials">§ 2.6 Relationship to Verifiable Credentials</a> <a href="#ref-for-dfn-verification-method-4" title="Reference 2">(2)</a> <a href="#ref-for-dfn-verification-method-5" title="Reference 3">(3)</a> <a href="#ref-for-dfn-verification-method-6" title="Reference 4">(4)</a> <a href="#ref-for-dfn-verification-method-7" title="Reference 5">(5)</a> 
    </li><li>
      <a href="#ref-for-dfn-verification-method-8" title="§ 5.8 Verification Method Binding">§ 5.8 Verification Method Binding</a> <a href="#ref-for-dfn-verification-method-9" title="Reference 2">(2)</a> <a href="#ref-for-dfn-verification-method-10" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-verification-method-11" title="§ 5.9 Verification Relationship Validation">§ 5.9 Verification Relationship Validation</a> 
    </li><li>
      <a href="#ref-for-dfn-verification-method-12" title="§ 5.13 Network Requests">§ 5.13 Network Requests</a> <a href="#ref-for-dfn-verification-method-13" title="Reference 2">(2)</a> <a href="#ref-for-dfn-verification-method-14" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-verification-method-15" title="§ 6.3 Previous Proofs">§ 6.3 Previous Proofs</a> 
    </li><li>
      <a href="#ref-for-dfn-verification-method-16" title="§ 6.4 Fingerprinting Network Requests">§ 6.4 Fingerprinting Network Requests</a> <a href="#ref-for-dfn-verification-method-17" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verifier" aria-label="Links in this document to definition: verifier">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verifier" aria-label="Permalink for definition: verifier. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verifier-1" title="§ 2.2 Proof Purposes">§ 2.2 Proof Purposes</a> 
    </li><li>
      <a href="#ref-for-dfn-verifier-2" title="§ 2.3 Resource Integrity">§ 2.3 Resource Integrity</a> 
    </li><li>
      <a href="#ref-for-dfn-verifier-3" title="§ 5.12 Canonicalization Method Correctness">§ 5.12 Canonicalization Method Correctness</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-proof" aria-label="Links in this document to definition: proof">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-proof" aria-label="Permalink for definition: proof. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-proof-1" title="§ 2.2 Proof Purposes">§ 2.2 Proof Purposes</a> <a href="#ref-for-dfn-proof-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-proof-3" title="§ 4.5 Verify Proof Sets and Chains">§ 4.5 Verify Proof Sets and Chains</a> 
    </li><li>
      <a href="#ref-for-dfn-proof-4" title="§ A. Understanding Proof Sets and Proof Chains">§ A. Understanding Proof Sets and Proof Chains</a> <a href="#ref-for-dfn-proof-5" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-challenge" aria-label="Links in this document to definition: challenge">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-challenge" aria-label="Permalink for definition: challenge. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-challenge-1" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-proof-set" aria-label="Links in this document to definition: proof set">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-proof-set" aria-label="Permalink for definition: proof set. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-proof-set-1" title="§ 4.5 Verify Proof Sets and Chains">§ 4.5 Verify Proof Sets and Chains</a> 
    </li><li>
      <a href="#ref-for-dfn-proof-set-2" title="§ A. Understanding Proof Sets and Proof Chains">§ A. Understanding Proof Sets and Proof Chains</a> <a href="#ref-for-dfn-proof-set-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-proof-set-4" title="Reference 3">(3)</a> <a href="#ref-for-dfn-proof-set-5" title="Reference 4">(4)</a> <a href="#ref-for-dfn-proof-set-6" title="Reference 5">(5)</a> <a href="#ref-for-dfn-proof-set-7" title="Reference 6">(6)</a> <a href="#ref-for-dfn-proof-set-8" title="Reference 7">(7)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-proof-chain" aria-label="Links in this document to definition: proof chain">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-proof-chain" aria-label="Permalink for definition: proof chain. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-proof-chain-1" title="§ 4.5 Verify Proof Sets and Chains">§ 4.5 Verify Proof Sets and Chains</a> 
    </li><li>
      <a href="#ref-for-dfn-proof-chain-2" title="§ A. Understanding Proof Sets and Proof Chains">§ A. Understanding Proof Sets and Proof Chains</a> <a href="#ref-for-dfn-proof-chain-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-proof-chain-4" title="Reference 3">(3)</a> <a href="#ref-for-dfn-proof-chain-5" title="Reference 4">(4)</a> <a href="#ref-for-dfn-proof-chain-6" title="Reference 5">(5)</a> <a href="#ref-for-dfn-proof-chain-7" title="Reference 6">(6)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-proof-graph" aria-label="Links in this document to definition: proof graph">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-proof-graph" aria-label="Permalink for definition: proof graph. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-proof-graph-1" title="§ 2.1.3 Proof Graphs">§ 2.1.3 Proof Graphs</a> 
    </li><li>
      <a href="#ref-for-dfn-proof-graph-2" title="§ 4.3 Add Proof Set/Chain">§ 4.3 Add Proof Set/Chain</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-named-graph" aria-label="Links in this document to definition: named graph">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-named-graph" aria-label="Permalink for definition: named graph. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-named-graph-1" title="§ 2.1 Proofs">§ 2.1 Proofs</a> 
    </li><li>
      <a href="#ref-for-dfn-named-graph-2" title="§ 4.3 Add Proof Set/Chain">§ 4.3 Add Proof Set/Chain</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-authentication" aria-label="Links in this document to definition: authentication">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-authentication" aria-label="Permalink for definition: authentication. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-authentication-1" title="§ 5.10 Proof Purpose Validation">§ 5.10 Proof Purpose Validation</a> <a href="#ref-for-dfn-authentication-2" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-cryptosuite-instantiation-algorithm" aria-label="Links in this document to definition: data integrity cryptographic suite instantiation algorithm">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-cryptosuite-instantiation-algorithm" aria-label="Permalink for definition: data integrity cryptographic suite instantiation algorithm. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-cryptosuite-instantiation-algorithm-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> <a href="#ref-for-dfn-cryptosuite-instantiation-algorithm-2" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-data-integrity-cryptographic-suite-instance" aria-label="Links in this document to definition: data integrity cryptographic suite instance">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-data-integrity-cryptographic-suite-instance" aria-label="Permalink for definition: data integrity cryptographic suite instance. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-data-integrity-cryptographic-suite-instance-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> <a href="#ref-for-dfn-data-integrity-cryptographic-suite-instance-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-cryptographic-suite-instance-3" title="§ 4.2 Add Proof">§ 4.2 Add Proof</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-cryptographic-suite-instance-4" title="§ 4.3 Add Proof Set/Chain">§ 4.3 Add Proof Set/Chain</a> 
    </li><li>
      <a href="#ref-for-dfn-data-integrity-cryptographic-suite-instance-5" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-createproof" aria-label="Links in this document to definition: createProof">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-createproof" aria-label="Permalink for definition: createProof. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-createproof-1" title="§ 4.2 Add Proof">§ 4.2 Add Proof</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verifyproof" aria-label="Links in this document to definition: verifyProof">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verifyproof" aria-label="Permalink for definition: verifyProof. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verifyproof-1" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-cryptosuite-verification-result" aria-label="Links in this document to definition: cryptosuite verification result">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-cryptosuite-verification-result" aria-label="Permalink for definition: cryptosuite verification result. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-cryptosuite-verification-result-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verified" aria-label="Links in this document to definition: verified">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verified" aria-label="Permalink for definition: verified. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verified-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> 
    </li><li>
      <a href="#ref-for-dfn-verified-2" title="§ 5.6 Protected Information">§ 5.6 Protected Information</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-input-document" aria-label="Links in this document to definition: input document">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-input-document" aria-label="Permalink for definition: input document. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-input-document-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> 
    </li><li>
      <a href="#ref-for-dfn-input-document-2" title="§ 4.2 Add Proof">§ 4.2 Add Proof</a> <a href="#ref-for-dfn-input-document-3" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-input-document-4" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> 
    </li><li>
      <a href="#ref-for-dfn-input-document-5" title="§ 4.6 Context Validation">§ 4.6 Context Validation</a> 
    </li><li>
      <a href="#ref-for-dfn-input-document-6" title="§ A. Understanding Proof Sets and Proof Chains">§ A. Understanding Proof Sets and Proof Chains</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-secured-data-document" aria-label="Links in this document to definition: secured data document">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-secured-data-document" aria-label="Permalink for definition: secured data document. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-secured-data-document-1" title="§ 3. Cryptographic Suites">§ 3. Cryptographic Suites</a> <a href="#ref-for-dfn-secured-data-document-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-secured-data-document-3" title="§ 4.2 Add Proof">§ 4.2 Add Proof</a> <a href="#ref-for-dfn-secured-data-document-4" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-secured-data-document-5" title="§ 4.3 Add Proof Set/Chain">§ 4.3 Add Proof Set/Chain</a> <a href="#ref-for-dfn-secured-data-document-6" title="Reference 2">(2)</a> <a href="#ref-for-dfn-secured-data-document-7" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-secured-data-document-8" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> 
    </li><li>
      <a href="#ref-for-dfn-secured-data-document-9" title="§ 4.5 Verify Proof Sets and Chains">§ 4.5 Verify Proof Sets and Chains</a> <a href="#ref-for-dfn-secured-data-document-10" title="Reference 2">(2)</a> <a href="#ref-for-dfn-secured-data-document-11" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-secured-data-document-12" title="§ A. Understanding Proof Sets and Proof Chains">§ A. Understanding Proof Sets and Proof Chains</a> <a href="#ref-for-dfn-secured-data-document-13" title="Reference 2">(2)</a> <a href="#ref-for-dfn-secured-data-document-14" title="Reference 3">(3)</a> <a href="#ref-for-dfn-secured-data-document-15" title="Reference 4">(4)</a> <a href="#ref-for-dfn-secured-data-document-16" title="Reference 5">(5)</a> <a href="#ref-for-dfn-secured-data-document-17" title="Reference 6">(6)</a> <a href="#ref-for-dfn-secured-data-document-18" title="Reference 7">(7)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verification-result" aria-label="Links in this document to definition: verification result">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verification-result" aria-label="Permalink for definition: verification result. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verification-result-1" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> <a href="#ref-for-dfn-verification-result-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-verification-result-3" title="§ 4.5 Verify Proof Sets and Chains">§ 4.5 Verify Proof Sets and Chains</a> <a href="#ref-for-dfn-verification-result-4" title="Reference 2">(2)</a> <a href="#ref-for-dfn-verification-result-5" title="Reference 3">(3)</a> <a href="#ref-for-dfn-verification-result-6" title="Reference 4">(4)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verified-0" aria-label="Links in this document to definition: verified">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verified-0" aria-label="Permalink for definition: verified. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verified-0-1" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> <a href="#ref-for-dfn-verified-0-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-verified-0-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-verified-0-4" title="Reference 4">(4)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verifieddocument-0" aria-label="Links in this document to definition: verifiedDocument">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verifieddocument-0" aria-label="Permalink for definition: verifiedDocument. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verifieddocument-0-1" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-mediatype" aria-label="Links in this document to definition: mediaType">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-mediatype" aria-label="Permalink for definition: mediaType. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-mediatype-1" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-errors" aria-label="Links in this document to definition: errors">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-errors" aria-label="Permalink for definition: errors. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-errors-1" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-validated" aria-label="Links in this document to definition: validated">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-validated" aria-label="Permalink for definition: validated. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-validated-1" title="§ 4.6 Context Validation">§ 4.6 Context Validation</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-problemdetails" aria-label="Links in this document to definition: ProblemDetails">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-problemdetails" aria-label="Permalink for definition: ProblemDetails. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-problemdetails-1" title="§ 4.4 Verify Proof">§ 4.4 Verify Proof</a> <a href="#ref-for-dfn-problemdetails-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-problemdetails-3" title="§ 4.6 Context Validation">§ 4.6 Context Validation</a> <a href="#ref-for-dfn-problemdetails-4" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>